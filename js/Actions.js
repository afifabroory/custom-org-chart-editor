/**
 * Copyright (c) 2006-2020, JGraph Ltd
 * Copyright (c) 2006-2020, draw.io AG
 * 
 * Modified version of the mxgraph GraphEditor. 
 * 2022, Muhammad Afif Abroory (https://github.com/afifabroory/org-chart-editor2)
 */
function Actions(e){this.editorUi=e,this.actions={},this.init()}function Action(e,t,l,n,i){mxEventSource.call(this),this.label=e,this.funct=this.createFunction(t),this.enabled=null==l||l,this.iconCls=n,this.shortcut=i,this.visible=!0}Actions.prototype.init=function(){var e=this.editorUi,t=e.editor,l=t.graph,n=function(){return Action.prototype.isEnabled.apply(this,arguments)&&l.isEnabled()};this.addAction("editDiagram...",function(){var t=new EditDiagramDialog(e);e.showDialog(t.container,620,420,!0,!1),t.init()}),this.addAction("undo",function(){e.undo()},null,"sprite-undo",Editor.ctrlKey+"+Z"),this.addAction("redo",function(){e.redo()},null,"sprite-redo",mxClient.IS_WIN?Editor.ctrlKey+"+Y":Editor.ctrlKey+"+Shift+Z"),this.addAction("cut",function(){mxClipboard.cut(l)},null,"sprite-cut",Editor.ctrlKey+"+X"),this.addAction("copy",function(){try{mxClipboard.copy(l)}catch(t){e.handleError(t)}},null,"sprite-copy",Editor.ctrlKey+"+C"),this.addAction("paste",function(){l.isEnabled()&&!l.isCellLocked(l.getDefaultParent())&&mxClipboard.paste(l)},!1,"sprite-paste",Editor.ctrlKey+"+V"),this.addAction("pasteHere",function(e){if(l.isEnabled()&&!l.isCellLocked(l.getDefaultParent())){l.getModel().beginUpdate();try{var t=mxClipboard.paste(l);if(null!=t){for(var n=!0,i=0;i<t.length&&n;i++)n=n&&l.model.isEdge(t[i]);var o=l.view.translate,a=l.view.scale,s=o.x,d=o.y,c=null;if(1==t.length&&n){var r=l.getCellGeometry(t[0]);null!=r&&(c=r.getTerminalPoint(!0))}if(c=null!=c?c:l.getBoundingBoxFromGeometry(t,n),null!=c){var u=Math.round(l.snap(l.popupMenuHandler.triggerX/a-s)),g=Math.round(l.snap(l.popupMenuHandler.triggerY/a-d));l.cellsMoved(t,u-c.x,g-c.y)}}}finally{l.getModel().endUpdate()}}}),this.addAction("copySize",function(t){var n=l.getSelectionCell();if(l.isEnabled()&&null!=n&&l.getModel().isVertex(n)){var i=l.getCellGeometry(n);null!=i&&(e.copiedSize=new mxRectangle(i.x,i.y,i.width,i.height))}},null,null,"Alt+Shift+X"),this.addAction("pasteSize",function(t){if(l.isEnabled()&&!l.isSelectionEmpty()&&null!=e.copiedSize){l.getModel().beginUpdate();try{for(var n=l.getSelectionCells(),i=0;i<n.length;i++)if(l.getModel().isVertex(n[i])){var o=l.getCellGeometry(n[i]);null!=o&&((o=o.clone()).width=e.copiedSize.width,o.height=e.copiedSize.height,l.getModel().setGeometry(n[i],o))}}finally{l.getModel().endUpdate()}}},null,null,"Alt+Shift+V"),this.addAction("delete",function(e){var t,n;t=null!=e&&mxEvent.isControlDown(e),l.escape(),null!=(n=l.deleteCells(l.getDeletableCells(l.getSelectionCells()),t))&&l.setSelectionCells(n)},null,null,"Delete"),this.addAction("deleteAll",function(){if(!l.isSelectionEmpty()){l.getModel().beginUpdate();try{for(var e=l.getSelectionCells(),t=0;t<e.length;t++)l.cellLabelChanged(e[t],"")}finally{l.getModel().endUpdate()}}}),this.addAction("deleteLabels",function(){if(!l.isSelectionEmpty()){l.getModel().beginUpdate();try{for(var e=l.getSelectionCells(),t=0;t<e.length;t++)l.cellLabelChanged(e[t],"")}finally{l.getModel().endUpdate()}}},null,null,Editor.ctrlKey+"+Delete"),this.addAction("duplicate",function(){try{l.setSelectionCells(l.duplicateCells()),l.scrollCellToVisible(l.getSelectionCell())}catch(t){e.handleError(t)}},null,null,Editor.ctrlKey+"+D"),this.put("turn",new Action(mxResources.get("turn")+" / "+mxResources.get("reverse"),function(e){l.turnShapes(l.getSelectionCells(),null!=e&&mxEvent.isShiftDown(e))},null,null,Editor.ctrlKey+"+R")),this.addAction("selectVertices",function(){l.selectVertices(null,!0)},null,null,Editor.ctrlKey+"+Shift+I"),this.addAction("selectEdges",function(){l.selectEdges()},null,null,Editor.ctrlKey+"+Shift+E"),this.addAction("selectAll",function(){l.selectAll(null,!0)},null,null,Editor.ctrlKey+"+A"),this.addAction("selectNone",function(){l.clearSelection()},null,null,Editor.ctrlKey+"+Shift+A"),this.addAction("lockUnlock",function(){if(!l.isSelectionEmpty()){l.getModel().beginUpdate();try{var e=l.isCellMovable(l.getSelectionCell())?1:0;l.toggleCellStyles(mxConstants.STYLE_MOVABLE,e),l.toggleCellStyles(mxConstants.STYLE_RESIZABLE,e),l.toggleCellStyles(mxConstants.STYLE_ROTATABLE,e),l.toggleCellStyles(mxConstants.STYLE_DELETABLE,e),l.toggleCellStyles(mxConstants.STYLE_EDITABLE,e),l.toggleCellStyles("connectable",e)}finally{l.getModel().endUpdate()}}},null,null,Editor.ctrlKey+"+L"),this.addAction("home",function(){l.home()},null,null,"Shift+Home"),this.addAction("exitGroup",function(){l.exitGroup()},null,null,Editor.ctrlKey+"+Shift+Home"),this.addAction("enterGroup",function(){l.enterGroup()},null,null,Editor.ctrlKey+"+Shift+End"),this.addAction("collapse",function(){l.foldCells(!0)},null,null,Editor.ctrlKey+"+Home"),this.addAction("expand",function(){l.foldCells(!1)},null,null,Editor.ctrlKey+"+End"),this.addAction("toFront",function(){l.orderCells(!1)},null,null,Editor.ctrlKey+"+Shift+F"),this.addAction("toBack",function(){l.orderCells(!0)},null,null,Editor.ctrlKey+"+Shift+B"),this.addAction("group",function(){if(l.isEnabled()){var e=mxUtils.sortCells(l.getSelectionCells(),!0);1!=e.length||l.isTable(e[0])||l.isTableRow(e[0])?(e=l.getCellsForGroup(e)).length>1&&l.setSelectionCell(l.groupCells(null,0,e)):l.setCellStyles("container","1")}},null,null,Editor.ctrlKey+"+G"),this.addAction("ungroup",function(){if(l.isEnabled()){var e=l.getSelectionCells();l.model.beginUpdate();try{var t=l.ungroupCells();if(null!=e)for(var n=0;n<e.length;n++)l.model.contains(e[n])&&(0==l.model.getChildCount(e[n])&&l.model.isVertex(e[n])&&l.setCellStyles("container","0",[e[n]]),t.push(e[n]))}finally{l.model.endUpdate()}l.setSelectionCells(t)}},null,null,Editor.ctrlKey+"+Shift+U"),this.addAction("removeFromGroup",function(){if(l.isEnabled()){var e=l.getSelectionCells();if(null!=e){for(var t=[],n=0;n<e.length;n++)l.isTableRow(e[n])||l.isTableCell(e[n])||t.push(e[n]);l.removeCellsFromParent(t)}}}),this.addAction("edit",function(){l.isEnabled()&&l.startEditingAtCell()},null,null,"F2/Enter"),this.addAction("editData...",function(){var t=l.getSelectionCell()||l.getModel().getRoot();e.showDataDialog(t)},null,null,Editor.ctrlKey+"+M"),this.addAction("editTooltip...",function(){if(l.isEnabled()&&!l.isSelectionEmpty()){var t=l.getSelectionCell(),n="";if(mxUtils.isNode(t.value)){var i=null;Graph.translateDiagram&&null!=Graph.diagramLanguage&&t.value.hasAttribute("tooltip_"+Graph.diagramLanguage)&&(i=t.value.getAttribute("tooltip_"+Graph.diagramLanguage)),null==i&&(i=t.value.getAttribute("tooltip")),null!=i&&(n=i)}var o=new TextareaDialog(e,mxResources.get("editTooltip")+":",n,function(e){l.setTooltipForCell(t,e)});e.showDialog(o.container,320,200,!0,!0),o.init()}},null,null,"Alt+Shift+T"),this.addAction("openLink",function(){var e=l.getLinkForCell(l.getSelectionCell());null!=e&&l.openLink(e)}),this.addAction("editLink...",function(){if(l.isEnabled()&&!l.isSelectionEmpty()){var t=l.getSelectionCell(),n=l.getLinkForCell(t)||"";e.showLinkDialog(n,mxResources.get("apply"),function(e){e=mxUtils.trim(e),l.setLinkForCell(t,e.length>0?e:null)})}},null,null,"Alt+Shift+L"),this.put("insertImage",new Action(mxResources.get("image")+"...",function(){l.isEnabled()&&!l.isCellLocked(l.getDefaultParent())&&(l.clearSelection(),e.actions.get("image").funct())})).isEnabled=n,this.put("insertLink",new Action(mxResources.get("link")+"...",function(){l.isEnabled()&&!l.isCellLocked(l.getDefaultParent())&&e.showLinkDialog("",mxResources.get("insert"),function(e,t){if((e=mxUtils.trim(e)).length>0){var n=null,i=l.getLinkTitle(e);null!=t&&t.length>0&&(n=t[0].iconUrl,(i=(i=t[0].name||t[0].type).charAt(0).toUpperCase()+i.substring(1)).length>30&&(i=i.substring(0,30)+"..."));var o=new mxCell(i,new mxGeometry(0,0,100,40),"fontColor=#0000EE;fontStyle=4;rounded=1;overflow=hidden;"+(null!=n?"shape=label;imageWidth=16;imageHeight=16;spacingLeft=26;align=left;image="+n:"spacing=10;"));o.vertex=!0;var a=l.getCenterInsertPoint(l.getBoundingBoxFromGeometry([o],!0));o.geometry.x=a.x,o.geometry.y=a.y,l.setLinkForCell(o,e),l.cellSizeUpdated(o,!0),l.getModel().beginUpdate();try{o=l.addCell(o),l.fireEvent(new mxEventObject("cellsInserted","cells",[o]))}finally{l.getModel().endUpdate()}l.setSelectionCell(o),l.scrollCellToVisible(l.getSelectionCell())}})})).isEnabled=n,this.addAction("link...",mxUtils.bind(this,function(){if(l.isEnabled()){if(l.cellEditor.isContentEditing()){var t=l.getSelectedElement(),n=l.getParentByName(t,"A",l.cellEditor.textarea),i="";if(null==n&&null!=t&&null!=t.getElementsByTagName)for(var o=t.getElementsByTagName("a"),a=0;a<o.length&&null==n;a++)o[a].textContent==t.textContent&&(n=o[a]);null!=n&&"A"==n.nodeName&&(i=n.getAttribute("href")||"",l.selectNode(n));var s=l.cellEditor.saveSelection();e.showLinkDialog(i,mxResources.get("apply"),mxUtils.bind(this,function(e){l.cellEditor.restoreSelection(s),null!=e&&l.insertLink(e)}))}else l.isSelectionEmpty()?this.get("insertLink").funct():this.get("editLink").funct()}})).isEnabled=n,this.addAction("autosize",function(){var e=l.getSelectionCells();if(null!=e){l.getModel().beginUpdate();try{for(var t=0;t<e.length;t++){var n=e[t];if(l.getModel().getChildCount(n))l.updateGroupBounds([n],20);else{var i=l.view.getState(n),o=l.getCellGeometry(n);l.getModel().isVertex(n)&&null!=i&&null!=i.text&&null!=o&&l.isWrapping(n)?((o=o.clone()).height=i.text.boundingBox.height/l.view.scale,l.getModel().setGeometry(n,o)):l.updateCellSize(n)}}}finally{l.getModel().endUpdate()}}},null,null,Editor.ctrlKey+"+Shift+Y"),this.addAction("formattedText",function(){var t=l.getView().getState(l.getSelectionCell());if(null!=t){l.stopEditing();var n="1"==t.style.html?null:"1";l.getModel().beginUpdate();try{for(var i=l.getSelectionCells(),o=0;o<i.length;o++)if(state=l.getView().getState(i[o]),null!=state){var a=mxUtils.getValue(state.style,"html","0");if("1"==a&&null==n){var s=l.convertValueToString(state.cell);"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(s=s.replace(/\n/g,"").replace(/<br\s*.?>/g,"\n"));var d=document.createElement("div");d.innerHTML=l.sanitizeHtml(s),s=mxUtils.extractTextWithWhitespace(d.childNodes),l.cellLabelChanged(state.cell,s),l.setCellStyles("html",n,[i[o]])}else if("0"==a&&"1"==n){var s=mxUtils.htmlEntities(l.convertValueToString(state.cell),!1);"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(s=s.replace(/\n/g,"<br/>")),l.cellLabelChanged(state.cell,l.sanitizeHtml(s)),l.setCellStyles("html",n,[i[o]])}}e.fireEvent(new mxEventObject("styleChanged","keys",["html"],"values",[null!=n?n:"0"],"cells",i))}finally{l.getModel().endUpdate()}}}),this.addAction("wordWrap",function(){var e=l.getView().getState(l.getSelectionCell()),t="wrap";l.stopEditing(),null!=e&&"wrap"==e.style[mxConstants.STYLE_WHITE_SPACE]&&(t=null),l.setCellStyles(mxConstants.STYLE_WHITE_SPACE,t)}),this.addAction("rotation",function(){var t="0",n=l.getView().getState(l.getSelectionCell());null!=n&&(t=n.style[mxConstants.STYLE_ROTATION]||t);var i=new FilenameDialog(e,t,mxResources.get("apply"),function(e){null!=e&&e.length>0&&l.setCellStyles(mxConstants.STYLE_ROTATION,e)},mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)");e.showDialog(i.container,375,80,!0,!0),i.init()}),this.addAction("resetView",function(){l.zoomTo(1),e.resetScrollbars()},null,null,"Home"),this.addAction("zoomIn",function(t){l.isFastZoomEnabled()?l.lazyZoom(!0,!0,e.buttonZoomDelay):l.zoomIn()},null,null,Editor.ctrlKey+" + (Numpad) / Alt+Mousewheel"),this.addAction("zoomOut",function(t){l.isFastZoomEnabled()?l.lazyZoom(!1,!0,e.buttonZoomDelay):l.zoomOut()},null,null,Editor.ctrlKey+" - (Numpad) / Alt+Mousewheel"),this.addAction("fitWindow",function(){var t=l.isSelectionEmpty()?l.getGraphBounds():l.getBoundingBox(l.getSelectionCells()),n=l.view.translate,i=l.view.scale;t.x=t.x/i-n.x,t.y=t.y/i-n.y,t.width/=i,t.height/=i,null!=l.backgroundImage&&t.add(new mxRectangle(0,0,l.backgroundImage.width,l.backgroundImage.height)),0==t.width||0==t.height?(l.zoomTo(1),e.resetScrollbars()):l.fitWindow(t)},null,null,Editor.ctrlKey+"+Shift+H"),this.addAction("fitPage",mxUtils.bind(this,function(){l.pageVisible||this.get("pageView").funct();var e=l.pageFormat,t=l.pageScale,n=l.container.clientWidth-10,i=l.container.clientHeight-10,o=Math.floor(20*Math.min(n/e.width/t,i/e.height/t))/20;if(l.zoomTo(o),mxUtils.hasScrollbars(l.container)){var a=l.getPagePadding();l.container.scrollTop=a.y*l.view.scale-1,l.container.scrollLeft=Math.min(a.x*l.view.scale,(l.container.scrollWidth-l.container.clientWidth)/2)-1}}),null,null,Editor.ctrlKey+"+J"),this.addAction("fitTwoPages",mxUtils.bind(this,function(){l.pageVisible||this.get("pageView").funct();var e=l.pageFormat,t=l.pageScale,n=l.container.clientWidth-10,i=l.container.clientHeight-10,o=Math.floor(20*Math.min(n/(2*e.width)/t,i/e.height/t))/20;if(l.zoomTo(o),mxUtils.hasScrollbars(l.container)){var a=l.getPagePadding();l.container.scrollTop=Math.min(a.y,(l.container.scrollHeight-l.container.clientHeight)/2),l.container.scrollLeft=Math.min(a.x,(l.container.scrollWidth-l.container.clientWidth)/2)}}),null,null,Editor.ctrlKey+"+Shift+J"),this.addAction("fitPageWidth",mxUtils.bind(this,function(){l.pageVisible||this.get("pageView").funct();var e=l.pageFormat,t=l.pageScale,n=Math.floor(20*(l.container.clientWidth-10)/e.width/t)/20;if(l.zoomTo(n),mxUtils.hasScrollbars(l.container)){var i=l.getPagePadding();l.container.scrollLeft=Math.min(i.x*l.view.scale,(l.container.scrollWidth-l.container.clientWidth)/2)}})),this.put("customZoom",new Action(mxResources.get("custom")+"...",mxUtils.bind(this,function(){var e=new FilenameDialog(this.editorUi,parseInt(100*l.getView().getScale()),mxResources.get("apply"),mxUtils.bind(this,function(e){var t=parseInt(e);!isNaN(t)&&t>0&&l.zoomTo(t/100)}),mxResources.get("zoom")+" (%)");this.editorUi.showDialog(e.container,300,80,!0,!0),e.init()}),null,null,Editor.ctrlKey+"+0")),this.addAction("pageScale...",mxUtils.bind(this,function(){var t=new FilenameDialog(this.editorUi,parseInt(100*l.pageScale),mxResources.get("apply"),mxUtils.bind(this,function(t){var n=parseInt(t);if(!isNaN(n)&&n>0){var i=new ChangePageSetup(e,null,null,null,n/100);i.ignoreColor=!0,i.ignoreImage=!0,l.model.execute(i)}}),mxResources.get("pageScale")+" (%)");this.editorUi.showDialog(t.container,300,80,!0,!0),t.init()}));var i=null;(i=this.addAction("grid",function(){l.setGridEnabled(!l.isGridEnabled()),e.fireEvent(new mxEventObject("gridEnabledChanged"))},null,null,Editor.ctrlKey+"+Shift+G")).setToggleAction(!0),i.setSelectedCallback(function(){return l.isGridEnabled()}),i.setEnabled(!1),(i=this.addAction("guides",function(){l.graphHandler.guidesEnabled=!l.graphHandler.guidesEnabled,e.fireEvent(new mxEventObject("guidesEnabledChanged"))})).setToggleAction(!0),i.setSelectedCallback(function(){return l.graphHandler.guidesEnabled}),i.setEnabled(!1),(i=this.addAction("tooltips",function(){l.tooltipHandler.setEnabled(!l.tooltipHandler.isEnabled()),e.fireEvent(new mxEventObject("tooltipsEnabledChanged"))})).setToggleAction(!0),i.setSelectedCallback(function(){return l.tooltipHandler.isEnabled()}),(i=this.addAction("collapseExpand",function(){var t=new ChangePageSetup(e);t.ignoreColor=!0,t.ignoreImage=!0,t.foldingEnabled=!l.foldingEnabled,l.model.execute(t)})).setToggleAction(!0),i.setSelectedCallback(function(){return l.foldingEnabled}),i.isEnabled=n,(i=this.addAction("scrollbars",function(){e.setScrollbars(!e.hasScrollbars())})).setToggleAction(!0),i.setSelectedCallback(function(){return l.scrollbars}),(i=this.addAction("pageView",mxUtils.bind(this,function(){e.setPageVisible(!l.pageVisible)}))).setToggleAction(!0),i.setSelectedCallback(function(){return l.pageVisible}),(i=this.addAction("connectionArrows",function(){l.connectionArrowsEnabled=!l.connectionArrowsEnabled,e.fireEvent(new mxEventObject("connectionArrowsChanged"))},null,null,"Alt+Shift+A")).setToggleAction(!0),i.setSelectedCallback(function(){return l.connectionArrowsEnabled}),(i=this.addAction("connectionPoints",function(){l.setConnectable(!l.connectionHandler.isEnabled()),e.fireEvent(new mxEventObject("connectionPointsChanged"))},null,null,"Alt+Shift+P")).setToggleAction(!0),i.setSelectedCallback(function(){return l.connectionHandler.isEnabled()}),(i=this.addAction("copyConnect",function(){l.connectionHandler.setCreateTarget(!l.connectionHandler.isCreateTarget()),e.fireEvent(new mxEventObject("copyConnectChanged"))})).setToggleAction(!0),i.setSelectedCallback(function(){return l.connectionHandler.isCreateTarget()}),i.isEnabled=n,(i=this.addAction("autosave",function(){e.editor.setAutosave(!e.editor.autosave)})).setToggleAction(!0),i.setSelectedCallback(function(){return e.editor.autosave}),i.isEnabled=n,i.visible=!1;var o=!1;this.put("about",new Action(mxResources.get("about")+" Graph Editor...",function(){o||(e.showDialog(new AboutDialog(e).container,320,280,!0,!0,function(){o=!1}),o=!0)}));var a=mxUtils.bind(this,function(e,t,n,i){return this.addAction(e,function(){if(null!=n&&l.cellEditor.isContentEditing())n();else{l.stopEditing(!1),l.getModel().beginUpdate();try{var e=l.getSelectionCells();l.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,t,e),(t&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?l.updateLabelElements(l.getSelectionCells(),function(e){e.style.fontWeight=null,"B"==e.nodeName&&l.replaceElement(e)}):(t&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?l.updateLabelElements(l.getSelectionCells(),function(e){e.style.fontStyle=null,"I"==e.nodeName&&l.replaceElement(e)}):(t&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&l.updateLabelElements(l.getSelectionCells(),function(e){e.style.textDecoration=null,"U"==e.nodeName&&l.replaceElement(e)});for(var i=0;i<e.length;i++)0==l.model.getChildCount(e[i])&&l.autoSizeCell(e[i],!1)}finally{l.getModel().endUpdate()}}},null,null,i)});a("bold",mxConstants.FONT_BOLD,function(){document.execCommand("bold",!1,null)},Editor.ctrlKey+"+B"),a("italic",mxConstants.FONT_ITALIC,function(){document.execCommand("italic",!1,null)},Editor.ctrlKey+"+I"),a("underline",mxConstants.FONT_UNDERLINE,function(){document.execCommand("underline",!1,null)},Editor.ctrlKey+"+U"),this.addAction("fontColor...",function(){e.menus.pickColor(mxConstants.STYLE_FONTCOLOR,"forecolor","000000")}),this.addAction("strokeColor...",function(){e.menus.pickColor(mxConstants.STYLE_STROKECOLOR)}),this.addAction("fillColor...",function(){e.menus.pickColor(mxConstants.STYLE_FILLCOLOR)}),this.addAction("gradientColor...",function(){e.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)}),this.addAction("backgroundColor...",function(){e.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"backcolor")}),this.addAction("borderColor...",function(){e.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)}),this.addAction("vertical",function(){e.menus.toggleStyle(mxConstants.STYLE_HORIZONTAL,!0)}),this.addAction("shadow",function(){e.menus.toggleStyle(mxConstants.STYLE_SHADOW)}),this.addAction("solid",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_DASHED,null),l.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",[null,null],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("dashed",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_DASHED,"1"),l.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1",null],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("dotted",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_DASHED,"1"),l.setCellStyles(mxConstants.STYLE_DASH_PATTERN,"1 4"),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1","1 4"],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("sharp",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),l.setCellStyles(mxConstants.STYLE_CURVED,"0"),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","0"],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("rounded",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_ROUNDED,"1"),l.setCellStyles(mxConstants.STYLE_CURVED,"0"),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["1","0"],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("toggleRounded",function(){if(!l.isSelectionEmpty()&&l.isEnabled()){l.getModel().beginUpdate();try{var t=l.getSelectionCells(),n=l.getCurrentCellStyle(t[0]),i="1"==mxUtils.getValue(n,mxConstants.STYLE_ROUNDED,"0")?"0":"1";l.setCellStyles(mxConstants.STYLE_ROUNDED,i),l.setCellStyles(mxConstants.STYLE_CURVED,null),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",[i,"0"],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}}),this.addAction("curved",function(){l.getModel().beginUpdate();try{l.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),l.setCellStyles(mxConstants.STYLE_CURVED,"1"),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","1"],"cells",l.getSelectionCells()))}finally{l.getModel().endUpdate()}}),this.addAction("collapsible",function(){var t=l.view.getState(l.getSelectionCell()),n="1";null!=t&&null!=l.getFoldingImage(t)&&(n="0"),l.setCellStyles("collapsible",n),e.fireEvent(new mxEventObject("styleChanged","keys",["collapsible"],"values",[n],"cells",l.getSelectionCells()))}),this.addAction("editStyle...",mxUtils.bind(this,function(){var e=l.getSelectionCells();if(null!=e&&e.length>0){var t=l.getModel(),n=new TextareaDialog(this.editorUi,mxResources.get("editStyle")+":",t.getStyle(e[0])||"",function(t){null!=t&&l.setCellStyle(mxUtils.trim(t),e)},null,null,400,220);this.editorUi.showDialog(n.container,420,300,!0,!0),n.init()}}),null,null,Editor.ctrlKey+"+E"),this.addAction("setAsDefaultStyle",function(){l.isEnabled()&&!l.isSelectionEmpty()&&e.setDefaultStyle(l.getSelectionCell())},null,null,Editor.ctrlKey+"+Shift+D"),this.addAction("clearDefaultStyle",function(){l.isEnabled()&&e.clearDefaultStyle()},null,null,Editor.ctrlKey+"+Shift+R"),this.addAction("addWaypoint",function(){var e=l.getSelectionCell();if(null!=e&&l.getModel().isEdge(e)){var n=t.graph.selectionCellsHandler.getHandler(e);if(n instanceof mxEdgeHandler){for(var i=l.view.translate,o=l.view.scale,a=i.x,s=i.y,d=l.getModel().getParent(e),c=l.getCellGeometry(d);l.getModel().isVertex(d)&&null!=c;)a+=c.x,s+=c.y,d=l.getModel().getParent(d),c=l.getCellGeometry(d);var r=Math.round(l.snap(l.popupMenuHandler.triggerX/o-a)),u=Math.round(l.snap(l.popupMenuHandler.triggerY/o-s));n.addPointAt(n.state,r,u)}}}),this.addAction("removeWaypoint",function(){var t=e.actions.get("removeWaypoint");null!=t.handler&&t.handler.removePoint(t.handler.state,t.index)}),this.addAction("clearWaypoints",function(){var e=l.getSelectionCells();if(null!=e){e=l.addAllEdges(e),l.getModel().beginUpdate();try{for(var t=0;t<e.length;t++){var n=e[t];if(l.getModel().isEdge(n)){var i=l.getCellGeometry(n);null!=i&&((i=i.clone()).points=null,l.getModel().setGeometry(n,i))}}}finally{l.getModel().endUpdate()}}},null,null,"Alt+Shift+C"),i=this.addAction("subscript",mxUtils.bind(this,function(){l.cellEditor.isContentEditing()&&document.execCommand("subscript",!1,null)}),null,null,Editor.ctrlKey+"+,"),i=this.addAction("superscript",mxUtils.bind(this,function(){l.cellEditor.isContentEditing()&&document.execCommand("superscript",!1,null)}),null,null,Editor.ctrlKey+"+."),i=this.addAction("indent",mxUtils.bind(this,function(){l.cellEditor.isContentEditing()&&document.execCommand("indent",!1,null)}),null,null,"Shift+Tab"),this.addAction("image...",function(){if(l.isEnabled()&&!l.isCellLocked(l.getDefaultParent())){var t=l.getView().getState(l.getSelectionCell()),n="";null!=t&&(n=t.style[mxConstants.STYLE_IMAGE]||n);var i=l.cellEditor.saveSelection();e.showImageDialog(n,function(e,t,n){if(l.cellEditor.isContentEditing())l.cellEditor.restoreSelection(i),l.insertImage(e,t,n);else{var o=l.getSelectionCells();if(null!=e&&(e.length>0||o.length>0)){var a=null;l.getModel().beginUpdate();try{if(0==o.length){o=[l.insertVertex(l.getDefaultParent(),null,"",0,0,t,n,"shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;")];var s=l.getCenterInsertPoint(l.getBoundingBoxFromGeometry(o,!0));o[0].geometry.x=s.x,o[0].geometry.y=s.y,a=o,l.fireEvent(new mxEventObject("cellsInserted","cells",a))}l.setCellStyles(mxConstants.STYLE_IMAGE,e.length>0?e:null,o);var d=l.getCurrentCellStyle(o[0]);if("image"!=d[mxConstants.STYLE_SHAPE]&&"label"!=d[mxConstants.STYLE_SHAPE]?l.setCellStyles(mxConstants.STYLE_SHAPE,"image",o):0==e.length&&l.setCellStyles(mxConstants.STYLE_SHAPE,null,o),1==l.getSelectionCount()&&null!=t&&null!=n){var c=o[0],r=l.getModel().getGeometry(c);null!=r&&((r=r.clone()).width=t,r.height=n,l.getModel().setGeometry(c,r))}}finally{l.getModel().endUpdate()}null!=a&&(l.setSelectionCells(a),l.scrollCellToVisible(a[0]))}}},l.cellEditor.isContentEditing(),!l.cellEditor.isContentEditing())}}).isEnabled=n,(i=this.addAction("layers",mxUtils.bind(this,function(){null==this.layersWindow?(this.layersWindow=new LayersWindow(e,document.body.offsetWidth-280,120,220,196),this.layersWindow.window.addListener("show",function(){e.fireEvent(new mxEventObject("layers"))}),this.layersWindow.window.addListener("hide",function(){e.fireEvent(new mxEventObject("layers"))}),this.layersWindow.window.setVisible(!0),e.fireEvent(new mxEventObject("layers")),this.layersWindow.init()):this.layersWindow.window.setVisible(!this.layersWindow.window.isVisible())}),null,null,Editor.ctrlKey+"+Shift+L")).setToggleAction(!0),i.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.layersWindow&&this.layersWindow.window.isVisible()})),(i=this.addAction("formatPanel",mxUtils.bind(this,function(){e.toggleFormatPanel()}),null,null,Editor.ctrlKey+"+Shift+P")).setToggleAction(!0),i.setSelectedCallback(mxUtils.bind(this,function(){return e.formatWidth>0})),(i=this.addAction("outline",mxUtils.bind(this,function(){null==this.outlineWindow?(this.outlineWindow=new OutlineWindow(e,document.body.offsetWidth-260,100,180,180),this.outlineWindow.window.addListener("show",function(){e.fireEvent(new mxEventObject("outline"))}),this.outlineWindow.window.addListener("hide",function(){e.fireEvent(new mxEventObject("outline"))}),this.outlineWindow.window.setVisible(!0),e.fireEvent(new mxEventObject("outline"))):this.outlineWindow.window.setVisible(!this.outlineWindow.window.isVisible())}),null,null,Editor.ctrlKey+"+Shift+O")).setToggleAction(!0),i.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.outlineWindow&&this.outlineWindow.window.isVisible()}))},Actions.prototype.addAction=function(e,t,l,n,i){var o;return"..."==e.substring(e.length-3)?(e=e.substring(0,e.length-3),o=mxResources.get(e)+"..."):o=mxResources.get(e),this.put(e,new Action(o,t,l,n,i))},Actions.prototype.put=function(e,t){return this.actions[e]=t,t},Actions.prototype.get=function(e){return this.actions[e]},mxUtils.extend(Action,mxEventSource),Action.prototype.createFunction=function(e){return e},Action.prototype.setEnabled=function(e){this.enabled!=e&&(this.enabled=e,this.fireEvent(new mxEventObject("stateChanged")))},Action.prototype.isEnabled=function(){return this.enabled},Action.prototype.setToggleAction=function(e){this.toggleAction=e},Action.prototype.setSelectedCallback=function(e){this.selectedCallback=e},Action.prototype.isSelected=function(){return this.selectedCallback()};
