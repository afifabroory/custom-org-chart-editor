/**
 * Copyright (c) 2006-2012, JGraph Ltd
 */
function ChangeGridColor(e,t){this.ui=e,this.color=t}function ChangePageSetup(e,t,i,n,o){this.ui=e,this.color=t,this.previousColor=t,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.pageScale=o,this.previousPageScale=o,this.ignoreColor=!1,this.ignoreImage=!1}EditorUi=function(e,t,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=e||new Editor,this.container=t||document.body;var n=this.editor.graph;if(n.lightbox=i,this.initialDefaultVertexStyle=mxUtils.clone(n.defaultVertexStyle),this.initialDefaultEdgeStyle=mxUtils.clone(n.defaultEdgeStyle),n.useCssTransforms&&(this.lazyZoomDelay=0),mxClient.IS_SVG?mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs=":new Image().src=mxPopupMenu.prototype.submenuImage,mxClient.IS_SVG||null==mxConnectionHandler.prototype.connectImage||(new Image().src=mxConnectionHandler.prototype.connectImage.src),this.editor.chromeless&&!this.editor.editable&&(this.footerHeight=0,n.isEnabled=function(){return!1},n.panningHandler.isForcePanningEvent=function(e){return!mxEvent.isPopupTrigger(e.getEvent())}),this.actions=new Actions(this),this.menus=this.createMenus(),!n.standalone){this.createDivs(),this.createUi(),this.refresh();var o=mxUtils.bind(this,function(e){return null==e&&(e=window.event),n.isEditing()||null!=e&&this.isSelectionAllowed(e)});if(this.container==document.body&&(this.menubarContainer.onselectstart=o,this.menubarContainer.onmousedown=o,this.toolbarContainer.onselectstart=o,this.toolbarContainer.onmousedown=o,this.diagramContainer.onselectstart=o,this.diagramContainer.onmousedown=o,this.sidebarContainer.onselectstart=o,this.sidebarContainer.onmousedown=o,this.formatContainer.onselectstart=o,this.formatContainer.onmousedown=o,this.footerContainer.onselectstart=o,this.footerContainer.onmousedown=o,null!=this.tabContainer&&(this.tabContainer.onselectstart=o)),!this.editor.chromeless||this.editor.editable){var r=function(e){if(null!=e){var t=mxEvent.getSource(e);if("A"==t.nodeName)for(;null!=t;){if("geHint"==t.className)return!0;t=t.parentNode}}return o(e)};mxClient.IS_IE&&(void 0===document.documentMode||document.documentMode<9)?mxEvent.addListener(this.diagramContainer,"contextmenu",r):this.diagramContainer.oncontextmenu=r}else n.panningHandler.usePopupTrigger=!1;if(n.init(this.diagramContainer),mxClient.IS_SVG&&null!=n.view.getDrawPane()){var l=n.view.getDrawPane().ownerSVGElement;null!=l&&(l.style.position="absolute")}if(this.hoverIcons=this.createHoverIcons(),null!=n.graphHandler){var s=n.graphHandler.start;n.graphHandler.start=function(){null!=b.hoverIcons&&b.hoverIcons.reset(),s.apply(this,arguments)}}mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(e){var t=mxUtils.getOffset(this.diagramContainer);mxEvent.getClientX(e)-t.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(e)-t.y-this.diagramContainer.clientHeight>0?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")}));var a=!1,h=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(e,t){return a||h.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,function(e){32!=e.which||n.isEditing()?mxEvent.isConsumed(e)||27!=e.keyCode||this.hideDialog(null,!0):(a=!0,this.hoverIcons.reset(),n.container.style.cursor="move",n.isEditing()||mxEvent.getSource(e)!=n.container||mxEvent.consume(e))}),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,function(e){n.container.style.cursor="",a=!1}),mxEvent.addListener(document,"keyup",this.keyupHandler);var d=n.panningHandler.isForcePanningEvent;n.panningHandler.isForcePanningEvent=function(e){return d.apply(this,arguments)||a||mxEvent.isMouseEvent(e.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(e.getEvent()))&&(!mxEvent.isControlDown(e.getEvent())&&mxEvent.isRightMouseButton(e.getEvent())||mxEvent.isMiddleMouseButton(e.getEvent()))};var c=n.cellEditor.isStopEditingEvent;n.cellEditor.isStopEditingEvent=function(e){return c.apply(this,arguments)||13==e.keyCode&&(!mxClient.IS_SF&&mxEvent.isControlDown(e)||mxClient.IS_MAC&&mxEvent.isMetaDown(e)||mxClient.IS_SF&&mxEvent.isShiftDown(e))};var u=n.isZoomWheelEvent;n.isZoomWheelEvent=function(){return a||u.apply(this,arguments)};var g=!1,p=null,f=null,m=null,y=mxUtils.bind(this,function(){if(null!=this.toolbar&&g!=n.cellEditor.isContentEditing()){for(var e=this.toolbar.container.firstChild,t=[];null!=e;){var i=e.nextSibling;0>mxUtils.indexOf(this.toolbar.staticElements,e)&&(e.parentNode.removeChild(e),t.push(e)),e=i}var o=this.toolbar.fontMenu,r=this.toolbar.sizeMenu;if(null==m)this.toolbar.createTextToolbar();else{for(var l=0;l<m.length;l++)this.toolbar.container.appendChild(m[l]);this.toolbar.fontMenu=p,this.toolbar.sizeMenu=f}g=n.cellEditor.isContentEditing(),p=o,f=r,m=t}}),b=this,v=n.cellEditor.startEditing;n.cellEditor.startEditing=function(){if(v.apply(this,arguments),y(),n.cellEditor.isContentEditing()){var e=!1,t=function(){e||(e=!0,window.setTimeout(function(){var t=n.getSelectedEditingElement();if(null!=t){var i=mxUtils.getCurrentStyle(t);null!=i&&null!=b.toolbar&&(b.toolbar.setFontName(Graph.stripQuotes(i.fontFamily)),b.toolbar.setFontSize(parseInt(i.fontSize)))}e=!1},0))};mxEvent.addListener(n.cellEditor.textarea,"input",t),mxEvent.addListener(n.cellEditor.textarea,"touchend",t),mxEvent.addListener(n.cellEditor.textarea,"mouseup",t),mxEvent.addListener(n.cellEditor.textarea,"keyup",t),t()}};var S=n.cellEditor.stopEditing;if(n.cellEditor.stopEditing=function(e,t){try{S.apply(this,arguments),y()}catch(i){b.handleError(i)}},n.container.setAttribute("tabindex","0"),n.container.style.cursor="default",window.self===window.top&&null!=n.container.parentNode)try{n.container.focus()}catch(C){}var $=n.fireMouseEvent;n.fireMouseEvent=function(e,t,i){e==mxEvent.MOUSE_DOWN&&this.container.focus(),$.apply(this,arguments)},n.popupMenuHandler.autoExpand=!0,null!=this.menus&&(n.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(e,t,i){this.menus.createPopupMenu(e,t,i)})),mxEvent.addGestureListeners(document,mxUtils.bind(this,function(e){n.popupMenuHandler.hideMenu()})),this.keyHandler=this.createKeyHandler(e),this.getKeyHandler=function(){return keyHandler};var w=["rounded","shadow","glass","dashed","dashPattern","labelBackgroundColor","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle"],E=["shape","edgeStyle","curved","rounded","elbow","jumpStyle","jumpSize","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle"];this.setDefaultStyle=function(e){try{var t=n.view.getState(e);if(null!=t){var i=e.clone();i.style="";var o=n.getCellStyle(i),r=[],l=[];for(var s in t.style)o[s]!=t.style[s]&&(r.push(t.style[s]),l.push(s));for(var a=n.getModel().getStyle(t.cell),h=null!=a?a.split(";"):[],d=0;d<h.length;d++){var c=h[d],u=c.indexOf("=");if(u>=0){var s=c.substring(0,u),g=c.substring(u+1);null!=o[s]&&"none"==g&&(r.push(g),l.push(s))}}n.getModel().isEdge(t.cell)?n.currentEdgeStyle={}:n.currentVertexStyle={},this.fireEvent(new mxEventObject("styleChanged","keys",l,"values",r,"cells",[t.cell]))}}catch(p){this.handleError(p)}},this.clearDefaultStyle=function(){n.currentEdgeStyle=mxUtils.clone(n.defaultEdgeStyle),n.currentVertexStyle=mxUtils.clone(n.defaultVertexStyle),this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};for(var x=["fontFamily","fontSource","fontSize","fontColor"],_=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize"],k=[["startArrow","startFill","startSize","sourcePerimeterSpacing","endArrow","endFill","endSize","targetPerimeterSpacing"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],x,["opacity"],["align"],["html"]],T=0;T<k.length;T++)for(var A=0;A<k[T].length;A++)w.push(k[T][A]);for(var T=0;T<E.length;T++)0>mxUtils.indexOf(w,E[T])&&w.push(E[T]);var L=function(e,t,i){(i=null!=i?i:n.getModel()).beginUpdate();try{for(var o=0;o<e.length;o++){var r,l=e[o];if(t)r=["fontSize","fontFamily","fontColor"];else{var s=i.getStyle(l),a=null!=s?s.split(";"):[];r=w.slice();for(var h=0;h<a.length;h++){var d=a[h],c=d.indexOf("=");if(c>=0){var u=d.substring(0,c),g=mxUtils.indexOf(r,u);g>=0&&r.splice(g,1);for(var p=0;p<k.length;p++){var f=k[p];if(mxUtils.indexOf(f,u)>=0)for(var m=0;m<f.length;m++){var y=mxUtils.indexOf(r,f[m]);y>=0&&r.splice(y,1)}}}}}for(var b=i.isEdge(l),v=b?n.currentEdgeStyle:n.currentVertexStyle,S=i.getStyle(l),h=0;h<r.length;h++){var u=r[h],C=v[u];null!=C&&("shape"!=u||b)&&(!b||0>mxUtils.indexOf(E,u))&&(S=mxUtils.setStyle(S,u,C))}i.setStyle(l,S)}}finally{i.endUpdate()}};if(n.addListener("cellsInserted",function(e,t){L(t.getProperty("cells"))}),n.addListener("textInserted",function(e,t){L(t.getProperty("cells"),!0)}),this.insertHandler=L,n.connectionHandler.addListener(mxEvent.CONNECT,function(e,t){var i=[t.getProperty("cell")];t.getProperty("terminalInserted")&&i.push(t.getProperty("terminal")),L(i)}),this.addListener("styleChanged",mxUtils.bind(this,function(e,t){var i=t.getProperty("cells"),o=!1,r=!1;if(i.length>0)for(var l=0;l<i.length&&(o=n.getModel().isVertex(i[l])||o,!(r=n.getModel().isEdge(i[l])||r)||!o);l++);else o=!0,r=!0;for(var s=t.getProperty("keys"),a=t.getProperty("values"),l=0;l<s.length;l++){var h=mxUtils.indexOf(x,s[l])>=0;("strokeColor"!=s[l]||null!=a[l]&&"none"!=a[l])&&(mxUtils.indexOf(E,s[l])>=0?r||mxUtils.indexOf(_,s[l])>=0?null==a[l]?delete n.currentEdgeStyle[s[l]]:n.currentEdgeStyle[s[l]]=a[l]:o&&mxUtils.indexOf(w,s[l])>=0&&(null==a[l]?delete n.currentVertexStyle[s[l]]:n.currentVertexStyle[s[l]]=a[l]):mxUtils.indexOf(w,s[l])>=0&&((o||h)&&(null==a[l]?delete n.currentVertexStyle[s[l]]:n.currentVertexStyle[s[l]]=a[l]),(r||h||mxUtils.indexOf(_,s[l])>=0)&&(null==a[l]?delete n.currentEdgeStyle[s[l]]:n.currentEdgeStyle[s[l]]=a[l])))}if(null!=this.toolbar){if(this.toolbar.setFontName(n.currentVertexStyle.fontFamily||Menus.prototype.defaultFont),this.toolbar.setFontSize(n.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu){var d=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];"orthogonalEdgeStyle"==n.currentEdgeStyle.edgeStyle&&"1"==n.currentEdgeStyle.curved?d.className="geSprite geSprite-curved":"straight"==n.currentEdgeStyle.edgeStyle||"none"==n.currentEdgeStyle.edgeStyle||null==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-entity":"elbowEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==n.currentEdgeStyle.edgeStyle?d.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):d.className="geSprite geSprite-orthogonal"}if(null!=this.toolbar.edgeShapeMenu){var c=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];"link"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-linkedge":"flexArrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-arrow":"arrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-simplearrow":c.className="geSprite geSprite-connection"}null!=this.toolbar.lineStartMenu&&(this.toolbar.lineStartMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("start",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(n.currentEdgeStyle,"startFill","1"))),null!=this.toolbar.lineEndMenu&&(this.toolbar.lineEndMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("end",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(n.currentEdgeStyle,"endFill","1")))}})),null!=this.toolbar){var P=mxUtils.bind(this,function(){var e=n.currentVertexStyle.fontFamily||"Helvetica",t=String(n.currentVertexStyle.fontSize||"12"),i=n.getView().getState(n.getSelectionCell());null!=i&&(e=i.style[mxConstants.STYLE_FONTFAMILY]||e,t=i.style[mxConstants.STYLE_FONTSIZE]||t,e.length>10&&(e=e.substring(0,8)+"...")),this.toolbar.setFontName(e),this.toolbar.setFontSize(t)});n.getSelectionModel().addListener(mxEvent.CHANGE,P),n.getModel().addListener(mxEvent.CHANGE,P)}n.addListener(mxEvent.CELLS_ADDED,function(e,t){var i=t.getProperty("cells"),o=t.getProperty("parent");n.getModel().isLayer(o)&&!n.isCellVisible(o)&&null!=i&&i.length>0&&n.getModel().setVisible(o,!0)}),this.gestureHandler=mxUtils.bind(this,function(e){null!=this.currentMenu&&mxEvent.getSource(e)!=this.currentMenu.div&&this.hideCurrentMenu()}),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){null!=this.editor.graph&&this.refresh()}),0)}),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()}),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),mxClient.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)}),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()})),this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),n.addListener("gridSizeChanged",mxUtils.bind(this,function(){n.isGridEnabled()&&n.view.validateBackground()})),this.editor.resetGraph()}this.init(),n.standalone||this.open()},mxUtils.extend(EditorUi,mxEventSource),EditorUi.compactUi=!0,EditorUi.prototype.splitSize=mxClient.IS_TOUCH||mxClient.IS_POINTER?12:8,EditorUi.prototype.menubarHeight=30,EditorUi.prototype.formatEnabled=!0,EditorUi.prototype.formatWidth=240,EditorUi.prototype.toolbarHeight=38,EditorUi.prototype.footerHeight=28,EditorUi.prototype.sidebarFooterHeight=34,EditorUi.prototype.hsplitPosition=screen.width<=640?118:"large"!=urlParams["sidebar-entries"]?212:240,EditorUi.prototype.allowAnimation=!0,EditorUi.prototype.lightboxMaxFitScale=2,EditorUi.prototype.lightboxVerticalDivider=4,EditorUi.prototype.hsplitClickEnabled=!1,EditorUi.prototype.init=function(){var e=this.editor.graph;if(!e.standalone){"0"!=urlParams["shape-picker"]&&this.installShapePicker(),mxEvent.addListener(e.container,"scroll",mxUtils.bind(this,function(){e.tooltipHandler.hide(),null!=e.connectionHandler&&null!=e.connectionHandler.constraintHandler&&e.connectionHandler.constraintHandler.reset()})),e.addListener(mxEvent.ESCAPE,mxUtils.bind(this,function(){e.tooltipHandler.hide();var t=e.getRubberband();null!=t&&t.cancel()})),mxEvent.addListener(e.container,"keydown",mxUtils.bind(this,function(e){this.onKeyDown(e)})),mxEvent.addListener(e.container,"keypress",mxUtils.bind(this,function(e){this.onKeyPress(e)})),this.addUndoListener(),this.addBeforeUnloadListener(),e.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),e.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var t=e.setDefaultParent,i=this;this.editor.graph.setDefaultParent=function(){t.apply(this,arguments),i.updateActionStates()},e.editLink=i.actions.get("editLink").funct,this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init()}},EditorUi.prototype.installShapePicker=function(){var e=this.editor.graph,t=this;e.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,function(e,i){"mouseDown"==i.getProperty("eventName")&&t.hideShapePicker()})),e.addListener(mxEvent.ESCAPE,mxUtils.bind(this,function(){t.hideShapePicker(!0)})),e.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){t.hideShapePicker(!0)})),e.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){t.hideShapePicker(!0)}));var i=e.popupMenuHandler.isMenuShowing;e.popupMenuHandler.isMenuShowing=function(){return i.apply(this,arguments)||null!=t.shapePicker};var n=e.dblClick;if(e.dblClick=function(e,i){if(this.isEnabled()){if(null!=i||null==t.sidebar||mxEvent.isShiftDown(e))n.apply(this,arguments);else{mxEvent.consume(e);var o=mxUtils.convertPoint(this.container,mxEvent.getClientX(e),mxEvent.getClientY(e));window.setTimeout(mxUtils.bind(this,function(){t.showShapePicker(o.x,o.y)}),30)}}},null!=this.hoverIcons){var o=this.hoverIcons.drag;this.hoverIcons.drag=function(){t.hideShapePicker(),o.apply(this,arguments)};var r=this.hoverIcons.execute;this.hoverIcons.execute=function(i,n,o){var l=o.getEvent();this.graph.isCloneEvent(l)||mxEvent.isShiftDown(l)?r.apply(this,arguments):this.graph.connectVertex(i.cell,n,this.graph.defaultEdgeLength,l,null,null,mxUtils.bind(this,function(r,l,s){var a=e.getCompositeParent(i.cell),h=e.getCellGeometry(a);for(o.consume();null!=a&&e.model.isVertex(a)&&null!=h&&h.relative;)cell=a,a=e.model.getParent(cell),h=e.getCellGeometry(a);window.setTimeout(mxUtils.bind(this,function(){t.showShapePicker(o.getGraphX(),o.getGraphY(),a,mxUtils.bind(this,function(e){s(e)}),n)}),30)}),mxUtils.bind(this,function(e){this.graph.selectCellsForConnectVertex(e,l,this)}))}}},EditorUi.prototype.showShapePicker=function(e,t,i,n,o){var r=this.getCellsForShapePicker(i);if(null!=r&&r.length>0){var l=this,s=this.editor.graph,a=document.createElement("div"),h=s.view.getState(i),d=null==i||null!=h&&s.isTransparentState(h)?null:s.copyStyle(i);a.className="geToolbarContainer geSidebarContainer geSidebar",a.style.cssText="position:absolute;left:"+e+"px;top:"+t+"px;width:140px;border-radius:10px;padding:4px;text-align:center;box-shadow:0px 0px 3px 1px #d1d1d1;padding: 6px 0 8px 0;",mxUtils.setPrefixedStyle(a.style,"transform","translate(-22px,-22px)"),null!=s.background&&s.background!=mxConstants.NONE&&(a.style.backgroundColor=s.background),s.container.appendChild(a);for(var c=mxUtils.bind(this,function(i){var o=document.createElement("a");o.className="geItem",o.style.cssText="position:relative;display:inline-block;position:relative;width:30px;height:30px;cursor:pointer;overflow:hidden;padding:3px 0 0 3px;",a.appendChild(o),null!=d?this.sidebar.graph.pasteStyle(d,[i]):l.insertHandler([i],""!=i.value,this.sidebar.graph.model),this.sidebar.createThumb([i],25,25,o,null,!0,!1,i.geometry.width,i.geometry.height),mxEvent.addListener(o,"click",function(){var o=s.cloneCell(i);if(null!=n)n(o);else{o.geometry.x=s.snap(Math.round(e/s.view.scale)-s.view.translate.x-i.geometry.width/2),o.geometry.y=s.snap(Math.round(t/s.view.scale)-s.view.translate.y-i.geometry.height/2),s.model.beginUpdate();try{s.addCell(o)}finally{s.model.endUpdate()}s.setSelectionCell(o),s.scrollCellToVisible(o),s.startEditingAtCell(o),null!=l.hoverIcons&&l.hoverIcons.update(s.view.getState(o))}l.hideShapePicker()})}),u=0;u<r.length;u++)c(r[u]);null!=l.hoverIcons&&l.hoverIcons.reset(),s.popupMenuHandler.hideMenu(),s.tooltipHandler.hideTooltip(),this.hideCurrentMenu(),this.hideShapePicker(),this.shapePickerCallback=n,this.shapePicker=a}},EditorUi.prototype.getCellsForShapePicker=function(e){var t=mxUtils.bind(this,function(e,t,i,n){return this.editor.graph.createVertex(null,null,n||"",0,0,t||120,i||60,e,!1)});return[null!=e?this.editor.graph.cloneCell(e):t("text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;",40,20,"Text"),t("whiteSpace=wrap;html=1;"),t("ellipse;whiteSpace=wrap;html=1;",120,80),t("rhombus;whiteSpace=wrap;html=1;",80,80),t("shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;"),t("shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,60),t("shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;",120,80),t("shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,80),t("shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;"),t("shape=cube;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;darkOpacity=0.05;darkOpacity2=0.1;",120,80),t("shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;",80,100),t("triangle;whiteSpace=wrap;html=1;",60,80),t("shape=document;whiteSpace=wrap;html=1;boundedLbl=1;",120,80),t("shape=tape;whiteSpace=wrap;html=1;",120,100),t("ellipse;shape=cloud;whiteSpace=wrap;html=1;",120,80),t("shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;",60,80)]},EditorUi.prototype.hideShapePicker=function(e){null!=this.shapePicker&&(this.shapePicker.parentNode.removeChild(this.shapePicker),this.shapePicker=null,e||null==this.shapePickerCallback||this.shapePickerCallback(),this.shapePickerCallback=null)},EditorUi.prototype.onKeyDown=function(e){var t=this.editor.graph;9==e.which&&t.isEnabled()&&!mxEvent.isAltDown(e)&&(!t.isEditing()||!mxEvent.isShiftDown(e))&&(t.isEditing()?t.stopEditing(!1):t.selectCell(!mxEvent.isShiftDown(e)),mxEvent.consume(e))},EditorUi.prototype.onKeyPress=function(e){var t=this.editor.graph;if(this.isImmediateEditingEvent(e)&&!t.isEditing()&&!t.isSelectionEmpty()&&0!==e.which&&27!==e.which&&!mxEvent.isAltDown(e)&&!mxEvent.isControlDown(e)&&!mxEvent.isMetaDown(e)&&(t.escape(),t.startEditing(),mxClient.IS_FF)){var i=t.cellEditor;if(null!=i.textarea){i.textarea.innerHTML=String.fromCharCode(e.which);var n=document.createRange();n.selectNodeContents(i.textarea),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}}},EditorUi.prototype.isImmediateEditingEvent=function(e){return!0},EditorUi.prototype.getCssClassForMarker=function(e,t,i,n){var o="";return"flexArrow"==t?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+e+"blocktrans":"geSprite geSprite-noarrow":"box"==i||"halfCircle"==i?"geSprite geSvgSprite geSprite-"+i+("end"==e?" geFlipSprite":""):i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+e+"classic":"geSprite geSprite-"+e+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+e+"classicthin":"geSprite geSprite-"+e+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+e+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+e+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+e+"block":"geSprite geSprite-"+e+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+e+"blockthin":"geSprite geSprite-"+e+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+e+"oval":"geSprite geSprite-"+e+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+e+"diamond":"geSprite geSprite-"+e+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+e+"thindiamond":"geSprite geSprite-"+e+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+e+"openasync":"dash"==i?"geSprite geSprite-"+e+"dash":"cross"==i?"geSprite geSprite-"+e+"cross":"async"==i?"1"==n?"geSprite geSprite-"+e+"async":"geSprite geSprite-"+e+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+e+"circle":"geSprite geSprite-"+e+"circleplus":"ERone"==i?"geSprite geSprite-"+e+"erone":"ERmandOne"==i?"geSprite geSprite-"+e+"eronetoone":"ERmany"==i?"geSprite geSprite-"+e+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+e+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+e+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+e+"ermanyopt":"geSprite geSprite-noarrow"},EditorUi.prototype.createMenus=function(){return null},EditorUi.prototype.updatePasteActionStates=function(){var e=this.editor.graph,t=this.actions.get("paste"),i=this.actions.get("pasteHere");t.setEnabled(this.editor.graph.cellEditor.isContentEditing()||!mxClipboard.isEmpty()&&e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())),i.setEnabled(t.isEnabled())},EditorUi.prototype.initClipboard=function(){var e=this,t=mxClipboard.cut;mxClipboard.cut=function(i){i.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):t.apply(this,arguments),e.updatePasteActionStates()},mxClipboard.copy,mxClipboard.copy=function(t){var i=null;if(t.cellEditor.isContentEditing())document.execCommand("copy",!1,null);else{i=i||t.getSelectionCells(),i=t.getExportableCells(t.model.getTopmostCells(i));for(var n={},o=t.createCellLookup(i),r=t.cloneCells(i,null,n),l=new mxGraphModel,s=l.getChildAt(l.getRoot(),0),a=0;a<r.length;a++){l.add(s,r[a]);var h=t.view.getState(i[a]);if(null!=h){var d=t.getCellGeometry(r[a]);null!=d&&d.relative&&!l.isEdge(i[a])&&null==o[mxObjectIdentity.get(l.getParent(i[a]))]&&(d.offset=null,d.relative=!1,d.x=h.x/h.view.scale-h.view.translate.x,d.y=h.y/h.view.scale-h.view.translate.y)}}t.updateCustomLinks(t.createCellMapping(n,o),r),mxClipboard.insertCount=1,mxClipboard.setCells(r)}return e.updatePasteActionStates(),i};var i=mxClipboard.paste;mxClipboard.paste=function(t){var n=null;return t.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):n=i.apply(this,arguments),e.updatePasteActionStates(),n};var n=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){n.apply(this,arguments),e.updatePasteActionStates()};var o=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,i){o.apply(this,arguments),e.updatePasteActionStates()},this.updatePasteActionStates()},EditorUi.prototype.lazyZoomDelay=20,EditorUi.prototype.wheelZoomDelay=400,EditorUi.prototype.buttonZoomDelay=600,EditorUi.prototype.initCanvas=function(){var e=this.editor.graph;e.timerAutoScroll=!0,e.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((e.container.offsetWidth-34)/e.view.scale)),Math.max(0,Math.round((e.container.offsetHeight-34)/e.view.scale)))},e.view.getBackgroundPageBounds=function(){var e=this.graph.getPageLayout(),t=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+e.x*t.width),this.scale*(this.translate.y+e.y*t.height),this.scale*e.width*t.width,this.scale*e.height*t.height)},e.getPreferredPageSize=function(e,t,i){var n=this.getPageLayout(),o=this.getPageSize();return new mxRectangle(0,0,n.width*o.width,n.height*o.height)};var t=null,i=this;if(this.editor.isChromelessView()){t=mxUtils.bind(this,function(t,i,n,o){if(null!=e.container&&!e.isViewer()){n=null!=n?n:0,o=null!=o?o:0;var r=e.pageVisible?e.view.getBackgroundPageBounds():e.getGraphBounds(),l=mxUtils.hasScrollbars(e.container),s=e.view.translate,a=e.view.scale,h=mxRectangle.fromRectangle(r);h.x=h.x/a-s.x,h.y=h.y/a-s.y,h.width/=a,h.height/=a;var d=e.container.scrollTop,c=e.container.scrollLeft,u=mxClient.IS_QUIRKS||document.documentMode>=8?20:14;(8==document.documentMode||9==document.documentMode)&&(u+=3);var g=e.container.offsetWidth-u,p=e.container.offsetHeight-u,f=t?Math.max(.3,Math.min(i||1,g/h.width)):a,m=(g-f*h.width)/2/f,y=0==this.lightboxVerticalDivider?0:(p-f*h.height)/this.lightboxVerticalDivider/f;if(l&&(m=Math.max(m,0),y=Math.max(y,0)),l||r.width<g||r.height<p)e.view.scaleAndTranslate(f,Math.floor(m-h.x),Math.floor(y-h.y)),e.container.scrollTop=d*f/a,e.container.scrollLeft=c*f/a;else if(0!=n||0!=o){var b=e.view.translate;e.view.setTranslate(Math.floor(b.x+n/a),Math.floor(b.y+o/a))}}}),this.chromelessResize=t,this.chromelessWindowResize=mxUtils.bind(this,function(){this.chromelessResize(!1)});var n=mxUtils.bind(this,function(){this.chromelessWindowResize(!1)});if(mxEvent.addListener(window,"resize",n),this.destroyFunctions.push(function(){mxEvent.removeListener(window,"resize",n)}),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.chromelessResize(!0)})),this.actions.get("zoomIn").funct=mxUtils.bind(this,function(t){e.zoomIn(),this.chromelessResize(!1)}),this.actions.get("zoomOut").funct=mxUtils.bind(this,function(t){e.zoomOut(),this.chromelessResize(!1)}),"0"!=urlParams.toolbar){var o=JSON.parse(decodeURIComponent(urlParams["toolbar-config"]||"{}"));this.chromelessToolbar=document.createElement("div"),this.chromelessToolbar.style.position="fixed",this.chromelessToolbar.style.overflow="hidden",this.chromelessToolbar.style.boxSizing="border-box",this.chromelessToolbar.style.whiteSpace="nowrap",this.chromelessToolbar.style.backgroundColor="#000000",this.chromelessToolbar.style.padding="10px 10px 8px 10px",this.chromelessToolbar.style.left=e.isViewer()?"0":"50%",mxClient.IS_VML||(mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"borderRadius","20px"),mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out"));var r=mxUtils.bind(this,function(){var t=mxUtils.getCurrentStyle(e.container);e.isViewer()?this.chromelessToolbar.style.top="0":this.chromelessToolbar.style.bottom=(null!=t?parseInt(t["margin-bottom"]||0):0)+(null!=this.tabContainer?20+parseInt(this.tabContainer.style.height):20)+"px"});this.editor.addListener("resetGraphView",r),r();var l=0,s=mxUtils.bind(this,function(e,t,i){l++;var n=document.createElement("span");n.style.paddingLeft="8px",n.style.paddingRight="8px",n.style.cursor="pointer",mxEvent.addListener(n,"click",e),null!=i&&n.setAttribute("title",i);var o=document.createElement("img");return o.setAttribute("border","0"),o.setAttribute("src",t),n.appendChild(o),this.chromelessToolbar.appendChild(n),n});if(null!=o.backBtn&&s(mxUtils.bind(this,function(e){window.location.href=o.backBtn.url,mxEvent.consume(e)}),Editor.backLargeImage,mxResources.get("back",null,"Back")),this.isPagesEnabled()){var a=s(mxUtils.bind(this,function(e){this.actions.get("previousPage").funct(),mxEvent.consume(e)}),Editor.previousLargeImage,mxResources.get("previousPage")),h=document.createElement("div");h.style.display="inline-block",h.style.verticalAlign="top",h.style.fontFamily="Helvetica,Arial",h.style.marginTop="8px",h.style.fontSize="14px",h.style.color="#ffffff",this.chromelessToolbar.appendChild(h);var d=s(mxUtils.bind(this,function(e){this.actions.get("nextPage").funct(),mxEvent.consume(e)}),Editor.nextLargeImage,mxResources.get("nextPage")),c=mxUtils.bind(this,function(){null!=this.pages&&this.pages.length>1&&null!=this.currentPage&&(h.innerHTML="",mxUtils.write(h,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length))});a.style.paddingLeft="0px",a.style.paddingRight="4px",d.style.paddingLeft="4px",d.style.paddingRight="0px";var u=mxUtils.bind(this,function(){null!=this.pages&&this.pages.length>1&&null!=this.currentPage?(d.style.display="",a.style.display="",h.style.display="inline-block"):(d.style.display="none",a.style.display="none",h.style.display="none"),c()});this.editor.addListener("resetGraphView",u),this.editor.addListener("pageSelected",c)}s(mxUtils.bind(this,function(e){this.actions.get("zoomOut").funct(),mxEvent.consume(e)}),Editor.zoomOutLargeImage,mxResources.get("zoomOut")+" (Alt+Mousewheel)"),s(mxUtils.bind(this,function(e){this.actions.get("zoomIn").funct(),mxEvent.consume(e)}),Editor.zoomInLargeImage,mxResources.get("zoomIn")+" (Alt+Mousewheel)"),s(mxUtils.bind(this,function(t){e.isLightboxView()?(1==e.view.scale?this.lightboxFit():e.zoomTo(1),this.chromelessResize(!1)):this.chromelessResize(!0),mxEvent.consume(t)}),Editor.actualSizeLargeImage,mxResources.get("fit"));var g=null,p=null,f=mxUtils.bind(this,function(e){null!=g&&(window.clearTimeout(g),g=null),null!=p&&(window.clearTimeout(p),p=null),g=window.setTimeout(mxUtils.bind(this,function(){mxUtils.setOpacity(this.chromelessToolbar,0),g=null,p=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none",p=null}),600)}),e||200)}),m=mxUtils.bind(this,function(e){null!=g&&(window.clearTimeout(g),g=null),null!=p&&(window.clearTimeout(p),p=null),this.chromelessToolbar.style.display="",mxUtils.setOpacity(this.chromelessToolbar,e||30)});if("1"==urlParams.layers){this.layersDialog=null;var y=s(mxUtils.bind(this,function(t){if(null!=this.layersDialog)this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null;else{this.layersDialog=e.createLayersDialog(),mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null}));var i=y.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px"),this.layersDialog.style.position="fixed",this.layersDialog.style.fontFamily="Helvetica,Arial",this.layersDialog.style.backgroundColor="#000000",this.layersDialog.style.width="160px",this.layersDialog.style.padding="4px 2px 4px 2px",this.layersDialog.style.color="#ffffff",mxUtils.setOpacity(this.layersDialog,70),this.layersDialog.style.left=i.left+"px",this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px";var n=mxUtils.getCurrentStyle(this.editor.graph.container);this.layersDialog.style.zIndex=n.zIndex,document.body.appendChild(this.layersDialog)}mxEvent.consume(t)}),Editor.layersLargeImage,mxResources.get("layers")),b=e.getModel();b.addListener(mxEvent.CHANGE,function(){y.style.display=b.getChildCount(b.root)>1?"":"none"})}if("1"!=urlParams.openInSameWin&&this.addChromelessToolbarItems(s),(null!=this.editor.editButtonLink||null!=this.editor.editButtonFunc)&&s(mxUtils.bind(this,function(t){null!=this.editor.editButtonFunc?this.editor.editButtonFunc():"_blank"==this.editor.editButtonLink?this.editor.editAsNew(this.getEditBlankXml()):e.openLink(this.editor.editButtonLink,"editWindow"),mxEvent.consume(t)}),Editor.editLargeImage,mxResources.get("edit")),null!=this.lightboxToolbarActions)for(var v=0;v<this.lightboxToolbarActions.length;v++){var S=this.lightboxToolbarActions[v];s(S.fn,S.icon,S.tooltip)}null!=o.refreshBtn&&s(mxUtils.bind(this,function(e){o.refreshBtn.url?window.location.href=o.refreshBtn.url:window.location.reload(),mxEvent.consume(e)}),Editor.refreshLargeImage,mxResources.get("refresh",null,"Refresh")),null!=o.fullscreenBtn&&window.self!==window.top&&s(mxUtils.bind(this,function(t){o.fullscreenBtn.url?e.openLink(o.fullscreenBtn.url):e.openLink(window.location.href),mxEvent.consume(t)}),Editor.fullscreenLargeImage,mxResources.get("openInNewWindow",null,"Open in New Window")),(o.closeBtn&&window.self===window.top||e.lightbox&&("1"==urlParams.close||this.container!=document.body))&&s(mxUtils.bind(this,function(e){"1"==urlParams.close||o.closeBtn?window.close():(this.destroy(),mxEvent.consume(e))}),Editor.closeLargeImage,mxResources.get("close")+" (Escape)"),this.chromelessToolbar.style.display="none",e.isViewer()||mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transform","translate(-50%,0)"),e.container.appendChild(this.chromelessToolbar),mxEvent.addListener(e.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,function(e){mxEvent.isTouchEvent(e)||(mxEvent.isShiftDown(e)||m(30),f())})),mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",function(e){mxEvent.consume(e)}),mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(e){mxEvent.isShiftDown(e)?f():m(100)})),mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(e){mxEvent.isShiftDown(e)?f():m(100),mxEvent.consume(e)})),mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(e){mxEvent.isTouchEvent(e)||m(30)}));var C=e.getTolerance();e.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(t,i){this.startX=i.getGraphX(),this.startY=i.getGraphY(),this.scrollLeft=e.container.scrollLeft,this.scrollTop=e.container.scrollTop},mouseMove:function(e,t){},mouseUp:function(t,n){mxEvent.isTouchEvent(n.getEvent())&&Math.abs(this.scrollLeft-e.container.scrollLeft)<C&&Math.abs(this.scrollTop-e.container.scrollTop)<C&&Math.abs(this.startX-n.getGraphX())<C&&Math.abs(this.startY-n.getGraphY())<C&&(parseFloat(i.chromelessToolbar.style.opacity||0)>0?f():m(30))}})}this.editor.editable||this.addChromelessClickHandler()}else if(this.editor.extendCanvas){var $=e.view.validate;if(e.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var e=this.graph.getPagePadding(),t=this.graph.getPageSize();this.translate.x,this.translate.y,this.translate.x=e.x-(this.x0||0)*t.width,this.translate.y=e.y-(this.y0||0)*t.height}$.apply(this,arguments)},!e.isViewer()){var w=e.sizeDidChange;e.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var t=this.getPageLayout(),i=this.getPagePadding(),n=this.getPageSize(),o=Math.ceil(2*i.x+t.width*n.width),r=Math.ceil(2*i.y+t.height*n.height),l=e.minimumGraphSize;(null==l||l.width!=o||l.height!=r)&&(e.minimumGraphSize=new mxRectangle(0,0,o,r));var s=i.x-t.x*n.width,a=i.y-t.y*n.height;if(!this.autoTranslate&&(this.view.translate.x!=s||this.view.translate.y!=a)){this.autoTranslate=!0,this.view.x0=t.x,this.view.y0=t.y;var h=e.view.translate.x,d=e.view.translate.y;e.view.setTranslate(s,a),e.container.scrollLeft+=Math.round((s-h)*e.view.scale),e.container.scrollTop+=Math.round((a-d)*e.view.scale),this.autoTranslate=!1;return}w.apply(this,arguments)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}}}var E=e.view.getBackgroundPane(),x=e.view.getDrawPane();e.cumulativeZoomFactor=1;var _=null,k=null,T=null,A=null,L=null,P=function(n){null!=_&&window.clearTimeout(_),window.setTimeout(function(){(!e.isMouseDown||A)&&(_=window.setTimeout(mxUtils.bind(this,function(){e.isFastZoomEnabled()&&(null!=e.view.backgroundPageShape&&null!=e.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(e.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(e.view.backgroundPageShape.node.style,"transform",null)),x.style.transformOrigin="",E.style.transformOrigin="",mxClient.IS_SF?(x.style.transform="scale(1)",E.style.transform="scale(1)",window.setTimeout(function(){x.style.transform="",E.style.transform=""},0)):(x.style.transform="",E.style.transform=""),e.view.getDecoratorPane().style.opacity="",e.view.getOverlayPane().style.opacity="");var n=new mxPoint(e.container.scrollLeft,e.container.scrollTop),o=mxUtils.getOffset(e.container),r=e.view.scale,l=0,s=0;null!=k&&(l=e.container.offsetWidth/2-k.x+o.x,s=e.container.offsetHeight/2-k.y+o.y),e.zoom(e.cumulativeZoomFactor),e.view.scale!=r&&(null!=T&&(l+=n.x-T.x,s+=n.y-T.y),null!=t&&i.chromelessResize(!1,null,l*(e.cumulativeZoomFactor-1),s*(e.cumulativeZoomFactor-1)),mxUtils.hasScrollbars(e.container)&&(0!=l||0!=s)&&(e.container.scrollLeft-=l*(e.cumulativeZoomFactor-1),e.container.scrollTop-=s*(e.cumulativeZoomFactor-1))),null!=L&&x.setAttribute("filter",L),e.cumulativeZoomFactor=1,_=null,T=null,k=null,A=null,L=null}),null!=n?n:e.isFastZoomEnabled()?i.wheelZoomDelay:i.lazyZoomDelay))},0)};e.lazyZoom=function(t,n,o){if((n=n||!e.scrollbars)&&(k=new mxPoint(e.container.offsetLeft+e.container.clientWidth/2,e.container.offsetTop+e.container.clientHeight/2)),t?this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale),this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale,e.isFastZoomEnabled()){null==L&&""!=x.getAttribute("filter")&&(L=x.getAttribute("filter"),x.removeAttribute("filter")),T=new mxPoint(e.container.scrollLeft,e.container.scrollTop);var r=n?e.container.scrollLeft+e.container.clientWidth/2:k.x+e.container.scrollLeft-e.container.offsetLeft,l=n?e.container.scrollTop+e.container.clientHeight/2:k.y+e.container.scrollTop-e.container.offsetTop;if(x.style.transformOrigin=r+"px "+l+"px",x.style.transform="scale("+this.cumulativeZoomFactor+")",E.style.transformOrigin=r+"px "+l+"px",E.style.transform="scale("+this.cumulativeZoomFactor+")",null!=e.view.backgroundPageShape&&null!=e.view.backgroundPageShape.node){var s=e.view.backgroundPageShape.node;mxUtils.setPrefixedStyle(s.style,"transform-origin",(n?e.container.clientWidth/2+e.container.scrollLeft-s.offsetLeft+"px":k.x+e.container.scrollLeft-s.offsetLeft-e.container.offsetLeft+"px")+" "+(n?e.container.clientHeight/2+e.container.scrollTop-s.offsetTop+"px":k.y+e.container.scrollTop-s.offsetTop-e.container.offsetTop+"px")),mxUtils.setPrefixedStyle(s.style,"transform","scale("+this.cumulativeZoomFactor+")")}e.view.getDecoratorPane().style.opacity="0",e.view.getOverlayPane().style.opacity="0",null!=i.hoverIcons&&i.hoverIcons.reset()}P(o)},mxEvent.addGestureListeners(e.container,function(e){null!=_&&window.clearTimeout(_)},null,function(t){1!=e.cumulativeZoomFactor&&P(0)}),mxEvent.addListener(e.container,"scroll",function(t){null==_||e.isMouseDown||1==e.cumulativeZoomFactor||P(0)}),mxEvent.addMouseWheelListener(mxUtils.bind(this,function(t,i,n,o,r){if(null==this.dialogs||0==this.dialogs.length){if(!e.scrollbars&&!n&&e.isScrollWheelEvent(t)){var l=e.view.getTranslate(),s=40/e.view.scale;mxEvent.isShiftDown(t)?e.view.setTranslate(l.x+(i?-s:s),l.y):e.view.setTranslate(l.x,l.y+(i?s:-s))}else if(n||e.isZoomWheelEvent(t))for(var a=mxEvent.getSource(t);null!=a;){if(a==e.container)return e.tooltipHandler.hideTooltip(),k=null!=o&&null!=r?new mxPoint(o,r):new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),A=n,e.lazyZoom(i),mxEvent.consume(t),!1;a=a.parentNode}}}),e.container),e.panningHandler.zoomGraph=function(t){e.cumulativeZoomFactor=t.scale,e.lazyZoom(t.scale>0,!0),mxEvent.consume(t)}},EditorUi.prototype.addChromelessToolbarItems=function(e){e(mxUtils.bind(this,function(e){this.actions.get("print").funct(),mxEvent.consume(e)}),Editor.printLargeImage,mxResources.get("print"))},EditorUi.prototype.isPagesEnabled=function(){return this.editor.editable||"1"!=urlParams["hide-pages"]},EditorUi.prototype.createTemporaryGraph=function(e){var t=new Graph(document.createElement("div"));return t.stylesheet.styles=mxUtils.clone(e.styles),t.resetViewOnRootChange=!1,t.setConnectable(!1),t.gridEnabled=!1,t.autoScroll=!1,t.setTooltips(!1),t.setEnabled(!1),t.container.style.visibility="hidden",t.container.style.position="absolute",t.container.style.overflow="hidden",t.container.style.height="1px",t.container.style.width="1px",t},EditorUi.prototype.addChromelessClickHandler=function(){var e=urlParams.highlight;null!=e&&e.length>0&&(e="#"+e),this.editor.graph.addClickHandler(e)},EditorUi.prototype.toggleFormatPanel=function(e){e=null!=e?e:0==this.formatWidth,null!=this.format&&(this.formatWidth=e?240:0,this.formatContainer.style.display=e?"":"none",this.refresh(),this.format.refresh(),this.fireEvent(new mxEventObject("formatWidthChanged")))},EditorUi.prototype.lightboxFit=function(e){if(this.isDiagramEmpty())this.editor.graph.view.setScale(1);else{var t=urlParams.border,i=60;null!=t&&(i=parseInt(t)),this.editor.graph.maxFitScale=this.lightboxMaxFitScale,this.editor.graph.fit(i,null,null,null,null,null,e),this.editor.graph.maxFitScale=null}},EditorUi.prototype.isDiagramEmpty=function(){var e=this.editor.graph.getModel();return 1==e.getChildCount(e.root)&&0==e.getChildCount(e.getChildAt(e.root,0))},EditorUi.prototype.isSelectionAllowed=function(e){return"SELECT"==mxEvent.getSource(e).nodeName||"INPUT"==mxEvent.getSource(e).nodeName&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(e))},EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){if(!this.editor.isChromelessView())return this.onBeforeUnload()})},EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified)return mxResources.get("allChangesLost")},EditorUi.prototype.open=function(){try{null!=window.opener&&null!=window.opener.openFile&&window.opener.openFile.setConsumer(mxUtils.bind(this,function(e,t){try{var i=mxUtils.parseXml(e);this.editor.setGraphXml(i.documentElement),this.editor.setModified(!1),this.editor.undoManager.clear(),null!=t&&(this.editor.setFilename(t),this.updateDocumentTitle());return}catch(n){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+n.message)}}))}catch(e){}this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},EditorUi.prototype.showPopupMenu=function(e,t,i,n){this.editor.graph.popupMenuHandler.hideMenu();var o=new mxPopupMenu(e);o.div.className+=" geMenubarMenu",o.smartSeparators=!0,o.showDisabled=!0,o.autoExpand=!0,o.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(o,arguments),o.destroy()}),o.popup(t,i,null,n),this.setCurrentMenu(o)},EditorUi.prototype.setCurrentMenu=function(e,t){this.currentMenuElt=t,this.currentMenu=e},EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},EditorUi.prototype.updateDocumentTitle=function(){var e=this.editor.getOrCreateFilename();null!=this.editor.appName&&(e+=" - "+this.editor.appName),document.title=e},EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)},EditorUi.prototype.redo=function(){try{this.editor.graph.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(e){}},EditorUi.prototype.undo=function(){try{var e=this.editor.graph;if(e.isEditing()){var t=e.cellEditor.textarea.innerHTML;document.execCommand("undo",!1,null),t==e.cellEditor.textarea.innerHTML&&(e.stopEditing(!0),this.editor.undoManager.undo())}else this.editor.undoManager.undo()}catch(i){}},EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},EditorUi.prototype.getUrl=function(e){var t=null!=e?e:window.location.pathname,i=t.indexOf("?")>0?1:0;for(var n in urlParams)0==i?t+="?":t+="&",t+=n+"="+urlParams[n],i++;return t},EditorUi.prototype.setScrollbars=function(e){var t=this.editor.graph,i=t.container.style.overflow;t.scrollbars=e,this.editor.updateGraphComponents(),i!=t.container.style.overflow&&(t.container.scrollTop=0,t.container.scrollLeft=0,t.view.scaleAndTranslate(1,0,0),this.resetScrollbars()),this.fireEvent(new mxEventObject("scrollbarsChanged"))},EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},EditorUi.prototype.resetScrollbars=function(){var e=this.editor.graph;if(this.editor.extendCanvas){if(!this.editor.isChromelessView()){if(mxUtils.hasScrollbars(e.container)){if(e.pageVisible){var t=e.getPagePadding();e.container.scrollTop=Math.floor(t.y-this.editor.initialTopSpacing)-1,e.container.scrollLeft=Math.floor(Math.min(t.x,(e.container.scrollWidth-e.container.clientWidth)/2))-1;var i=e.getGraphBounds();i.width>0&&i.height>0&&(i.x>e.container.scrollLeft+.9*e.container.clientWidth&&(e.container.scrollLeft=Math.min(i.x+i.width-e.container.clientWidth,i.x-10)),i.y>e.container.scrollTop+.9*e.container.clientHeight&&(e.container.scrollTop=Math.min(i.y+i.height-e.container.clientHeight,i.y-10)))}else{var i=e.getGraphBounds(),n=Math.max(i.width,e.scrollTileSize.width*e.view.scale),o=Math.max(i.height,e.scrollTileSize.height*e.view.scale);e.container.scrollTop=Math.floor(Math.max(0,i.y-Math.max(20,(e.container.clientHeight-o)/4))),e.container.scrollLeft=Math.floor(Math.max(0,i.x-Math.max(0,(e.container.clientWidth-n)/2)))}}else{var r=mxRectangle.fromRectangle(e.pageVisible?e.view.getBackgroundPageBounds():e.getGraphBounds()),l=e.view.translate,s=e.view.scale;r.x=r.x/s-l.x,r.y=r.y/s-l.y,r.width/=s,r.height/=s;var a=e.pageVisible?0:Math.max(0,(e.container.clientHeight-r.height)/4);e.view.setTranslate(Math.floor(Math.max(0,(e.container.clientWidth-r.width)/2)-r.x+2),Math.floor(a-r.y+1))}}}else e.container.scrollTop=0,e.container.scrollLeft=0,mxUtils.hasScrollbars(e.container)||e.view.setTranslate(0,0)},EditorUi.prototype.setPageVisible=function(e){var t=this.editor.graph,i=mxUtils.hasScrollbars(t.container),n=0,o=0;if(i&&(n=t.view.translate.x*t.view.scale-t.container.scrollLeft,o=t.view.translate.y*t.view.scale-t.container.scrollTop),t.pageVisible=e,t.pageBreaksVisible=e,t.preferPageSize=e,t.view.validateBackground(),i){var r=t.getSelectionCells();t.clearSelection(),t.setSelectionCells(r)}t.sizeDidChange(),i&&(t.container.scrollLeft=t.view.translate.x*t.view.scale-n,t.container.scrollTop=t.view.translate.y*t.view.scale-o),this.fireEvent(new mxEventObject("pageViewChanged"))},ChangeGridColor.prototype.execute=function(){var e=this.ui.editor.graph.view.gridColor;this.ui.setGridColor(this.color),this.color=e},function(){var e=new mxObjectCodec(new ChangeGridColor,["ui"]);mxCodecRegistry.register(e)}(),ChangePageSetup.prototype.execute=function(){var e=this.ui.editor.graph;if(!this.ignoreColor){this.color=this.previousColor;var t=e.background;this.ui.setBackgroundColor(this.previousColor),this.previousColor=t}if(!this.ignoreImage){this.image=this.previousImage;var t=e.backgroundImage;this.ui.setBackgroundImage(this.previousImage),this.previousImage=t}if(null!=this.previousFormat){this.format=this.previousFormat;var t=e.pageFormat;(this.previousFormat.width!=t.width||this.previousFormat.height!=t.height)&&(this.ui.setPageFormat(this.previousFormat),this.previousFormat=t)}if(null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled),null!=this.previousPageScale){var i=this.ui.editor.graph.pageScale;this.previousPageScale!=i&&(this.ui.setPageScale(this.previousPageScale),this.previousPageScale=i)}},function(){var e=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat","previousPageScale"]);e.afterDecode=function(e,t,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,i.previousPageScale=i.pageScale,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(e)}(),EditorUi.prototype.setBackgroundColor=function(e){this.editor.graph.background=e,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},EditorUi.prototype.setFoldingEnabled=function(e){this.editor.graph.foldingEnabled=e,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},EditorUi.prototype.setPageFormat=function(e){this.editor.graph.pageFormat=e,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageFormatChanged"))},EditorUi.prototype.setPageScale=function(e){this.editor.graph.pageScale=e,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageScaleChanged"))},EditorUi.prototype.setGridColor=function(e){this.editor.graph.view.gridColor=e,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},EditorUi.prototype.addUndoListener=function(){var e=this.actions.get("undo"),t=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,function(){e.setEnabled(this.canUndo()),t.setEnabled(this.canRedo())});i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var o=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){o.apply(this,arguments),n()};var r=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(e,t){r.apply(this,arguments),n()},n()},EditorUi.prototype.updateActionStates=function(){var e=this.editor.graph,t=!e.isSelectionEmpty(),i=!1,n=!1,o=!1,r=e.getSelectionCells();if(null!=r)for(var l=0;l<r.length;l++){var s=r[l];if(e.getModel().isEdge(s)&&(o=!0),e.getModel().isVertex(s)&&(i=!0,(e.getModel().getChildCount(s)>0||e.isContainer(s))&&(n=!0)),o&&i)break}for(var a=["cut","copy","bold","italic","underline","delete","duplicate","editStyle","editTooltip","editLink","backgroundColor","borderColor","edit","toFront","toBack","lockUnlock","solid","dashed","pasteSize","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"],l=0;l<a.length;l++)this.actions.get(a[l]).setEnabled(t);this.actions.get("setAsDefaultStyle").setEnabled(1==e.getSelectionCount()),this.actions.get("clearWaypoints").setEnabled(!e.isSelectionEmpty()),this.actions.get("copySize").setEnabled(1==e.getSelectionCount()),this.actions.get("turn").setEnabled(!e.isSelectionEmpty()),this.actions.get("curved").setEnabled(o),this.actions.get("rotation").setEnabled(i),this.actions.get("wordWrap").setEnabled(i),this.actions.get("autosize").setEnabled(i);var h=i&&1==e.getSelectionCount();this.actions.get("group").setEnabled(e.getSelectionCount()>1||h&&!e.isContainer(e.getSelectionCell())),this.actions.get("ungroup").setEnabled(n),this.actions.get("removeFromGroup").setEnabled(h&&e.getModel().isVertex(e.getModel().getParent(e.getSelectionCell()))),e.view.getState(e.getSelectionCell()),this.menus.get("navigation").setEnabled(t||null!=e.view.currentRoot),this.actions.get("collapsible").setEnabled(i&&(e.isContainer(e.getSelectionCell())||e.model.getChildCount(e.getSelectionCell())>0)),this.actions.get("home").setEnabled(null!=e.view.currentRoot),this.actions.get("exitGroup").setEnabled(null!=e.view.currentRoot),this.actions.get("enterGroup").setEnabled(1==e.getSelectionCount()&&e.isValidRoot(e.getSelectionCell()));var d=1==e.getSelectionCount()&&e.isCellFoldable(e.getSelectionCell());this.actions.get("expand").setEnabled(d),this.actions.get("collapse").setEnabled(d),this.actions.get("editLink").setEnabled(1==e.getSelectionCount()),this.actions.get("openLink").setEnabled(1==e.getSelectionCount()&&null!=e.getLinkForCell(e.getSelectionCell())),this.actions.get("guides").setEnabled(e.isEnabled()),this.actions.get("grid").setEnabled(!this.editor.chromeless||this.editor.editable);var c=e.isEnabled()&&!e.isCellLocked(e.getDefaultParent());this.menus.get("layout").setEnabled(c),this.menus.get("insert").setEnabled(c),this.menus.get("direction").setEnabled(c&&i),this.menus.get("align").setEnabled(c&&i&&e.getSelectionCount()>1),this.menus.get("distribute").setEnabled(c&&i&&e.getSelectionCount()>1),this.actions.get("selectVertices").setEnabled(c),this.actions.get("selectEdges").setEnabled(c),this.actions.get("selectAll").setEnabled(c),this.actions.get("selectNone").setEnabled(c),this.updatePasteActionStates()},EditorUi.prototype.zeroOffset=new mxPoint(0,0),EditorUi.prototype.getDiagramContainerOffset=function(){return this.zeroOffset},EditorUi.prototype.refresh=function(e){e=null==e||e;var t=mxClient.IS_IE&&(null==document.documentMode||5==document.documentMode),i=this.container.clientWidth,n=this.container.clientHeight;this.container==document.body&&(i=document.body.clientWidth||document.documentElement.clientWidth,n=t&&document.body.clientHeight||document.documentElement.clientHeight);var o=0;mxClient.IS_IOS&&!window.navigator.standalone&&window.innerHeight!=document.documentElement.clientHeight&&(o=document.documentElement.clientHeight-window.innerHeight,window.scrollTo(0,0));var r=Math.max(0,Math.min(this.hsplitPosition,i-this.splitSize-20)),l=0;null!=this.menubar&&(this.menubarContainer.style.height=this.menubarHeight+"px",l+=this.menubarHeight),null!=this.toolbar&&(this.toolbarContainer.style.top=this.menubarHeight+"px",this.toolbarContainer.style.height=this.toolbarHeight+"px",l+=this.toolbarHeight),l>0&&!mxClient.IS_QUIRKS&&(l+=1);var s=0;if(null!=this.sidebarFooterContainer){var a=this.footerHeight+o;s=Math.max(0,Math.min(n-l-a,this.sidebarFooterHeight)),this.sidebarFooterContainer.style.width=r+"px",this.sidebarFooterContainer.style.height=s+"px",this.sidebarFooterContainer.style.bottom=a+"px"}var h=null!=this.format?this.formatWidth:0;this.sidebarContainer.style.top=l+"px",this.sidebarContainer.style.width=r+"px",this.formatContainer.style.top=l+"px",this.formatContainer.style.width=h+"px",this.formatContainer.style.display=null!=this.format?"":"none";var d=this.getDiagramContainerOffset(),c=null!=this.hsplit.parentNode?r+this.splitSize:0;if(this.diagramContainer.style.left=c+d.x+"px",this.diagramContainer.style.top=l+d.y+"px",this.footerContainer.style.height=this.footerHeight+"px",this.hsplit.style.top=this.sidebarContainer.style.top,this.hsplit.style.bottom=this.footerHeight+o+"px",this.hsplit.style.left=r+"px",this.footerContainer.style.display=0==this.footerHeight?"none":"",null!=this.tabContainer&&(this.tabContainer.style.left=c+"px"),t){this.menubarContainer.style.width=i+"px",this.toolbarContainer.style.width=this.menubarContainer.style.width;var u=Math.max(0,n-this.footerHeight-this.menubarHeight-this.toolbarHeight);this.sidebarContainer.style.height=u-s+"px",this.formatContainer.style.height=u+"px",this.diagramContainer.style.width=null!=this.hsplit.parentNode?Math.max(0,i-r-this.splitSize-h)+"px":i+"px",this.footerContainer.style.width=this.menubarContainer.style.width;var g=Math.max(0,n-this.footerHeight-this.menubarHeight-this.toolbarHeight);null!=this.tabContainer&&(this.tabContainer.style.width=this.diagramContainer.style.width,this.tabContainer.style.bottom=this.footerHeight+o+"px",g-=this.tabContainer.clientHeight),this.diagramContainer.style.height=g+"px",this.hsplit.style.height=g+"px"}else{this.footerHeight>0&&(this.footerContainer.style.bottom=o+"px"),this.diagramContainer.style.right=h+"px";var p=0;null!=this.tabContainer&&(this.tabContainer.style.bottom=this.footerHeight+o+"px",this.tabContainer.style.right=this.diagramContainer.style.right,p=this.tabContainer.clientHeight),this.sidebarContainer.style.bottom=this.footerHeight+s+o+"px",this.formatContainer.style.bottom=this.footerHeight+o+"px",this.diagramContainer.style.bottom=this.footerHeight+o+p+"px"}e&&this.editor.graph.sizeDidChange()},EditorUi.prototype.createTabContainer=function(){return null},EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer"),this.toolbarContainer=this.createDiv("geToolbarContainer"),this.sidebarContainer=this.createDiv("geSidebarContainer"),this.formatContainer=this.createDiv("geSidebarContainer geFormatContainer"),this.diagramContainer=this.createDiv("geDiagramContainer"),this.footerContainer=this.createDiv("geFooterContainer"),this.hsplit=this.createDiv("geHsplit"),this.hsplit.setAttribute("title",mxResources.get("collapseExpand")),this.menubarContainer.style.top="0px",this.menubarContainer.style.left="0px",this.menubarContainer.style.right="0px",this.toolbarContainer.style.left="0px",this.toolbarContainer.style.right="0px",this.sidebarContainer.style.left="0px",this.formatContainer.style.right="0px",this.formatContainer.style.zIndex="1",this.diagramContainer.style.right=(null!=this.format?this.formatWidth:0)+"px",this.footerContainer.style.left="0px",this.footerContainer.style.right="0px",this.footerContainer.style.bottom="0px",this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-2,this.hsplit.style.width=this.splitSize+"px",this.sidebarFooterContainer=this.createSidebarFooterContainer(),this.sidebarFooterContainer&&(this.sidebarFooterContainer.style.left="0px"),this.editor.chromeless?this.diagramContainer.style.border="none":this.tabContainer=this.createTabContainer()},EditorUi.prototype.createSidebarFooterContainer=function(){return null},EditorUi.prototype.createUi=function(){this.menubar=this.editor.chromeless?null:this.menus.createMenubar(this.createDiv("geMenubar")),null!=this.menubar&&this.menubarContainer.appendChild(this.menubar.container),null!=this.menubar&&(this.statusContainer=this.createStatusContainer(),this.editor.addListener("statusChanged",mxUtils.bind(this,function(){this.setStatusText(this.editor.getStatus())})),this.setStatusText(this.editor.getStatus()),this.menubar.container.appendChild(this.statusContainer),this.container.appendChild(this.menubarContainer)),this.sidebar=this.editor.chromeless?null:this.createSidebar(this.sidebarContainer),null!=this.sidebar&&this.container.appendChild(this.sidebarContainer),this.format=this.editor.chromeless||!this.formatEnabled?null:this.createFormat(this.formatContainer),null!=this.format&&this.container.appendChild(this.formatContainer);var e=this.editor.chromeless?null:this.createFooter();null!=e&&(this.footerContainer.appendChild(e),this.container.appendChild(this.footerContainer)),null!=this.sidebar&&this.sidebarFooterContainer&&this.container.appendChild(this.sidebarFooterContainer),this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),this.toolbar=this.editor.chromeless?null:this.createToolbar(this.createDiv("geToolbar")),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.sidebar&&(this.container.appendChild(this.hsplit),this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,function(e){this.hsplitPosition=e,this.refresh()})))},EditorUi.prototype.createStatusContainer=function(){var e=document.createElement("a");return e.className="geItem geStatus",e},EditorUi.prototype.setStatusText=function(e){this.statusContainer.innerHTML=e},EditorUi.prototype.createToolbar=function(e){return new Toolbar(this,e)},EditorUi.prototype.createSidebar=function(e){return new Sidebar(this,e)},EditorUi.prototype.createFormat=function(e){return new Format(this,e)},EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")},EditorUi.prototype.createDiv=function(e){var t=document.createElement("div");return t.className=e,t},EditorUi.prototype.addSplitHandler=function(e,t,i,n){var o=null,r=null,l=!0,s=null;mxClient.IS_POINTER&&(e.style.touchAction="none");var a=mxUtils.bind(this,function(){var n=parseInt(t?e.style.left:e.style.bottom);return t||(n=n+i-this.footerHeight),n});function h(e){if(null!=o){var h=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e));n(Math.max(0,r+(t?h.x-o.x:o.y-h.y)-i)),mxEvent.consume(e),r!=a()&&(l=!0,s=null)}}function d(e){h(e),r=null,o=null}mxEvent.addGestureListeners(e,function(e){o=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e)),r=a(),l=!1,mxEvent.consume(e)}),mxEvent.addListener(e,"click",mxUtils.bind(this,function(e){if(!l&&this.hsplitClickEnabled){var t=null!=s?s-i:0;s=a(),n(t),mxEvent.consume(e)}})),mxEvent.addGestureListeners(document,null,h,d),this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,h,d)})},EditorUi.prototype.handleError=function(e,t,i,n,o){var r=null!=e&&null!=e.error?e.error:e;if(null!=r||null!=t){var l=mxUtils.htmlEntities(mxResources.get("unknownError")),s=mxResources.get("ok");t=null!=t?t:mxResources.get("error"),null!=r&&null!=r.message&&(l=mxUtils.htmlEntities(r.message)),this.showError(t,l,s,i,null,null,null,null,null,null,null,null,n?i:null)}else null!=i&&i()},EditorUi.prototype.showError=function(e,t,i,n,o,r,l,s,a,h,d,c,u){var g=new ErrorDialog(this,e,t,i||mxResources.get("ok"),n,o,r,l,c,s,a),p=Math.ceil(null!=t?t.length/50:1);this.showDialog(g.container,h||340,d||100+20*p,!0,!1,u),g.init()},EditorUi.prototype.showDialog=function(e,t,i,n,o,r,l,s,a,h){this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new Dialog(this,e,t,i,n,o,r,l,s,a,h),this.dialogs.push(this.dialog)},EditorUi.prototype.hideDialog=function(e,t){if(null!=this.dialogs&&this.dialogs.length>0){var i=this.dialogs.pop();if(!1==i.close(e,t)){this.dialogs.push(i);return}this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null,this.editor.fireEvent(new mxEventObject("hideDialog")),null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&window.setTimeout(mxUtils.bind(this,function(){this.editor.graph.isEditing()&&null!=this.editor.graph.cellEditor.textarea?this.editor.graph.cellEditor.textarea.focus():(mxUtils.clearSelection(),this.editor.graph.container.focus())}),0)}},EditorUi.prototype.ctrlEnter=function(){var e=this.editor.graph;if(e.isEnabled())try{for(var t=e.getSelectionCells(),i=new mxDictionary,n=[],o=0;o<t.length;o++){var r=e.isTableCell(t[o])?e.model.getParent(t[o]):t[o];null==r||i.get(r)||(i.put(r,!0),n.push(r))}e.setSelectionCells(e.duplicateCells(n,!1))}catch(l){this.handleError(l)}},EditorUi.prototype.pickColor=function(e,t){var i=this.editor.graph,n=i.cellEditor.saveSelection(),o=226+(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12))*17,r=new ColorDialog(this,e||"none",function(e){i.cellEditor.restoreSelection(n),t(e)},function(){i.cellEditor.restoreSelection(n)});this.showDialog(r.container,230,o,!0,!1),r.init()},EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,function(e){this.hideDialog(e)})),this.showDialog(new OpenDialog(this).container,Editor.useLocalStorage?640:320,Editor.useLocalStorage?480:220,!0,!0,function(){window.openFile=null})},EditorUi.prototype.extractGraphModelFromHtml=function(e){var t=null;try{var i=e.indexOf("&lt;mxGraphModel ");if(i>=0){var n=e.lastIndexOf("&lt;/mxGraphModel&gt;");n>i&&(t=e.substring(i,n+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,""))}}catch(o){}return t},EditorUi.prototype.extractGraphModelFromEvent=function(e){var t=null,i=null;if(null!=e){var n=null!=e.dataTransfer?e.dataTransfer:e.clipboardData;if(null!=n&&(10==document.documentMode||11==document.documentMode?i=n.getData("Text"):(i=mxUtils.indexOf(n.types,"text/html")>=0?n.getData("text/html"):null,mxUtils.indexOf(n.types,null==i||0==i.length)&&(i=n.getData("text/plain"))),null!=i)){i=Graph.zapGremlins(mxUtils.trim(i));var o=this.extractGraphModelFromHtml(i);null!=o&&(i=o)}}return null!=i&&this.isCompatibleString(i)&&(t=i),t},EditorUi.prototype.isCompatibleString=function(e){return!1},EditorUi.prototype.saveFile=function(e){if(e||null==this.editor.filename){var t=new FilenameDialog(this,this.editor.getOrCreateFilename(),mxResources.get("save"),mxUtils.bind(this,function(e){this.save(e)}),null,mxUtils.bind(this,function(e){return null!=e&&e.length>0||(mxUtils.confirm(mxResources.get("invalidName")),!1)}));this.showDialog(t.container,300,100,!0,!0),t.init()}else this.save(this.editor.getOrCreateFilename())},EditorUi.prototype.save=function(e){if(null!=e){this.editor.graph.isEditing()&&this.editor.graph.stopEditing();var t=mxUtils.getXml(this.editor.getGraphXml());try{if(Editor.useLocalStorage){if(null!=localStorage.getItem(e)&&!mxUtils.confirm(mxResources.get("replaceIt",[e])))return;localStorage.setItem(e,t),this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("saved"))+" "+new Date)}else if(t.length<MAX_REQUEST_SIZE)new mxXmlRequest(SAVE_URL,"filename="+encodeURIComponent(e)+"&xml="+encodeURIComponent(t)).simulate(document,"_blank");else{mxUtils.alert(mxResources.get("drawingTooLarge")),mxUtils.popup(t);return}this.editor.setModified(!1),this.editor.setFilename(e),this.updateDocumentTitle()}catch(i){this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("errorSavingFile")))}}},EditorUi.prototype.executeLayout=function(e,t,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{e()}catch(o){throw o}finally{if(this.allowAnimation&&t&&(null==navigator.userAgent||0>navigator.userAgent.indexOf("Camino"))){var r=new mxMorphing(n);r.addListener(mxEvent.DONE,mxUtils.bind(this,function(){n.getModel().endUpdate(),null!=i&&i()})),r.startAnimation()}else n.getModel().endUpdate(),null!=i&&i()}}},EditorUi.prototype.showImageDialog=function(e,t,i){var n=this.editor.graph.cellEditor,o=n.saveSelection();this.showDialog(new ImageDialog(this,t).container,300,100),n.restoreSelection(o)},EditorUi.prototype.showLinkDialog=function(e,t,i){var n=new LinkDialog(this,e,t,i);this.showDialog(n.container,420,90,!0,!0),n.init()},EditorUi.prototype.showDataDialog=function(e){if(null!=e){var t=new EditDataDialog(this,e);this.showDialog(t.container,480,420,!0,!1,null,!1),t.init()}},EditorUi.prototype.showBackgroundImageDialog=function(e,t){e=null!=e?e:mxUtils.bind(this,function(e){var t=new ChangePageSetup(this,null,e);t.ignoreColor=!0,this.editor.graph.model.execute(t)});var i=mxUtils.prompt(mxResources.get("backgroundImage"),null!=t?t.src:"");if(null!=i&&i.length>0){var t=new Image;t.onload=function(){e(new mxImage(i,t.width,t.height),!1)},t.onerror=function(){e(null,!0),mxUtils.alert(mxResources.get("fileNotFound"))},t.src=i}else e(null)},EditorUi.prototype.setBackgroundImage=function(e){this.editor.graph.setBackgroundImage(e),this.editor.graph.view.validateBackgroundImage(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},EditorUi.prototype.confirm=function(e,t,i){mxUtils.confirm(e)?null!=t&&t():null!=i&&i()},EditorUi.prototype.createOutline=function(e){var t=new mxOutline(this.editor.graph);return t.border=20,mxEvent.addListener(window,"resize",function(){t.update()}),this.addListener("pageFormatChanged",function(){t.update()}),t},EditorUi.prototype.altShiftActions={67:"clearWaypoints",65:"connectionArrows",76:"editLink",80:"connectionPoints",84:"editTooltip",86:"pasteSize",88:"copySize"},EditorUi.prototype.createKeyHandler=function(e){var t=this,i=this.editor.graph,n=new mxKeyHandler(i),o=n.isEventIgnored;n.isEventIgnored=function(e){return!(mxEvent.isShiftDown(e)&&9==e.keyCode)&&(!this.isControlDown(e)||mxEvent.isShiftDown(e)||90!=e.keyCode&&89!=e.keyCode&&188!=e.keyCode&&190!=e.keyCode&&85!=e.keyCode)&&(66!=e.keyCode&&73!=e.keyCode||!this.isControlDown(e)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&o.apply(this,arguments)},n.isEnabledForEvent=function(e){return!mxEvent.isConsumed(e)&&this.isGraphEvent(e)&&this.isEnabled()&&(null==t.dialogs||0==t.dialogs.length)},n.isControlDown=function(e){return mxEvent.isControlDown(e)||mxClient.IS_MAC&&e.metaKey};var r=[],l=null;function s(e,t,n){r.push(function(){if(!i.isSelectionEmpty()&&i.isEnabled()){if(t=null!=t?t:1,n){i.getModel().beginUpdate();try{for(var o=i.getSelectionCells(),r=0;r<o.length;r++)if(i.getModel().isVertex(o[r])&&i.isCellResizable(o[r])){var l=i.getCellGeometry(o[r]);null!=l&&(l=l.clone(),37==e?l.width=Math.max(0,l.width-t):38==e?l.height=Math.max(0,l.height-t):39==e?l.width+=t:40==e&&(l.height+=t),i.getModel().setGeometry(o[r],l))}}finally{i.getModel().endUpdate()}}else{var s=i.getSelectionCell(),a=i.model.getParent(s),h=null;if(1==i.getSelectionCount()&&i.model.isVertex(s)&&null!=i.layoutManager&&!i.isCellLocked(s)&&(h=i.layoutManager.getLayout(a)),null!=h&&h.constructor==mxStackLayout){var d=a.getIndex(s);37==e||38==e?i.model.add(a,s,Math.max(0,d-1)):(39==e||40==e)&&i.model.add(a,s,Math.min(i.model.getChildCount(a),d+1))}else{for(var o=i.getMovableCells(i.getSelectionCells()),c=[],r=0;r<o.length;r++){var u=i.getCurrentCellStyle(o[r]);if("1"==mxUtils.getValue(u,"part","0")){var a=i.model.getParent(o[r]);i.model.isVertex(a)&&0>mxUtils.indexOf(o,a)&&c.push(a)}else c.push(o[r])}if(c.length>0){o=c;var g=0,p=0;37==e?g=-t:38==e?p=-t:39==e?g=t:40==e&&(p=t),i.moveCells(o,g,p)}}}}}),null!=l&&window.clearTimeout(l),l=window.setTimeout(function(){if(r.length>0){i.getModel().beginUpdate();try{for(var e=0;e<r.length;e++)r[e]();r=[]}finally{i.getModel().endUpdate()}}},200)}var a={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},h=n.getFunction;mxKeyHandler.prototype.getFunction=function(e){if(i.isEnabled()){if(mxEvent.isShiftDown(e)&&mxEvent.isAltDown(e)){var n=t.actions.get(t.altShiftActions[e.keyCode]);if(null!=n)return n.funct}if(9==e.keyCode&&mxEvent.isAltDown(e))return i.cellEditor.isContentEditing()?function(){document.execCommand("outdent",!1,null)}:mxEvent.isShiftDown(e)?function(){i.selectParentCell()}:function(){i.selectChildCell()};if(null!=a[e.keyCode]&&!i.isSelectionEmpty()){if(!(!this.isControlDown(e)&&mxEvent.isShiftDown(e)&&mxEvent.isAltDown(e)))return this.isControlDown(e)?function(){s(e.keyCode,mxEvent.isShiftDown(e)?i.gridSize:null,!0)}:function(){s(e.keyCode,mxEvent.isShiftDown(e)?i.gridSize:null)};if(i.model.isVertex(i.getSelectionCell()))return function(){var n=i.connectVertex(i.getSelectionCell(),a[e.keyCode],i.defaultEdgeLength,e,!0);null!=n&&n.length>0&&(1==n.length&&i.model.isEdge(n[0])?i.setSelectionCell(i.model.getTerminal(n[0],!1)):i.setSelectionCell(n[n.length-1]),i.scrollCellToVisible(i.getSelectionCell()),null!=t.hoverIcons&&t.hoverIcons.update(i.view.getState(i.getSelectionCell())))}}}return h.apply(this,arguments)},n.bindAction=mxUtils.bind(this,function(e,t,i,o){var r=this.actions.get(i);if(null!=r){var l=function(){r.isEnabled()&&r.funct()};t?o?n.bindControlShiftKey(e,l):n.bindControlKey(e,l):o?n.bindShiftKey(e,l):n.bindKey(e,l)}});var d=this,c=n.escape;return n.escape=function(e){c.apply(this,arguments)},n.enter=function(){},n.bindControlShiftKey(36,function(){i.exitGroup()}),n.bindControlShiftKey(35,function(){i.enterGroup()}),n.bindShiftKey(36,function(){i.home()}),n.bindKey(35,function(){i.refresh()}),n.bindAction(107,!0,"zoomIn"),n.bindAction(109,!0,"zoomOut"),n.bindAction(80,!0,"print"),n.bindAction(79,!0,"outline",!0),(!this.editor.chromeless||this.editor.editable)&&(n.bindControlKey(36,function(){i.isEnabled()&&i.foldCells(!0)}),n.bindControlKey(35,function(){i.isEnabled()&&i.foldCells(!1)}),n.bindControlKey(13,function(){d.ctrlEnter()}),n.bindAction(8,!1,"delete"),n.bindAction(8,!0,"deleteAll"),n.bindAction(8,!1,"deleteLabels",!0),n.bindAction(46,!1,"delete"),n.bindAction(46,!0,"deleteAll"),n.bindAction(46,!1,"deleteLabels",!0),n.bindAction(36,!1,"resetView"),n.bindAction(72,!0,"fitWindow",!0),n.bindAction(74,!0,"fitPage"),n.bindAction(74,!0,"fitTwoPages",!0),n.bindAction(48,!0,"customZoom"),n.bindAction(82,!0,"turn"),n.bindAction(82,!0,"clearDefaultStyle",!0),n.bindAction(83,!0,"save"),n.bindAction(83,!0,"saveAs",!0),n.bindAction(65,!0,"selectAll"),n.bindAction(65,!0,"selectNone",!0),n.bindAction(73,!0,"selectVertices",!0),n.bindAction(69,!0,"selectEdges",!0),n.bindAction(69,!0,"editStyle"),n.bindAction(66,!0,"bold"),n.bindAction(66,!0,"toBack",!0),n.bindAction(70,!0,"toFront",!0),n.bindAction(68,!0,"duplicate"),n.bindAction(68,!0,"setAsDefaultStyle",!0),n.bindAction(90,!0,"undo"),n.bindAction(89,!0,"autosize",!0),n.bindAction(88,!0,"cut"),n.bindAction(67,!0,"copy"),n.bindAction(86,!0,"paste"),n.bindAction(71,!0,"group"),n.bindAction(77,!0,"editData"),n.bindAction(71,!0,"grid",!0),n.bindAction(73,!0,"italic"),n.bindAction(76,!0,"lockUnlock"),n.bindAction(76,!0,"layers",!0),n.bindAction(80,!0,"formatPanel",!0),n.bindAction(85,!0,"underline"),n.bindAction(85,!0,"ungroup",!0),n.bindAction(190,!0,"superscript"),n.bindAction(188,!0,"subscript"),n.bindAction(9,!1,"indent",!0),n.bindKey(13,function(){i.isEnabled()&&i.startEditingAtCell()}),n.bindKey(113,function(){i.isEnabled()&&i.startEditingAtCell()})),mxClient.IS_WIN?n.bindAction(89,!0,"redo"):n.bindAction(90,!0,"redo",!0),n},EditorUi.prototype.destroy=function(){if(null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.menubar&&(this.menubar.destroy(),this.menubar=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var e=0;e<this.destroyFunctions.length;e++)this.destroyFunctions[e]();this.destroyFunctions=null}for(var t=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog],e=0;e<t.length;e++)null!=t[e]&&null!=t[e].parentNode&&t[e].parentNode.removeChild(t[e])};