/**
 * Copyright (c) 2006-2012, JGraph Ltd
 */(Format=function(e,t){this.editorUi=e,this.container=t}).prototype.labelIndex=0,Format.prototype.diagramIndex=0,Format.prototype.currentIndex=0,Format.prototype.showCloseButton=!0,Format.prototype.inactiveTabBackgroundColor="#f1f3f4",Format.prototype.roundableShapes=["label","rectangle","internalStorage","corner","parallelogram","swimlane","triangle","trapezoid","ext","step","tee","process","link","rhombus","offPageConnector","loopLimit","hexagon","manualInput","card","curlyBracket","singleArrow","callout","doubleArrow","flexArrow","umlLifeline"],Format.prototype.init=function(){var e=this.editorUi,t=e.editor,i=t.graph;this.update=mxUtils.bind(this,function(e,t){this.clearSelectionState(),this.refresh()}),i.getSelectionModel().addListener(mxEvent.CHANGE,this.update),i.addListener(mxEvent.EDITING_STARTED,this.update),i.addListener(mxEvent.EDITING_STOPPED,this.update),i.getModel().addListener(mxEvent.CHANGE,this.update),i.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){this.refresh()})),e.addListener("styleChanged",mxUtils.bind(this,function(e,t){this.refresh()})),t.addListener("autosaveChanged",mxUtils.bind(this,function(){this.refresh()})),this.refresh()},Format.prototype.clearSelectionState=function(){this.selectionState=null},Format.prototype.getSelectionState=function(){return null==this.selectionState&&(this.selectionState=this.createSelectionState()),this.selectionState},Format.prototype.createSelectionState=function(){for(var e=this.editorUi.editor.graph.getSelectionCells(),t=this.initSelectionState(),i=0;i<e.length;i++)this.updateSelectionStateForCell(t,e[i],e);return t},Format.prototype.initSelectionState=function(){return{vertices:[],edges:[],x:null,y:null,width:null,height:null,style:{},containsImage:!1,containsLabel:!1,fill:!0,glass:!0,rounded:!0,autoSize:!1,image:!0,shadow:!0,lineJumps:!0,resizable:!0,table:!1,cell:!1,row:!1,movable:!0,rotatable:!0,stroke:!0}},Format.prototype.updateSelectionStateForCell=function(e,t,i){var l=this.editorUi.editor.graph;if(l.getModel().isVertex(t)){e.resizable=e.resizable&&l.isCellResizable(t),e.rotatable=e.rotatable&&l.isCellRotatable(t),e.movable=e.movable&&l.isCellMovable(t)&&!l.isTableRow(t)&&!l.isTableCell(t),e.table=e.table||l.isTable(t),e.cell=e.cell||l.isTableCell(t),e.row=e.row||l.isTableRow(t),e.vertices.push(t);var n=l.getCellGeometry(t);if(null!=n&&(n.width>0?null==e.width?e.width=n.width:e.width!=n.width&&(e.width=""):e.containsLabel=!0,n.height>0?null==e.height?e.height=n.height:e.height!=n.height&&(e.height=""):e.containsLabel=!0,!n.relative||null!=n.offset)){var r=n.relative?n.offset.x:n.x,o=n.relative?n.offset.y:n.y;null==e.x?e.x=r:e.x!=r&&(e.x=""),null==e.y?e.y=o:e.y!=o&&(e.y="")}}else l.getModel().isEdge(t)&&(e.edges.push(t),e.resizable=!1,e.rotatable=!1,e.movable=!1);var a=l.view.getState(t);if(null!=a){e.autoSize=e.autoSize||this.isAutoSizeState(a),e.glass=e.glass&&this.isGlassState(a),e.rounded=e.rounded&&this.isRoundedState(a),e.lineJumps=e.lineJumps&&this.isLineJumpState(a),e.image=e.image&&this.isImageState(a),e.shadow=e.shadow&&this.isShadowState(a),e.fill=e.fill&&this.isFillState(a),e.stroke=e.stroke&&this.isStrokeState(a);var s=mxUtils.getValue(a.style,mxConstants.STYLE_SHAPE,null);for(var d in e.containsImage=e.containsImage||"image"==s,a.style){var p=a.style[d];null!=p&&(null==e.style[d]?e.style[d]=p:e.style[d]!=p&&(e.style[d]=""))}}},Format.prototype.isFillState=function(e){return!this.isSpecialColor(e.style[mxConstants.STYLE_FILLCOLOR])&&(e.view.graph.model.isVertex(e.cell)||"arrow"==mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null)||"filledEdge"==mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null)||"flexArrow"==mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null))},Format.prototype.isStrokeState=function(e){return!this.isSpecialColor(e.style[mxConstants.STYLE_STROKECOLOR])},Format.prototype.isSpecialColor=function(e){return mxUtils.indexOf([mxConstants.STYLE_STROKECOLOR,mxConstants.STYLE_FILLCOLOR,"inherit","swimlane","indicated"],e)>=0},Format.prototype.isGlassState=function(e){var t=mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null);return"label"==t||"rectangle"==t||"internalStorage"==t||"ext"==t||"umlLifeline"==t||"swimlane"==t||"process"==t},Format.prototype.isRoundedState=function(e){return null!=e.shape?e.shape.isRoundable():mxUtils.indexOf(this.roundableShapes,mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null))>=0},Format.prototype.isLineJumpState=function(e){var t=mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null);return!mxUtils.getValue(e.style,mxConstants.STYLE_CURVED,!1)&&("connector"==t||"filledEdge"==t)},Format.prototype.isAutoSizeState=function(e){return"1"==mxUtils.getValue(e.style,mxConstants.STYLE_AUTOSIZE,null)},Format.prototype.isImageState=function(e){var t=mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null);return"label"==t||"image"==t},Format.prototype.isShadowState=function(e){return"image"!=mxUtils.getValue(e.style,mxConstants.STYLE_SHAPE,null)},Format.prototype.clear=function(){if(this.container.innerHTML="",null!=this.panels)for(var e=0;e<this.panels.length;e++)this.panels[e].destroy();this.panels=[]},Format.prototype.refresh=function(){if("0px"!=this.container.style.width){this.clear();var e=this.editorUi,t=e.editor.graph,i=document.createElement("div");i.style.whiteSpace="nowrap",i.style.color="rgb(112, 112, 112)",i.style.textAlign="left",i.style.cursor="default";var l=document.createElement("div");l.className="geFormatSection",l.style.textAlign="center",l.style.fontWeight="bold",l.style.paddingTop="8px",l.style.fontSize="13px",l.style.borderWidth="0px 0px 1px 1px",l.style.borderStyle="solid",l.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",l.style.height=mxClient.IS_QUIRKS?"34px":"25px",l.style.overflow="hidden",l.style.width="100%",this.container.appendChild(i),mxEvent.addListener(l,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(e){e.preventDefault()}));var n=this.getSelectionState().containsLabel,r=null,o=null,a=mxUtils.bind(this,function(e,i,l){var a=mxUtils.bind(this,function(a){r!=e&&(n?this.labelIndex=l:t.isSelectionEmpty()?this.diagramIndex=l:this.currentIndex=l,null!=r&&(r.style.backgroundColor=this.inactiveTabBackgroundColor,r.style.borderBottomWidth="1px"),(r=e).style.backgroundColor="",r.style.borderBottomWidth="0px",o!=i&&(null!=o&&(o.style.display="none"),(o=i).style.display=""))});mxEvent.addListener(e,"click",a),mxEvent.addListener(e,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(e){e.preventDefault()})),l==(n?this.labelIndex:t.isSelectionEmpty()?this.diagramIndex:this.currentIndex)&&a()}),s=0;if(t.isSelectionEmpty()){mxUtils.write(l,mxResources.get("diagram")),l.style.borderLeftWidth="0px",i.appendChild(l);var d=i.cloneNode(!1);if(this.panels.push(new DiagramFormatPanel(this,e,d)),this.container.appendChild(d),null!=Editor.styles){d.style.display="none",l.style.width=this.showCloseButton?"106px":"50%",l.style.cursor="pointer",l.style.backgroundColor=this.inactiveTabBackgroundColor;var p=l.cloneNode(!1);p.style.borderLeftWidth="1px",p.style.borderRightWidth="1px",p.style.backgroundColor=this.inactiveTabBackgroundColor,a(l,d,s++);var u=i.cloneNode(!1);u.style.display="none",mxUtils.write(p,mxResources.get("style")),i.appendChild(p),this.panels.push(new DiagramStylePanel(this,e,u)),this.container.appendChild(u),a(p,u,s++)}if(this.showCloseButton){var p=l.cloneNode(!1);p.style.borderLeftWidth="1px",p.style.borderRightWidth="1px",p.style.borderBottomWidth="1px",p.style.backgroundColor=this.inactiveTabBackgroundColor,p.style.position="absolute",p.style.right="0px",p.style.top="0px",p.style.width="25px";var g=document.createElement("img");g.setAttribute("border","0"),g.setAttribute("src",Dialog.prototype.closeImage),g.setAttribute("title",mxResources.get("hide")),g.style.position="absolute",g.style.display="block",g.style.right="0px",g.style.top="8px",g.style.cursor="pointer",g.style.marginTop="1px",g.style.marginRight="6px",g.style.border="1px solid transparent",g.style.padding="1px",g.style.opacity=.5,p.appendChild(g),mxEvent.addListener(g,"click",function(){e.actions.get("formatPanel").funct()}),i.appendChild(p)}}else if(t.isEditing())mxUtils.write(l,mxResources.get("text")),i.appendChild(l),this.panels.push(new TextFormatPanel(this,e,i));else{l.style.backgroundColor=this.inactiveTabBackgroundColor,l.style.borderLeftWidth="1px",l.style.cursor="pointer",l.style.width=n?"50%":"33.3%";var p=l.cloneNode(!1),h=p.cloneNode(!1);if(p.style.backgroundColor=this.inactiveTabBackgroundColor,h.style.backgroundColor=this.inactiveTabBackgroundColor,n)p.style.borderLeftWidth="0px";else{l.style.borderLeftWidth="0px",mxUtils.write(l,mxResources.get("style")),i.appendChild(l);var u=i.cloneNode(!1);u.style.display="none",this.panels.push(new StyleFormatPanel(this,e,u)),this.container.appendChild(u),a(l,u,s++)}mxUtils.write(p,mxResources.get("text")),i.appendChild(p);var c=i.cloneNode(!1);c.style.display="none",this.panels.push(new TextFormatPanel(this,e,c)),this.container.appendChild(c),mxUtils.write(h,mxResources.get("arrange")),i.appendChild(h);var y=i.cloneNode(!1);y.style.display="none",this.panels.push(new ArrangePanel(this,e,y)),this.container.appendChild(y),a(p,c,s++),a(h,y,s++)}}},(BaseFormatPanel=function(e,t,i){this.format=e,this.editorUi=t,this.container=i,this.listeners=[]}).prototype.buttonBackgroundColor="white",BaseFormatPanel.prototype.getSelectionState=function(){for(var e=this.editorUi.editor.graph,t=e.getSelectionCells(),i=null,l=0;l<t.length;l++){var n=e.view.getState(t[l]);if(null!=n){var r=mxUtils.getValue(n.style,mxConstants.STYLE_SHAPE,null);if(null!=r){if(null==i)i=r;else if(i!=r)return null}}}return i},BaseFormatPanel.prototype.installInputHandler=function(e,t,i,l,n,r,o,a){r=null!=r?r:"",a=null!=a&&a;var s=this.editorUi,d=s.editor.graph;l=null!=l?l:1,n=null!=n?n:999;var p=null,u=!1,g=mxUtils.bind(this,function(g){var h=a?parseFloat(e.value):parseInt(e.value);if(isNaN(h)||t!=mxConstants.STYLE_ROTATION||(h=mxUtils.mod(Math.round(100*h),36e3)/100),h=Math.min(n,Math.max(l,isNaN(h)?i:h)),d.cellEditor.isContentEditing()&&o)u||(u=!0,null!=p&&(d.cellEditor.restoreSelection(p),p=null),o(h),e.value=h+r,u=!1);else if(h!=mxUtils.getValue(this.format.getSelectionState().style,t,i)){d.isEditing()&&d.stopEditing(!0),d.getModel().beginUpdate();try{var c=d.getSelectionCells();d.setCellStyles(t,h,c),t==mxConstants.STYLE_FONTSIZE&&d.updateLabelElements(d.getSelectionCells(),function(e){e.style.fontSize=h+"px",e.removeAttribute("size")});for(var y=0;y<c.length;y++)0==d.model.getChildCount(c[y])&&d.autoSizeCell(c[y],!1);s.fireEvent(new mxEventObject("styleChanged","keys",[t],"values",[h],"cells",c))}finally{d.getModel().endUpdate()}}e.value=h+r,mxEvent.consume(g)});return o&&d.cellEditor.isContentEditing()&&(mxEvent.addListener(e,"mousedown",function(){document.activeElement==d.cellEditor.textarea&&(p=d.cellEditor.saveSelection())}),mxEvent.addListener(e,"touchstart",function(){document.activeElement==d.cellEditor.textarea&&(p=d.cellEditor.saveSelection())})),mxEvent.addListener(e,"change",g),mxEvent.addListener(e,"blur",g),g},BaseFormatPanel.prototype.createPanel=function(){var e=document.createElement("div");return e.className="geFormatSection",e.style.padding="12px 0px 12px 18px",e},BaseFormatPanel.prototype.createTitle=function(e){var t=document.createElement("div");return t.style.padding="0px 0px 6px 0px",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.width="200px",t.style.fontWeight="bold",mxUtils.write(t,e),t},BaseFormatPanel.prototype.createStepper=function(e,t,i,l,n,r,o){i=null!=i?i:1,l=null!=l?l:8,mxClient.IS_QUIRKS?l-=2:(mxClient.IS_MT||document.documentMode>=8)&&(l+=1);var a=document.createElement("div");mxUtils.setPrefixedStyle(a.style,"borderRadius","3px"),a.style.border="1px solid rgb(192, 192, 192)",a.style.position="absolute";var s=document.createElement("div");s.style.borderBottom="1px solid rgb(192, 192, 192)",s.style.position="relative",s.style.height=l+"px",s.style.width="10px",s.className="geBtnUp",a.appendChild(s);var d=s.cloneNode(!1);if(d.style.border="none",d.style.height=l+"px",d.className="geBtnDown",a.appendChild(d),mxEvent.addListener(d,"click",function(l){""==e.value&&(e.value=r||"2");var n=o?parseFloat(e.value):parseInt(e.value);isNaN(n)||(e.value=n-i,null!=t&&t(l)),mxEvent.consume(l)}),mxEvent.addListener(s,"click",function(l){""==e.value&&(e.value=r||"0");var n=o?parseFloat(e.value):parseInt(e.value);isNaN(n)||(e.value=n+i,null!=t&&t(l)),mxEvent.consume(l)}),n){var p=null;mxEvent.addGestureListeners(a,function(e){(mxClient.IS_QUIRKS||8==document.documentMode)&&(p=document.selection.createRange()),mxEvent.consume(e)},null,function(e){if(null!=p){try{p.select()}catch(t){}p=null,mxEvent.consume(e)}})}return a},BaseFormatPanel.prototype.createOption=function(e,t,i,l,n){var r=document.createElement("div");r.style.padding="6px 0px 1px 0px",r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.width="200px",r.style.height=mxClient.IS_QUIRKS?"27px":"18px";var o=document.createElement("input");o.setAttribute("type","checkbox"),o.style.margin="0px 6px 0px 0px",r.appendChild(o);var a=document.createElement("span");mxUtils.write(a,e),r.appendChild(a);var s=!1,d=t(),p=function(e){s||(s=!0,e?(o.setAttribute("checked","checked"),o.defaultChecked=!0,o.checked=!0):(o.removeAttribute("checked"),o.defaultChecked=!1,o.checked=!1),d!=e&&(d=e,t()!=d&&i(d)),s=!1)};return mxEvent.addListener(r,"click",function(e){if("disabled"!=o.getAttribute("disabled")){var t=mxEvent.getSource(e);(t==r||t==a)&&(o.checked=!o.checked),p(o.checked)}}),p(d),null!=l&&(l.install(p),this.listeners.push(l)),null!=n&&n(r),r},BaseFormatPanel.prototype.createCellOption=function(e,t,i,l,n,r,o,a){l=null!=l?"null"==l?null:l:"1",n=null!=n?"null"==n?null:n:"0";var s=this.editorUi,d=s.editor.graph;return this.createOption(e,function(){var e=d.view.getState(d.getSelectionCell());return null!=e?mxUtils.getValue(e.style,t,i)!=n:null},function(e){if(a&&d.stopEditing(),null!=o)o.funct();else{d.getModel().beginUpdate();try{var i=e?l:n;d.setCellStyles(t,i,d.getSelectionCells()),null!=r&&r(d.getSelectionCells(),i),s.fireEvent(new mxEventObject("styleChanged","keys",[t],"values",[i],"cells",d.getSelectionCells()))}finally{d.getModel().endUpdate()}}},{install:function(e){this.listener=function(){var l=d.view.getState(d.getSelectionCell());null!=l&&e(mxUtils.getValue(l.style,t,i)!=n)},d.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){d.getModel().removeListener(this.listener)}})},BaseFormatPanel.prototype.createColorOption=function(e,t,i,l,n,r,o){var a=document.createElement("div");a.style.padding="6px 0px 1px 0px",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.width="200px",a.style.height=mxClient.IS_QUIRKS?"27px":"18px";var s=document.createElement("input");s.setAttribute("type","checkbox"),s.style.margin="0px 6px 0px 0px",o||a.appendChild(s);var d=document.createElement("span");mxUtils.write(d,e),a.appendChild(d);var p=t(),u=!1,g=null,h=function(e,n,a){u||(u=!0,e=/(^#?[a-zA-Z0-9]*$)/.test(e)?e:l,g.innerHTML='<div style="width:'+(mxClient.IS_QUIRKS?"30":"36")+"px;height:12px;margin:3px;border:1px solid black;background-color:"+mxUtils.htmlEntities(null!=e&&e!=mxConstants.NONE?e:l)+';"></div>',(mxClient.IS_QUIRKS||8==document.documentMode)&&(g.firstChild.style.margin="0px"),null!=e&&e!=mxConstants.NONE?(s.setAttribute("checked","checked"),s.defaultChecked=!0,s.checked=!0):(s.removeAttribute("checked"),s.defaultChecked=!1,s.checked=!1),g.style.display=s.checked||o?"":"none",null!=r&&r(e),!n&&(p=e,(a||o||t()!=p)&&i(p)),u=!1)};return(g=mxUtils.button("",mxUtils.bind(this,function(e){this.editorUi.pickColor(p,function(e){h(e,null,!0)}),mxEvent.consume(e)}))).style.position="absolute",g.style.marginTop="-4px",g.style.right=mxClient.IS_QUIRKS?"0px":"20px",g.style.height="22px",g.className="geColorBtn",g.style.display=s.checked||o?"":"none",a.appendChild(g),mxEvent.addListener(a,"click",function(e){var t=mxEvent.getSource(e);(t==s||"INPUT"!=t.nodeName)&&(t!=s&&(s.checked=!s.checked),s.checked||null==p||p==mxConstants.NONE||l==mxConstants.NONE||(l=p),h(s.checked?l:mxConstants.NONE))}),h(p,!0),null!=n&&(n.install(h),this.listeners.push(n)),a},BaseFormatPanel.prototype.createCellColorOption=function(e,t,i,l,n){var r=this.editorUi,o=r.editor.graph;return this.createColorOption(e,function(){var e=o.view.getState(o.getSelectionCell());return null!=e?mxUtils.getValue(e.style,t,null):null},function(e){o.getModel().beginUpdate();try{o.setCellStyles(t,e,o.getSelectionCells()),null!=n&&n(e),r.fireEvent(new mxEventObject("styleChanged","keys",[t],"values",[e],"cells",o.getSelectionCells()))}finally{o.getModel().endUpdate()}},i||mxConstants.NONE,{install:function(e){this.listener=function(){var i=o.view.getState(o.getSelectionCell());null!=i&&e(mxUtils.getValue(i.style,t,null))},o.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){o.getModel().removeListener(this.listener)}},l)},BaseFormatPanel.prototype.addArrow=function(e,t){t=null!=t?t:10;var i=document.createElement("div");i.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",i.style.padding="6px",i.style.paddingRight="4px";var l=10-t;2==l?i.style.paddingTop="6px":l>0?i.style.paddingTop=6-l+"px":i.style.marginTop="-2px",i.style.height=t+"px",i.style.borderLeft="1px solid #a0a0a0",i.innerHTML='<img border="0" src="'+(mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHBJREFUeNpidHB2ZyAGsACxDRBPIKCuA6TwCBB/h2rABu4A8SYmKCcXiP/iUFgAxL9gCi8A8SwsirZCMQMTkmANEH9E4v+CmsaArvAdyNFI/FlQ92EoBIE+qCRIUz168DBgsU4OqhinQpgHMABAgAEALY4XLIsJ20oAAAAASUVORK5CYII=":IMAGE_PATH+"/dropdown.png")+'" style="margin-bottom:4px;">',mxUtils.setOpacity(i,70);var n=e.getElementsByTagName("div")[0];return null!=n&&(n.style.paddingRight="6px",n.style.marginLeft="4px",n.style.marginTop="-1px",n.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",mxUtils.setOpacity(n,60)),mxUtils.setOpacity(e,100),e.style.border="1px solid #a0a0a0",e.style.backgroundColor=this.buttonBackgroundColor,e.style.backgroundImage="none",e.style.width="auto",e.className+=" geColorBtn",mxUtils.setPrefixedStyle(e.style,"borderRadius","3px"),e.appendChild(i),n},BaseFormatPanel.prototype.addUnitInput=function(e,t,i,l,n,r,o,a,s){o=null!=o?o:0;var d=document.createElement("input");d.style.position="absolute",d.style.textAlign="right",d.style.marginTop="-2px",d.style.right=i+12+"px",d.style.width=l+"px",e.appendChild(d);var p=this.createStepper(d,n,r,null,a,null,s);return p.style.marginTop=o-2+"px",p.style.right=i+"px",e.appendChild(p),d},BaseFormatPanel.prototype.createRelativeOption=function(e,t,i,l,n){i=null!=i?i:44;var r=this.editorUi.editor.graph,o=this.createPanel();o.style.paddingTop="10px",o.style.paddingBottom="10px",mxUtils.write(o,e),o.style.fontWeight="bold";var a=mxUtils.bind(this,function(e){if(null!=l)l(s);else{var i=parseInt(s.value);i=Math.min(100,Math.max(0,isNaN(i)?100:i));var n=r.view.getState(r.getSelectionCell());null!=n&&i!=mxUtils.getValue(n.style,t,100)&&(100==i&&(i=null),r.setCellStyles(t,i,r.getSelectionCells()),this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",[t],"values",[i],"cells",r.getSelectionCells()))),s.value=(null!=i?i:"100")+" %"}mxEvent.consume(e)}),s=this.addUnitInput(o,"%",20,i,a,10,-15,null!=l);if(null!=t){var d=mxUtils.bind(this,function(e,i,l){if(l||s!=document.activeElement){var n=this.format.getSelectionState(),r=parseInt(mxUtils.getValue(n.style,t,100));s.value=isNaN(r)?"":r+" %"}});mxEvent.addListener(s,"keydown",function(e){13==e.keyCode?(r.container.focus(),mxEvent.consume(e)):27==e.keyCode&&(d(null,null,!0),r.container.focus(),mxEvent.consume(e))}),r.getModel().addListener(mxEvent.CHANGE,d),this.listeners.push({destroy:function(){r.getModel().removeListener(d)}}),d()}return mxEvent.addListener(s,"blur",a),mxEvent.addListener(s,"change",a),null!=n&&n(s),o},BaseFormatPanel.prototype.addLabel=function(e,t,i,l){l=null!=l?l:61;var n=document.createElement("div");mxUtils.write(n,t),n.style.position="absolute",n.style.right=i+"px",n.style.width=l+"px",n.style.marginTop="6px",n.style.textAlign="center",e.appendChild(n)},BaseFormatPanel.prototype.addKeyHandler=function(e,t){mxEvent.addListener(e,"keydown",mxUtils.bind(this,function(e){13==e.keyCode?(this.editorUi.editor.graph.container.focus(),mxEvent.consume(e)):27==e.keyCode&&(null!=t&&t(null,null,!0),this.editorUi.editor.graph.container.focus(),mxEvent.consume(e))}))},BaseFormatPanel.prototype.styleButtons=function(e){for(var t=0;t<e.length;t++)mxUtils.setPrefixedStyle(e[t].style,"borderRadius","3px"),mxUtils.setOpacity(e[t],100),e[t].style.border="1px solid #a0a0a0",e[t].style.padding="4px",e[t].style.paddingTop="3px",e[t].style.paddingRight="1px",e[t].style.margin="1px",e[t].style.width="24px",e[t].style.height="20px",e[t].className+=" geColorBtn"},BaseFormatPanel.prototype.destroy=function(){if(null!=this.listeners){for(var e=0;e<this.listeners.length;e++)this.listeners[e].destroy();this.listeners=null}},ArrangePanel=function(e,t,i){BaseFormatPanel.call(this,e,t,i),this.init()},mxUtils.extend(ArrangePanel,BaseFormatPanel),ArrangePanel.prototype.init=function(){var e=this.editorUi.editor.graph,t=this.format.getSelectionState();if(this.container.appendChild(this.addLayerOps(this.createPanel())),this.addGeometry(this.container),this.addEdgeGeometry(this.container),t.containsLabel&&0!=t.edges.length||this.container.appendChild(this.addAngle(this.createPanel())),t.containsLabel||0!=t.edges.length||"rectangle"==t.style.shape||"label"==t.style.shape||this.container.appendChild(this.addFlip(this.createPanel())),t.vertices.length>1&&(this.container.appendChild(this.addAlign(this.createPanel())),this.container.appendChild(this.addDistribute(this.createPanel()))),(e.isTable(t.vertices[0])||e.isTableRow(t.vertices[0])||e.isTableCell(t.vertices[0]))&&this.container.appendChild(this.addTable(this.createPanel())),this.container.appendChild(this.addGroupOps(this.createPanel())),t.containsLabel){var i=document.createElement("div");i.style.width="100%",i.style.marginTop="0px",i.style.fontWeight="bold",i.style.padding="10px 0 0 18px",mxUtils.write(i,mxResources.get("style")),this.container.appendChild(i),new StyleFormatPanel(this.format,this.editorUi,this.container)}},ArrangePanel.prototype.addTable=function(e){var t=this.editorUi,i=t.editor.graph,l=this.format.getSelectionState();e.style.paddingTop="6px",e.style.paddingBottom="10px";var n=document.createElement("div");n.style.marginTop="2px",n.style.marginBottom="8px",n.style.fontWeight="bold",mxUtils.write(n,mxResources.get("table")),e.appendChild(n);var r=document.createElement("div");r.style.position="relative",r.style.paddingLeft="0px",r.style.borderWidth="0px",r.className="geToolbarContainer";var o=[t.toolbar.addButton("geSprite-insertcolumnbefore",mxResources.get("insertColumnBefore"),mxUtils.bind(this,function(){try{i.insertTableColumn(l.vertices[0],!0)}catch(e){t.handleError(e)}}),r),t.toolbar.addButton("geSprite-insertcolumnafter",mxResources.get("insertColumnAfter"),mxUtils.bind(this,function(){try{i.insertTableColumn(l.vertices[0],!1)}catch(e){t.handleError(e)}}),r),t.toolbar.addButton("geSprite-deletecolumn",mxResources.get("deleteColumn"),mxUtils.bind(this,function(){try{i.deleteTableColumn(l.vertices[0])}catch(e){t.handleError(e)}}),r),t.toolbar.addButton("geSprite-insertrowbefore",mxResources.get("insertRowBefore"),mxUtils.bind(this,function(){try{i.insertTableRow(l.vertices[0],!0)}catch(e){t.handleError(e)}}),r),t.toolbar.addButton("geSprite-insertrowafter",mxResources.get("insertRowAfter"),mxUtils.bind(this,function(){try{i.insertTableRow(l.vertices[0],!1)}catch(e){t.handleError(e)}}),r),t.toolbar.addButton("geSprite-deleterow",mxResources.get("deleteRow"),mxUtils.bind(this,function(){try{i.deleteTableRow(l.vertices[0])}catch(e){t.handleError(e)}}),r)];return this.styleButtons(o),e.appendChild(r),o[2].style.marginRight="9px",e},ArrangePanel.prototype.addLayerOps=function(e){var t=this.editorUi,i=mxUtils.button(mxResources.get("toFront"),function(e){t.actions.get("toFront").funct()});i.setAttribute("title",mxResources.get("toFront")+" ("+this.editorUi.actions.get("toFront").shortcut+")"),i.style.width="100px",i.style.marginRight="2px",e.appendChild(i);var i=mxUtils.button(mxResources.get("toBack"),function(e){t.actions.get("toBack").funct()});return i.setAttribute("title",mxResources.get("toBack")+" ("+this.editorUi.actions.get("toBack").shortcut+")"),i.style.width="100px",e.appendChild(i),e},ArrangePanel.prototype.addGroupOps=function(e){var t=this.editorUi,i=t.editor.graph,l=i.getSelectionCell(),n=this.format.getSelectionState(),r=0,o=null;if(e.style.paddingTop="8px",e.style.paddingBottom="6px",i.getSelectionCount()>1?((o=mxUtils.button(mxResources.get("group"),function(e){t.actions.get("group").funct()})).setAttribute("title",mxResources.get("group")+" ("+this.editorUi.actions.get("group").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",e.appendChild(o),r++):1==i.getSelectionCount()&&!i.getModel().isEdge(l)&&!i.isSwimlane(l)&&!i.isTable(l)&&!n.row&&!n.cell&&i.getModel().getChildCount(l)>0&&((o=mxUtils.button(mxResources.get("ungroup"),function(e){t.actions.get("ungroup").funct()})).setAttribute("title",mxResources.get("ungroup")+" ("+this.editorUi.actions.get("ungroup").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",e.appendChild(o),r++),n.vertices.length>0){r>0&&(mxUtils.br(e),r=0);var o=mxUtils.button(mxResources.get("copySize"),function(e){t.actions.get("copySize").funct()});if(o.setAttribute("title",mxResources.get("copySize")+" ("+this.editorUi.actions.get("copySize").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",e.appendChild(o),r++,null!=t.copiedSize){var a=mxUtils.button(mxResources.get("pasteSize"),function(e){t.actions.get("pasteSize").funct()});a.setAttribute("title",mxResources.get("pasteSize")+" ("+this.editorUi.actions.get("pasteSize").shortcut+")"),e.appendChild(a),r++,o.style.width="100px",o.style.marginBottom="2px",a.style.width="100px",a.style.marginBottom="2px"}}return 1==i.getSelectionCount()&&i.getModel().isVertex(l)&&!n.row&&!n.cell&&i.getModel().isVertex(i.getModel().getParent(l))?(r>0&&mxUtils.br(e),(o=mxUtils.button(mxResources.get("removeFromGroup"),function(e){t.actions.get("removeFromGroup").funct()})).setAttribute("title",mxResources.get("removeFromGroup")),o.style.width="202px",o.style.marginBottom="2px",e.appendChild(o),r++):i.getSelectionCount()>0&&(r>0&&mxUtils.br(e),(o=mxUtils.button(mxResources.get("clearWaypoints"),mxUtils.bind(this,function(e){this.editorUi.actions.get("clearWaypoints").funct()}))).setAttribute("title",mxResources.get("clearWaypoints")+" ("+this.editorUi.actions.get("clearWaypoints").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",e.appendChild(o),r++),1==i.getSelectionCount()&&(r>0&&mxUtils.br(e),(o=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(e){this.editorUi.actions.get("editData").funct()}))).setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),o.style.width="100px",o.style.marginBottom="2px",e.appendChild(o),r++,(o=mxUtils.button(mxResources.get("editLink"),mxUtils.bind(this,function(e){this.editorUi.actions.get("editLink").funct()}))).setAttribute("title",mxResources.get("editLink")),o.style.width="100px",o.style.marginLeft="2px",o.style.marginBottom="2px",e.appendChild(o),r++),0==r&&(e.style.display="none"),e},ArrangePanel.prototype.addAlign=function(e){var t=this.editorUi.editor.graph;e.style.paddingTop="6px",e.style.paddingBottom="12px",e.appendChild(this.createTitle(mxResources.get("align")));var i=document.createElement("div");i.style.position="relative",i.style.paddingLeft="0px",i.style.borderWidth="0px",i.className="geToolbarContainer",mxClient.IS_QUIRKS&&(e.style.height="60px");var l=this.editorUi.toolbar.addButton("geSprite-alignleft",mxResources.get("left"),function(){t.alignCells(mxConstants.ALIGN_LEFT)},i),n=this.editorUi.toolbar.addButton("geSprite-aligncenter",mxResources.get("center"),function(){t.alignCells(mxConstants.ALIGN_CENTER)},i),r=this.editorUi.toolbar.addButton("geSprite-alignright",mxResources.get("right"),function(){t.alignCells(mxConstants.ALIGN_RIGHT)},i),o=this.editorUi.toolbar.addButton("geSprite-aligntop",mxResources.get("top"),function(){t.alignCells(mxConstants.ALIGN_TOP)},i),a=this.editorUi.toolbar.addButton("geSprite-alignmiddle",mxResources.get("middle"),function(){t.alignCells(mxConstants.ALIGN_MIDDLE)},i),s=this.editorUi.toolbar.addButton("geSprite-alignbottom",mxResources.get("bottom"),function(){t.alignCells(mxConstants.ALIGN_BOTTOM)},i);return this.styleButtons([l,n,r,o,a,s]),r.style.marginRight="6px",e.appendChild(i),e},ArrangePanel.prototype.addFlip=function(e){var t=this.editorUi.editor.graph;e.style.paddingTop="6px",e.style.paddingBottom="10px";var i=document.createElement("div");i.style.marginTop="2px",i.style.marginBottom="8px",i.style.fontWeight="bold",mxUtils.write(i,mxResources.get("flip")),e.appendChild(i);var l=mxUtils.button(mxResources.get("horizontal"),function(e){t.toggleCellStyles(mxConstants.STYLE_FLIPH,!1)});l.setAttribute("title",mxResources.get("horizontal")),l.style.width="100px",l.style.marginRight="2px",e.appendChild(l);var l=mxUtils.button(mxResources.get("vertical"),function(e){t.toggleCellStyles(mxConstants.STYLE_FLIPV,!1)});return l.setAttribute("title",mxResources.get("vertical")),l.style.width="100px",e.appendChild(l),e},ArrangePanel.prototype.addDistribute=function(e){var t=this.editorUi.editor.graph;e.style.paddingTop="6px",e.style.paddingBottom="12px",e.appendChild(this.createTitle(mxResources.get("distribute")));var i=mxUtils.button(mxResources.get("horizontal"),function(e){t.distributeCells(!0)});i.setAttribute("title",mxResources.get("horizontal")),i.style.width="100px",i.style.marginRight="2px",e.appendChild(i);var i=mxUtils.button(mxResources.get("vertical"),function(e){t.distributeCells(!1)});return i.setAttribute("title",mxResources.get("vertical")),i.style.width="100px",e.appendChild(i),e},ArrangePanel.prototype.addAngle=function(e){var t=this.editorUi,i=t.editor.graph,l=this.format.getSelectionState();e.style.paddingBottom="8px";var n=document.createElement("div");n.style.position="absolute",n.style.width="70px",n.style.marginTop="0px",n.style.fontWeight="bold";var r=null,o=null,a=null;if(!l.rotatable||l.table||l.row||l.cell?e.style.paddingTop="8px":(mxUtils.write(n,mxResources.get("angle")),e.appendChild(n),r=this.addUnitInput(e,"\xb0",20,44,function(){o.apply(this,arguments)}),mxUtils.br(e),e.style.paddingTop="10px"),!l.containsLabel){var s=mxResources.get("reverse");l.vertices.length>0&&l.edges.length>0?s=mxResources.get("turn")+" / "+s:l.vertices.length>0&&(s=mxResources.get("turn")),(a=mxUtils.button(s,function(e){t.actions.get("turn").funct(e)})).setAttribute("title",s+" ("+this.editorUi.actions.get("turn").shortcut+")"),a.style.width="202px",e.appendChild(a),null!=r&&(a.style.marginTop="8px")}if(null!=r){var d=mxUtils.bind(this,function(e,t,i){if(i||document.activeElement!=r){l=this.format.getSelectionState();var n=parseFloat(mxUtils.getValue(l.style,mxConstants.STYLE_ROTATION,0));r.value=isNaN(n)?"":n+"\xb0"}});o=this.installInputHandler(r,mxConstants.STYLE_ROTATION,0,0,360,"\xb0",null,!0),this.addKeyHandler(r,d),i.getModel().addListener(mxEvent.CHANGE,d),this.listeners.push({destroy:function(){i.getModel().removeListener(d)}}),d()}return e},BaseFormatPanel.prototype.getUnit=function(){var e=this.editorUi.editor.graph.view.unit;switch(e){case mxConstants.POINTS:return"pt";case mxConstants.INCHES:return'"';case mxConstants.MILLIMETERS:return"mm"}},BaseFormatPanel.prototype.inUnit=function(e){return this.editorUi.editor.graph.view.formatUnitText(e)},BaseFormatPanel.prototype.fromUnit=function(e){var t=this.editorUi.editor.graph.view.unit;switch(t){case mxConstants.POINTS:return e;case mxConstants.INCHES:return e*mxConstants.PIXELS_PER_INCH;case mxConstants.MILLIMETERS:return e*mxConstants.PIXELS_PER_MM}},BaseFormatPanel.prototype.isFloatUnit=function(){return this.editorUi.editor.graph.view.unit!=mxConstants.POINTS},BaseFormatPanel.prototype.getUnitStep=function(){var e=this.editorUi.editor.graph.view.unit;switch(e){case mxConstants.POINTS:return 1;case mxConstants.INCHES:return .1;case mxConstants.MILLIMETERS:return .5}},ArrangePanel.prototype.addGeometry=function(e){var t,i,l,n,r=this,o=this.editorUi,a=o.editor.graph,s=this.format.getSelectionState(),d=this.createPanel();d.style.paddingBottom="8px";var p=document.createElement("div");p.style.position="absolute",p.style.width="50px",p.style.marginTop="0px",p.style.fontWeight="bold",mxUtils.write(p,mxResources.get("size")),d.appendChild(p);var u=this.addUnitInput(d,this.getUnit(),84,44,function(){t.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),g=this.addUnitInput(d,this.getUnit(),20,44,function(){i.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),h=document.createElement("div");h.className="geSprite geSprite-fit",h.setAttribute("title",mxResources.get("autosize")+" ("+this.editorUi.actions.get("autosize").shortcut+")"),h.style.position="relative",h.style.cursor="pointer",h.style.marginTop="-3px",h.style.border="0px",h.style.left="42px",mxUtils.setOpacity(h,50),mxEvent.addListener(h,"mouseenter",function(){mxUtils.setOpacity(h,100)}),mxEvent.addListener(h,"mouseleave",function(){mxUtils.setOpacity(h,50)}),mxEvent.addListener(h,"click",function(){o.actions.get("autosize").funct()}),d.appendChild(h),s.row?(u.style.visibility="hidden",u.nextSibling.style.visibility="hidden"):this.addLabel(d,mxResources.get("width"),84),this.addLabel(d,mxResources.get("height"),20),mxUtils.br(d);var c=document.createElement("div");c.style.paddingTop="8px",c.style.paddingRight="20px",c.style.whiteSpace="nowrap",c.style.textAlign="right";var y=this.createCellOption(mxResources.get("constrainProportions"),mxConstants.STYLE_ASPECT,null,"fixed","null");y.style.width="100%",c.appendChild(y),s.cell||s.row?h.style.visibility="hidden":d.appendChild(c);var S=y.getElementsByTagName("input")[0];this.addKeyHandler(u,C),this.addKeyHandler(g,C),t=this.addGeometryHandler(u,function(e,t,i){if(a.isTableCell(i))return a.setTableColumnWidth(i,t-e.width,!0),!0;if(e.width>0){var t=Math.max(1,r.fromUnit(t));S.checked&&(e.height=Math.round(e.height*t*100/e.width)/100),e.width=t}}),i=this.addGeometryHandler(g,function(e,t,i){if(a.isTableCell(i)&&(i=a.model.getParent(i)),a.isTableRow(i))return a.setTableRowHeight(i,t-e.height),!0;if(e.height>0){var t=Math.max(1,r.fromUnit(t));S.checked&&(e.width=Math.round(e.width*t*100/e.height)/100),e.height=t}}),(s.resizable||s.row||s.cell)&&e.appendChild(d);var E=this.createPanel();E.style.paddingBottom="30px";var p=document.createElement("div");p.style.position="absolute",p.style.width="70px",p.style.marginTop="0px",p.style.fontWeight="bold",mxUtils.write(p,mxResources.get("position")),E.appendChild(p);var f=this.addUnitInput(E,this.getUnit(),84,44,function(){l.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),m=this.addUnitInput(E,this.getUnit(),20,44,function(){n.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit());mxUtils.br(E),this.addLabel(E,mxResources.get("left"),84),this.addLabel(E,mxResources.get("top"),20);var C=mxUtils.bind(this,function(e,t,i){(s=this.format.getSelectionState()).containsLabel||s.vertices.length!=a.getSelectionCount()||null==s.width||null==s.height?d.style.display="none":(d.style.display="",(i||document.activeElement!=u)&&(u.value=this.inUnit(s.width)+(""==s.width?"":" "+this.getUnit())),(i||document.activeElement!=g)&&(g.value=this.inUnit(s.height)+(""==s.height?"":" "+this.getUnit()))),s.vertices.length==a.getSelectionCount()&&null!=s.x&&null!=s.y?(E.style.display="",(i||document.activeElement!=f)&&(f.value=this.inUnit(s.x)+(""==s.x?"":" "+this.getUnit())),(i||document.activeElement!=m)&&(m.value=this.inUnit(s.y)+(""==s.y?"":" "+this.getUnit()))):E.style.display="none"});this.addKeyHandler(f,C),this.addKeyHandler(m,C),a.getModel().addListener(mxEvent.CHANGE,C),this.listeners.push({destroy:function(){a.getModel().removeListener(C)}}),C(),l=this.addGeometryHandler(f,function(e,t){t=r.fromUnit(t),e.relative?e.offset.x=t:e.x=t}),n=this.addGeometryHandler(m,function(e,t){t=r.fromUnit(t),e.relative?e.offset.y=t:e.y=t}),s.movable&&e.appendChild(E)},ArrangePanel.prototype.addGeometryHandler=function(e,t){var i=this.editorUi.editor.graph,l=null,n=this;function r(r){if(""!=e.value){var o=parseFloat(e.value);if(isNaN(o))e.value=l+" "+n.getUnit();else if(o!=l){i.getModel().beginUpdate();try{for(var a=i.getSelectionCells(),s=0;s<a.length;s++)if(i.getModel().isVertex(a[s])){var d=i.getCellGeometry(a[s]);if(null!=d&&(d=d.clone(),!t(d,o,a[s]))){var p=i.view.getState(a[s]);null!=p&&i.isRecursiveVertexResize(p)&&i.resizeChildCells(a[s],d),i.getModel().setGeometry(a[s],d),i.constrainChildCells(a[s])}}}finally{i.getModel().endUpdate()}l=o,e.value=o+" "+n.getUnit()}}mxEvent.consume(r)}return mxEvent.addListener(e,"blur",r),mxEvent.addListener(e,"change",r),mxEvent.addListener(e,"focus",function(){l=e.value}),r},ArrangePanel.prototype.addEdgeGeometryHandler=function(e,t){var i=this.editorUi.editor.graph,l=null;function n(n){if(""!=e.value){var r=parseFloat(e.value);if(isNaN(r))e.value=l+" pt";else if(r!=l){i.getModel().beginUpdate();try{for(var o=i.getSelectionCells(),a=0;a<o.length;a++)if(i.getModel().isEdge(o[a])){var s=i.getCellGeometry(o[a]);null!=s&&(s=s.clone(),t(s,r),i.getModel().setGeometry(o[a],s))}}finally{i.getModel().endUpdate()}l=r,e.value=r+" pt"}}mxEvent.consume(n)}return mxEvent.addListener(e,"blur",n),mxEvent.addListener(e,"change",n),mxEvent.addListener(e,"focus",function(){l=e.value}),n},ArrangePanel.prototype.addEdgeGeometry=function(e){var t,i,l,n,r,o=this.editorUi,a=o.editor.graph,s=this.format.getSelectionState(),d=this.createPanel(),p=document.createElement("div");p.style.position="absolute",p.style.width="70px",p.style.marginTop="0px",p.style.fontWeight="bold",mxUtils.write(p,mxResources.get("width")),d.appendChild(p);var u=this.addUnitInput(d,"pt",20,44,function(){t.apply(this,arguments)});function t(e){var t=parseInt(u.value);(t=Math.min(999,Math.max(1,isNaN(t)?1:t)))!=mxUtils.getValue(s.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth)&&(a.setCellStyles("width",t,a.getSelectionCells()),o.fireEvent(new mxEventObject("styleChanged","keys",["width"],"values",[t],"cells",a.getSelectionCells()))),u.value=t+" pt",mxEvent.consume(e)}mxUtils.br(d),this.addKeyHandler(u,f),mxEvent.addListener(u,"blur",t),mxEvent.addListener(u,"change",t),e.appendChild(d);var g=this.createPanel();g.style.paddingBottom="30px";var p=document.createElement("div");p.style.position="absolute",p.style.width="70px",p.style.marginTop="0px",p.style.fontWeight="bold",mxUtils.write(p,"Start"),g.appendChild(p);var h=this.addUnitInput(g,"pt",84,44,function(){n.apply(this,arguments)}),c=this.addUnitInput(g,"pt",20,44,function(){r.apply(this,arguments)});mxUtils.br(g),this.addLabel(g,mxResources.get("left"),84),this.addLabel(g,mxResources.get("top"),20),e.appendChild(g),this.addKeyHandler(h,f),this.addKeyHandler(c,f);var y=this.createPanel();y.style.paddingBottom="30px";var p=document.createElement("div");p.style.position="absolute",p.style.width="70px",p.style.marginTop="0px",p.style.fontWeight="bold",mxUtils.write(p,"End"),y.appendChild(p);var S=this.addUnitInput(y,"pt",84,44,function(){i.apply(this,arguments)}),E=this.addUnitInput(y,"pt",20,44,function(){l.apply(this,arguments)});mxUtils.br(y),this.addLabel(y,mxResources.get("left"),84),this.addLabel(y,mxResources.get("top"),20),e.appendChild(y),this.addKeyHandler(S,f),this.addKeyHandler(E,f);var f=mxUtils.bind(this,function(e,t,i){s=this.format.getSelectionState();var l=a.getSelectionCell();if("link"==s.style.shape||"flexArrow"==s.style.shape){if(d.style.display="",i||document.activeElement!=u){var n=mxUtils.getValue(s.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth);u.value=n+" pt"}}else d.style.display="none";if(1==a.getSelectionCount()&&a.model.isEdge(l)){var r=a.model.getGeometry(l);null!=r.sourcePoint&&null==a.model.getTerminal(l,!0)?(h.value=r.sourcePoint.x,c.value=r.sourcePoint.y):g.style.display="none",null!=r.targetPoint&&null==a.model.getTerminal(l,!1)?(S.value=r.targetPoint.x,E.value=r.targetPoint.y):y.style.display="none"}else g.style.display="none",y.style.display="none"});n=this.addEdgeGeometryHandler(h,function(e,t){e.sourcePoint.x=t}),r=this.addEdgeGeometryHandler(c,function(e,t){e.sourcePoint.y=t}),i=this.addEdgeGeometryHandler(S,function(e,t){e.targetPoint.x=t}),l=this.addEdgeGeometryHandler(E,function(e,t){e.targetPoint.y=t}),a.getModel().addListener(mxEvent.CHANGE,f),this.listeners.push({destroy:function(){a.getModel().removeListener(f)}}),f()},TextFormatPanel=function(e,t,i){BaseFormatPanel.call(this,e,t,i),this.init()},mxUtils.extend(TextFormatPanel,BaseFormatPanel),TextFormatPanel.prototype.init=function(){this.container.style.borderBottom="none",this.addFont(this.container)},TextFormatPanel.prototype.addFont=function(e){var t,i,l,n,r,o,a,s,d,p,u,g,h=this.editorUi,c=h.editor.graph,y=this.format.getSelectionState(),S=this.createTitle(mxResources.get("font"));S.style.paddingLeft="18px",S.style.paddingTop="10px",S.style.paddingBottom="6px",e.appendChild(S);var E=this.createPanel();if(E.style.paddingTop="2px",E.style.paddingBottom="2px",E.style.position="relative",E.style.marginLeft="-2px",E.style.borderWidth="0px",E.className="geToolbarContainer",mxClient.IS_QUIRKS&&(E.style.display="block"),c.cellEditor.isContentEditing()){var f=E.cloneNode(),m=this.editorUi.toolbar.addMenu(mxResources.get("style"),mxResources.get("style"),!0,"formatBlock",f,null,!0);m.style.color="rgb(112, 112, 112)",m.style.whiteSpace="nowrap",m.style.overflow="hidden",m.style.margin="0px",this.addArrow(m),m.style.width="192px",m.style.height="15px";var C=m.getElementsByTagName("div")[0];C.style.cssFloat="right",e.appendChild(f)}e.appendChild(E);var T=this.createPanel();T.style.marginTop="8px",T.style.borderTop="1px solid #c0c0c0",T.style.paddingTop="6px",T.style.paddingBottom="6px";var L=this.editorUi.toolbar.addMenu("Helvetica",mxResources.get("fontFamily"),!0,"fontFamily",E,null,!0);L.style.color="rgb(112, 112, 112)",L.style.whiteSpace="nowrap",L.style.overflow="hidden",L.style.margin="0px",this.addArrow(L),L.style.width="192px",L.style.height="15px";var v=E.cloneNode(!1);v.style.marginLeft="-3px";var b=this.editorUi.toolbar.addItems(["bold","italic","underline"],v,!0);b[0].setAttribute("title",mxResources.get("bold")+" ("+this.editorUi.actions.get("bold").shortcut+")"),b[1].setAttribute("title",mxResources.get("italic")+" ("+this.editorUi.actions.get("italic").shortcut+")"),b[2].setAttribute("title",mxResources.get("underline")+" ("+this.editorUi.actions.get("underline").shortcut+")");var A=this.editorUi.toolbar.addItems(["vertical"],v,!0)[0];mxClient.IS_QUIRKS&&mxUtils.br(e),e.appendChild(v),this.styleButtons(b),this.styleButtons([A]);var $=E.cloneNode(!1);$.style.marginLeft="-3px",$.style.paddingBottom="0px";var x=function(e){return function(){return e()}},I=this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),c.cellEditor.isContentEditing()?function(e){c.cellEditor.alignText(mxConstants.ALIGN_LEFT,e)}:x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT])),$),R=this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),c.cellEditor.isContentEditing()?function(e){c.cellEditor.alignText(mxConstants.ALIGN_CENTER,e)}:x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER])),$),_=this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),c.cellEditor.isContentEditing()?function(e){c.cellEditor.alignText(mxConstants.ALIGN_RIGHT,e)}:x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT])),$);if(this.styleButtons([I,R,_]),c.cellEditor.isContentEditing()){var N=this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("strikethrough"),function(){document.execCommand("strikeThrough",!1,null)},v);this.styleButtons([N]),N.firstChild.style.background="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0wIDBoMjR2MjRIMFYweiIvPjwvZGVmcz48Y2xpcFBhdGggaWQ9ImIiPjx1c2UgeGxpbms6aHJlZj0iI2EiIG92ZXJmbG93PSJ2aXNpYmxlIi8+PC9jbGlwUGF0aD48cGF0aCBjbGlwLXBhdGg9InVybCgjYikiIGZpbGw9IiMwMTAxMDEiIGQ9Ik03LjI0IDguNzVjLS4yNi0uNDgtLjM5LTEuMDMtLjM5LTEuNjcgMC0uNjEuMTMtMS4xNi40LTEuNjcuMjYtLjUuNjMtLjkzIDEuMTEtMS4yOS40OC0uMzUgMS4wNS0uNjMgMS43LS44My42Ni0uMTkgMS4zOS0uMjkgMi4xOC0uMjkuODEgMCAxLjU0LjExIDIuMjEuMzQuNjYuMjIgMS4yMy41NCAxLjY5Ljk0LjQ3LjQuODMuODggMS4wOCAxLjQzLjI1LjU1LjM4IDEuMTUuMzggMS44MWgtMy4wMWMwLS4zMS0uMDUtLjU5LS4xNS0uODUtLjA5LS4yNy0uMjQtLjQ5LS40NC0uNjgtLjItLjE5LS40NS0uMzMtLjc1LS40NC0uMy0uMS0uNjYtLjE2LTEuMDYtLjE2LS4zOSAwLS43NC4wNC0xLjAzLjEzLS4yOS4wOS0uNTMuMjEtLjcyLjM2LS4xOS4xNi0uMzQuMzQtLjQ0LjU1LS4xLjIxLS4xNS40My0uMTUuNjYgMCAuNDguMjUuODguNzQgMS4yMS4zOC4yNS43Ny40OCAxLjQxLjdINy4zOWMtLjA1LS4wOC0uMTEtLjE3LS4xNS0uMjV6TTIxIDEydi0ySDN2Mmg5LjYyYy4xOC4wNy40LjE0LjU1LjIuMzcuMTcuNjYuMzQuODcuNTEuMjEuMTcuMzUuMzYuNDMuNTcuMDcuMi4xMS40My4xMS42OSAwIC4yMy0uMDUuNDUtLjE0LjY2LS4wOS4yLS4yMy4zOC0uNDIuNTMtLjE5LjE1LS40Mi4yNi0uNzEuMzUtLjI5LjA4LS42My4xMy0xLjAxLjEzLS40MyAwLS44My0uMDQtMS4xOC0uMTNzLS42Ni0uMjMtLjkxLS40MmMtLjI1LS4xOS0uNDUtLjQ0LS41OS0uNzUtLjE0LS4zMS0uMjUtLjc2LS4yNS0xLjIxSDYuNGMwIC41NS4wOCAxLjEzLjI0IDEuNTguMTYuNDUuMzcuODUuNjUgMS4yMS4yOC4zNS42LjY2Ljk4LjkyLjM3LjI2Ljc4LjQ4IDEuMjIuNjUuNDQuMTcuOS4zIDEuMzguMzkuNDguMDguOTYuMTMgMS40NC4xMy44IDAgMS41My0uMDkgMi4xOC0uMjhzMS4yMS0uNDUgMS42Ny0uNzljLjQ2LS4zNC44Mi0uNzcgMS4wNy0xLjI3cy4zOC0xLjA3LjM4LTEuNzFjMC0uNi0uMS0xLjE0LS4zMS0xLjYxLS4wNS0uMTEtLjExLS4yMy0uMTctLjMzSDIxeiIvPjwvc3ZnPg==)",N.firstChild.style.backgroundPosition="2px 2px",N.firstChild.style.backgroundSize="18px 18px",this.styleButtons([N])}var O=this.editorUi.toolbar.addButton("geSprite-top",mxResources.get("top"),x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP])),$),U=this.editorUi.toolbar.addButton("geSprite-middle",mxResources.get("middle"),x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE])),$),w=this.editorUi.toolbar.addButton("geSprite-bottom",mxResources.get("bottom"),x(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM])),$);if(this.styleButtons([O,U,w]),mxClient.IS_QUIRKS&&mxUtils.br(e),e.appendChild($),c.cellEditor.isContentEditing()){O.style.display="none",U.style.display="none",w.style.display="none",A.style.display="none",(l=this.editorUi.toolbar.addButton("geSprite-justifyfull",mxResources.get("block"),function(){1==l.style.opacity&&document.execCommand("justifyfull",!1,null)},$)).style.marginRight="9px",l.style.opacity=1,this.styleButtons([l,t=this.editorUi.toolbar.addButton("geSprite-subscript",mxResources.get("subscript")+" ("+Editor.ctrlKey+"+,)",function(){document.execCommand("subscript",!1,null)},$),i=this.editorUi.toolbar.addButton("geSprite-superscript",mxResources.get("superscript")+" ("+Editor.ctrlKey+"+.)",function(){document.execCommand("superscript",!1,null)},$)]),t.style.marginLeft="9px";var M=$.cloneNode(!1);M.style.paddingTop="4px";var D=[this.editorUi.toolbar.addButton("geSprite-orderedlist",mxResources.get("numberedList"),function(){document.execCommand("insertorderedlist",!1,null)},M),this.editorUi.toolbar.addButton("geSprite-unorderedlist",mxResources.get("bulletedList"),function(){document.execCommand("insertunorderedlist",!1,null)},M),this.editorUi.toolbar.addButton("geSprite-outdent",mxResources.get("decreaseIndent"),function(){document.execCommand("outdent",!1,null)},M),this.editorUi.toolbar.addButton("geSprite-indent",mxResources.get("increaseIndent"),function(){document.execCommand("indent",!1,null)},M),this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("removeFormat"),function(){document.execCommand("removeformat",!1,null)},M),this.editorUi.toolbar.addButton("geSprite-code",mxResources.get("html"),function(){c.cellEditor.toggleViewMode()},M)];this.styleButtons(D),D[D.length-2].style.marginLeft="9px",mxClient.IS_QUIRKS&&(mxUtils.br(e),M.style.height="40"),e.appendChild(M)}else b[2].style.marginRight="9px",_.style.marginRight="9px";var Y=E.cloneNode(!1);Y.style.marginLeft="0px",Y.style.paddingTop="8px",Y.style.paddingBottom="4px",Y.style.fontWeight="normal",mxUtils.write(Y,mxResources.get("position"));var B=document.createElement("select");B.style.position="absolute",B.style.right="20px",B.style.width="97px",B.style.marginTop="-2px";for(var G=["topLeft","top","topRight","left","center","right","bottomLeft","bottom","bottomRight"],k={topLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM],top:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM],topRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM],left:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE],center:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE],right:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE],bottomLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP],bottom:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP],bottomRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP]},F=0;F<G.length;F++){var P=document.createElement("option");P.setAttribute("value",G[F]),mxUtils.write(P,mxResources.get(G[F])),B.appendChild(P)}Y.appendChild(B);var W=E.cloneNode(!1);W.style.marginLeft="0px",W.style.paddingTop="4px",W.style.paddingBottom="4px",W.style.fontWeight="normal",mxUtils.write(W,mxResources.get("writingDirection"));var H=document.createElement("select");H.style.position="absolute",H.style.right="20px",H.style.width="97px",H.style.marginTop="-2px";for(var V=["automatic","leftToRight","rightToLeft"],z={automatic:null,leftToRight:mxConstants.TEXT_DIRECTION_LTR,rightToLeft:mxConstants.TEXT_DIRECTION_RTL},F=0;F<V.length;F++){var j=document.createElement("option");j.setAttribute("value",V[F]),mxUtils.write(j,mxResources.get(V[F])),H.appendChild(j)}W.appendChild(H),c.isEditing()||(e.appendChild(Y),mxEvent.addListener(B,"change",function(e){c.getModel().beginUpdate();try{var t=k[B.value];null!=t&&(c.setCellStyles(mxConstants.STYLE_LABEL_POSITION,t[0],c.getSelectionCells()),c.setCellStyles(mxConstants.STYLE_VERTICAL_LABEL_POSITION,t[1],c.getSelectionCells()),c.setCellStyles(mxConstants.STYLE_ALIGN,t[2],c.getSelectionCells()),c.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,t[3],c.getSelectionCells()))}finally{c.getModel().endUpdate()}mxEvent.consume(e)}),e.appendChild(W),mxEvent.addListener(H,"change",function(e){c.setCellStyles(mxConstants.STYLE_TEXT_DIRECTION,z[H.value],c.getSelectionCells()),mxEvent.consume(e)}));var K=document.createElement("input");K.style.textAlign="right",K.style.marginTop="4px",mxClient.IS_QUIRKS||(K.style.position="absolute",K.style.right="32px"),K.style.width="40px",K.style.height=mxClient.IS_QUIRKS?"21px":"17px",v.appendChild(K);var Q=null,Z=this.installInputHandler(K,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize,1,999," pt",function(e){if(!window.getSelection||mxClient.IS_IE||mxClient.IS_IE11){if(window.getSelection||document.selection){var t=null;if(document.selection)t=document.selection.createRange().parentElement();else{var i=window.getSelection();i.rangeCount>0&&(t=i.getRangeAt(0).commonAncestorContainer)}if(null!=t&&function e(t,i){for(;null!=i;){if(i===t)return!0;i=i.parentNode}return!1}(c.cellEditor.textarea,t)){Q=e,document.execCommand("fontSize",!1,"4");for(var l=c.cellEditor.textarea.getElementsByTagName("font"),n=0;n<l.length;n++)if("4"==l[n].getAttribute("size")){l[n].removeAttribute("size"),l[n].style.fontSize=Q+"px",window.setTimeout(function(){K.value=Q+" pt",Q=null},0);break}}}}else{var i=window.getSelection(),r=i.rangeCount>0?i.getRangeAt(0).commonAncestorContainer:c.cellEditor.textarea;function o(t,l){null!=c.cellEditor.textarea&&t!=c.cellEditor.textarea&&c.cellEditor.textarea.contains(t)&&(l||i.containsNode(t,!0))&&("FONT"==t.nodeName?(t.removeAttribute("size"),t.style.fontSize=e+"px"):mxUtils.getCurrentStyle(t).fontSize!=e+"px"&&(mxUtils.getCurrentStyle(t.parentNode).fontSize!=e+"px"?t.style.fontSize=e+"px":t.style.fontSize=""))}if((r==c.cellEditor.textarea||r.nodeType!=mxConstants.NODETYPE_ELEMENT)&&document.execCommand("fontSize",!1,"1"),r!=c.cellEditor.textarea&&(r=r.parentNode),null!=r&&r.nodeType==mxConstants.NODETYPE_ELEMENT){var l=r.getElementsByTagName("*");o(r);for(var n=0;n<l.length;n++)o(l[n])}K.value=e+" pt"}},!0),J=this.createStepper(K,Z,1,10,!0,Menus.prototype.defaultFontSize);J.style.display=K.style.display,J.style.marginTop="4px",mxClient.IS_QUIRKS||(J.style.right="20px"),v.appendChild(J);var C=L.getElementsByTagName("div")[0];C.style.cssFloat="right";var X=null,q="#ffffff",ee=null,et="#000000",ei=c.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("backgroundColor"),function(){return q},function(e){document.execCommand("backcolor",!1,e!=mxConstants.NONE?e:"transparent")},"#ffffff",{install:function(e){X=e},destroy:function(){X=null}},null,!0):this.createCellColorOption(mxResources.get("backgroundColor"),mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#ffffff",null,function(e){c.updateLabelElements(c.getSelectionCells(),function(e){e.style.backgroundColor=null})});ei.style.fontWeight="bold";var el=this.createCellColorOption(mxResources.get("borderColor"),mxConstants.STYLE_LABEL_BORDERCOLOR,"#000000");el.style.fontWeight="bold";var en=y.vertices.length>=1?c.stylesheet.getDefaultVertexStyle():c.stylesheet.getDefaultEdgeStyle(),er=c.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("fontColor"),function(){return et},function(e){if(mxClient.IS_FF){for(var t=c.cellEditor.textarea.getElementsByTagName("font"),i=[],l=0;l<t.length;l++)i.push({node:t[l],color:t[l].getAttribute("color")});document.execCommand("forecolor",!1,e!=mxConstants.NONE?e:"transparent");for(var n=c.cellEditor.textarea.getElementsByTagName("font"),l=0;l<n.length;l++)if(l>=i.length||n[l]!=i[l].node||n[l]==i[l].node&&n[l].getAttribute("color")!=i[l].color){var r=n[l].firstChild;if(null!=r&&"A"==r.nodeName&&null==r.nextSibling&&null!=r.firstChild){n[l].parentNode.insertBefore(r,n[l]);for(var t=r.firstChild;null!=t;){var o=t.nextSibling;n[l].appendChild(t),t=o}r.appendChild(n[l])}break}}else document.execCommand("forecolor",!1,e!=mxConstants.NONE?e:"transparent")},null!=en[mxConstants.STYLE_FONTCOLOR]?en[mxConstants.STYLE_FONTCOLOR]:"#000000",{install:function(e){ee=e},destroy:function(){ee=null}},null,!0):this.createCellColorOption(mxResources.get("fontColor"),mxConstants.STYLE_FONTCOLOR,null!=en[mxConstants.STYLE_FONTCOLOR]?en[mxConstants.STYLE_FONTCOLOR]:"#000000",function(e){e==mxConstants.NONE?ei.style.display="none":ei.style.display="",el.style.display=ei.style.display},function(e){e==mxConstants.NONE?c.setCellStyles(mxConstants.STYLE_NOLABEL,"1",c.getSelectionCells()):c.setCellStyles(mxConstants.STYLE_NOLABEL,null,c.getSelectionCells()),c.updateCellStyles(mxConstants.STYLE_FONTCOLOR,e,c.getSelectionCells()),c.updateLabelElements(c.getSelectionCells(),function(e){e.removeAttribute("color"),e.style.color=null})});er.style.fontWeight="bold",T.appendChild(er),T.appendChild(ei),c.cellEditor.isContentEditing()||T.appendChild(el),e.appendChild(T);var eo=this.createPanel();eo.style.paddingTop="2px",eo.style.paddingBottom="4px";var ea=this.createCellOption(mxResources.get("wordWrap"),mxConstants.STYLE_WHITE_SPACE,null,"wrap","null",null,null,!0);ea.style.fontWeight="bold",y.containsLabel||y.autoSize||0!=y.edges.length||eo.appendChild(ea);var es=this.createCellOption(mxResources.get("formattedText"),"html","0",null,null,null,h.actions.get("formattedText"));es.style.fontWeight="bold",eo.appendChild(es);var ed=this.createPanel();ed.style.paddingTop="10px",ed.style.paddingBottom="28px",ed.style.fontWeight="normal";var ep=document.createElement("div");ep.style.position="absolute",ep.style.width="70px",ep.style.marginTop="0px",ep.style.fontWeight="bold",mxUtils.write(ep,mxResources.get("spacing")),ed.appendChild(ep);var eu=this.addUnitInput(ed,"pt",91,44,function(){s.apply(this,arguments)}),eg=this.addUnitInput(ed,"pt",20,44,function(){d.apply(this,arguments)});mxUtils.br(ed),this.addLabel(ed,mxResources.get("top"),91),this.addLabel(ed,mxResources.get("global"),20),mxUtils.br(ed),mxUtils.br(ed);var eh=this.addUnitInput(ed,"pt",162,44,function(){p.apply(this,arguments)}),ec=this.addUnitInput(ed,"pt",91,44,function(){u.apply(this,arguments)}),ey=this.addUnitInput(ed,"pt",20,44,function(){g.apply(this,arguments)});if(mxUtils.br(ed),this.addLabel(ed,mxResources.get("left"),162),this.addLabel(ed,mxResources.get("bottom"),91),this.addLabel(ed,mxResources.get("right"),20),c.cellEditor.isContentEditing()){var eS=null,eE=null;e.appendChild(this.createRelativeOption(mxResources.get("lineheight"),null,null,function(e){var t=""==e.value?120:parseInt(e.value);t=Math.max(0,isNaN(t)?120:t),null!=eS&&(c.cellEditor.restoreSelection(eS),eS=null);for(var i=c.getSelectedElement();null!=i&&i.nodeType!=mxConstants.NODETYPE_ELEMENT;)i=i.parentNode;null!=i&&i==c.cellEditor.textarea&&null!=c.cellEditor.textarea.firstChild&&("P"!=c.cellEditor.textarea.firstChild.nodeName&&(c.cellEditor.textarea.innerHTML="<p>"+c.cellEditor.textarea.innerHTML+"</p>"),i=c.cellEditor.textarea.firstChild),null!=i&&null!=c.cellEditor.textarea&&i!=c.cellEditor.textarea&&c.cellEditor.textarea.contains(i)&&(i.style.lineHeight=t+"%"),e.value=t+" %"},function(e){eE=e,mxEvent.addListener(e,"mousedown",function(){document.activeElement==c.cellEditor.textarea&&(eS=c.cellEditor.saveSelection())}),mxEvent.addListener(e,"touchstart",function(){document.activeElement==c.cellEditor.textarea&&(eS=c.cellEditor.saveSelection())}),e.value="120 %"}));var ef=E.cloneNode(!1);ef.style.paddingLeft="0px";var em=this.editorUi.toolbar.addItems(["link","image"],ef,!0),D=[this.editorUi.toolbar.addButton("geSprite-horizontalrule",mxResources.get("insertHorizontalRule"),function(){document.execCommand("inserthorizontalrule",!1)},ef),this.editorUi.toolbar.addMenuFunctionInContainer(ef,"geSprite-table",mxResources.get("table"),!1,mxUtils.bind(this,function(e){this.editorUi.menus.addInsertTableItem(e)}))];this.styleButtons(em),this.styleButtons(D);var eC=this.createPanel();eC.style.paddingTop="10px",eC.style.paddingBottom="10px",eC.appendChild(this.createTitle(mxResources.get("insert"))),eC.appendChild(ef),e.appendChild(eC),mxClient.IS_QUIRKS&&(eC.style.height="70");var eT=E.cloneNode(!1);eT.style.paddingLeft="0px";var D=[this.editorUi.toolbar.addButton("geSprite-insertcolumnbefore",mxResources.get("insertColumnBefore"),mxUtils.bind(this,function(){try{null!=r&&c.insertColumn(r,null!=o?o.cellIndex:0)}catch(e){this.editorUi.handleError(e)}}),eT),this.editorUi.toolbar.addButton("geSprite-insertcolumnafter",mxResources.get("insertColumnAfter"),mxUtils.bind(this,function(){try{null!=r&&c.insertColumn(r,null!=o?o.cellIndex+1:-1)}catch(e){this.editorUi.handleError(e)}}),eT),this.editorUi.toolbar.addButton("geSprite-deletecolumn",mxResources.get("deleteColumn"),mxUtils.bind(this,function(){try{null!=r&&null!=o&&c.deleteColumn(r,o.cellIndex)}catch(e){this.editorUi.handleError(e)}}),eT),this.editorUi.toolbar.addButton("geSprite-insertrowbefore",mxResources.get("insertRowBefore"),mxUtils.bind(this,function(){try{null!=r&&null!=a&&c.insertRow(r,a.sectionRowIndex)}catch(e){this.editorUi.handleError(e)}}),eT),this.editorUi.toolbar.addButton("geSprite-insertrowafter",mxResources.get("insertRowAfter"),mxUtils.bind(this,function(){try{null!=r&&null!=a&&c.insertRow(r,a.sectionRowIndex+1)}catch(e){this.editorUi.handleError(e)}}),eT),this.editorUi.toolbar.addButton("geSprite-deleterow",mxResources.get("deleteRow"),mxUtils.bind(this,function(){try{null!=r&&null!=a&&c.deleteRow(r,a.sectionRowIndex)}catch(e){this.editorUi.handleError(e)}}),eT)];this.styleButtons(D),D[2].style.marginRight="9px";var eL=this.createPanel();eL.style.paddingTop="10px",eL.style.paddingBottom="10px",eL.appendChild(this.createTitle(mxResources.get("table"))),eL.appendChild(eT),mxClient.IS_QUIRKS&&(mxUtils.br(e),eL.style.height="70");var ev=E.cloneNode(!1);ev.style.paddingLeft="0px";var D=[this.editorUi.toolbar.addButton("geSprite-strokecolor",mxResources.get("borderColor"),mxUtils.bind(this,function(e){if(null!=r){var t=r.style.borderColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(e,t,i,l){return"#"+("0"+Number(t).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)+("0"+Number(l).toString(16)).substr(-2)});this.editorUi.pickColor(t,function(t){var i=null==o||null!=e&&mxEvent.isShiftDown(e)?r:o;c.processElements(i,function(e){e.style.border=null}),null==t||t==mxConstants.NONE?(i.removeAttribute("border"),i.style.border="",i.style.borderCollapse=""):(i.setAttribute("border","1"),i.style.border="1px solid "+t,i.style.borderCollapse="collapse")})}}),ev),this.editorUi.toolbar.addButton("geSprite-fillcolor",mxResources.get("backgroundColor"),mxUtils.bind(this,function(e){if(null!=r){var t=r.style.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(e,t,i,l){return"#"+("0"+Number(t).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)+("0"+Number(l).toString(16)).substr(-2)});this.editorUi.pickColor(t,function(t){var i=null==o||null!=e&&mxEvent.isShiftDown(e)?r:o;c.processElements(i,function(e){e.style.backgroundColor=null}),null==t||t==mxConstants.NONE?i.style.backgroundColor="":i.style.backgroundColor=t})}}),ev),this.editorUi.toolbar.addButton("geSprite-fit",mxResources.get("spacing"),function(){if(null!=r){var e=r.getAttribute("cellPadding")||0,t=new FilenameDialog(h,e,mxResources.get("apply"),mxUtils.bind(this,function(e){null!=e&&e.length>0?r.setAttribute("cellPadding",e):r.removeAttribute("cellPadding")}),mxResources.get("spacing"));h.showDialog(t.container,300,80,!0,!0),t.init()}},ev),this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),function(){null!=r&&r.setAttribute("align","left")},ev),this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),function(){null!=r&&r.setAttribute("align","center")},ev),this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),function(){null!=r&&r.setAttribute("align","right")},ev)];this.styleButtons(D),D[2].style.marginRight="9px",mxClient.IS_QUIRKS&&(mxUtils.br(eL),mxUtils.br(eL)),eL.appendChild(ev),e.appendChild(eL),n=eL}else e.appendChild(eo),e.appendChild(this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_TEXT_OPACITY)),e.appendChild(ed);function eb(e,t){mxClient.IS_IE&&(mxClient.IS_QUIRKS||document.documentMode<10)?e.style.filter=t?"progid:DXImageTransform.Microsoft.Gradient(StartColorStr='#c5ecff', EndColorStr='#87d4fb', GradientType=0)":"":e.style.backgroundImage=t?"linear-gradient(#c5ecff 0px,#87d4fb 100%)":""}var eA=mxUtils.bind(this,function(e,t,i){y=this.format.getSelectionState();var l=mxUtils.getValue(y.style,mxConstants.STYLE_FONTSTYLE,0);if(eb(b[0],(l&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD),eb(b[1],(l&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC),eb(b[2],(l&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE),L.firstChild.nodeValue=mxUtils.getValue(y.style,mxConstants.STYLE_FONTFAMILY,Menus.prototype.defaultFont),eb(A,"0"==mxUtils.getValue(y.style,mxConstants.STYLE_HORIZONTAL,"1")),i||document.activeElement!=K){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize));K.value=isNaN(n)?"":n+" pt"}var r=mxUtils.getValue(y.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER);eb(I,r==mxConstants.ALIGN_LEFT),eb(R,r==mxConstants.ALIGN_CENTER),eb(_,r==mxConstants.ALIGN_RIGHT);var o=mxUtils.getValue(y.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE);eb(O,o==mxConstants.ALIGN_TOP),eb(U,o==mxConstants.ALIGN_MIDDLE),eb(w,o==mxConstants.ALIGN_BOTTOM);var a=mxUtils.getValue(y.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),s=mxUtils.getValue(y.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);a==mxConstants.ALIGN_LEFT&&s==mxConstants.ALIGN_TOP?B.value="topLeft":a==mxConstants.ALIGN_CENTER&&s==mxConstants.ALIGN_TOP?B.value="top":a==mxConstants.ALIGN_RIGHT&&s==mxConstants.ALIGN_TOP?B.value="topRight":a==mxConstants.ALIGN_LEFT&&s==mxConstants.ALIGN_BOTTOM?B.value="bottomLeft":a==mxConstants.ALIGN_CENTER&&s==mxConstants.ALIGN_BOTTOM?B.value="bottom":a==mxConstants.ALIGN_RIGHT&&s==mxConstants.ALIGN_BOTTOM?B.value="bottomRight":a==mxConstants.ALIGN_LEFT?B.value="left":a==mxConstants.ALIGN_RIGHT?B.value="right":B.value="center";var d=mxUtils.getValue(y.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);if(d==mxConstants.TEXT_DIRECTION_RTL?H.value="rightToLeft":d==mxConstants.TEXT_DIRECTION_LTR?H.value="leftToRight":d==mxConstants.TEXT_DIRECTION_AUTO&&(H.value="automatic"),i||document.activeElement!=eg){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_SPACING,2));eg.value=isNaN(n)?"":n+" pt"}if(i||document.activeElement!=eu){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_SPACING_TOP,0));eu.value=isNaN(n)?"":n+" pt"}if(i||document.activeElement!=ey){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_SPACING_RIGHT,0));ey.value=isNaN(n)?"":n+" pt"}if(i||document.activeElement!=ec){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_SPACING_BOTTOM,0));ec.value=isNaN(n)?"":n+" pt"}if(i||document.activeElement!=eh){var n=parseFloat(mxUtils.getValue(y.style,mxConstants.STYLE_SPACING_LEFT,0));eh.value=isNaN(n)?"":n+" pt"}});if(d=this.installInputHandler(eg,mxConstants.STYLE_SPACING,2,-999,999," pt"),s=this.installInputHandler(eu,mxConstants.STYLE_SPACING_TOP,0,-999,999," pt"),g=this.installInputHandler(ey,mxConstants.STYLE_SPACING_RIGHT,0,-999,999," pt"),u=this.installInputHandler(ec,mxConstants.STYLE_SPACING_BOTTOM,0,-999,999," pt"),p=this.installInputHandler(eh,mxConstants.STYLE_SPACING_LEFT,0,-999,999," pt"),this.addKeyHandler(K,eA),this.addKeyHandler(eg,eA),this.addKeyHandler(eu,eA),this.addKeyHandler(ey,eA),this.addKeyHandler(ec,eA),this.addKeyHandler(eh,eA),c.getModel().addListener(mxEvent.CHANGE,eA),this.listeners.push({destroy:function(){c.getModel().removeListener(eA)}}),eA(),c.cellEditor.isContentEditing()){var e$=!1,ex=function(){e$||(e$=!0,window.setTimeout(function(){var e=c.getSelectedEditingElement();if(null!=e){function s(e,t,i){if(null==i.style||null==t)return"";var l=t.lineHeight;return null!=i.style.lineHeight&&"%"==i.style.lineHeight.substring(i.style.lineHeight.length-1)?parseInt(i.style.lineHeight)/100:"px"==l.substring(l.length-2)?parseFloat(l)/e:parseInt(l)}function d(e){var t=null!=e?e.fontSize:null;return null!=t&&"px"==t.substring(t.length-2)?parseFloat(t):mxConstants.DEFAULT_FONTSIZE}var p=mxUtils.getCurrentStyle(e),u=d(p),g=s(u,p,e),h=e.getElementsByTagName("*");if(h.length>0&&window.getSelection&&!mxClient.IS_IE&&!mxClient.IS_IE11){for(var S=window.getSelection(),E=0;E<h.length;E++)if(S.containsNode(h[E],!0)){u=Math.max(d(temp=mxUtils.getCurrentStyle(h[E])),u);var f=s(u,temp,h[E]);(f!=g||isNaN(f))&&(g="")}}function m(t){if(null!=c.getParentByName(e,t,c.cellEditor.textarea))return!0;for(var i=e;null!=i&&1==i.childNodes.length;)if((i=i.childNodes[0]).nodeName==t)return!0;return!1}function C(e,t){if(null!=e&&null!=t){if(e==t)return!0;if(e.length>t.length+1)return e.substring(e.length-t.length-1,e.length)=="-"+t}return!1}if(null!=p){if(eb(b[0],"bold"==p.fontWeight||p.fontWeight>400||m("B")||m("STRONG")),eb(b[1],"italic"==p.fontStyle||m("I")||m("EM")),eb(b[2],m("U")),eb(i,m("SUP")),eb(t,m("SUB")),c.cellEditor.isTableSelected())eb(l,C(p.textAlign,"justify")),eb(I,C(p.textAlign,"left")),eb(R,C(p.textAlign,"center")),eb(_,C(p.textAlign,"right"));else{var T=c.cellEditor.align||mxUtils.getValue(y.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER);C(p.textAlign,"justify")?(eb(l,C(p.textAlign,"justify")),eb(I,!1),eb(R,!1),eb(_,!1)):(eb(l,!1),eb(I,T==mxConstants.ALIGN_LEFT),eb(R,T==mxConstants.ALIGN_CENTER),eb(_,T==mxConstants.ALIGN_RIGHT))}if(a=null==(r=c.getParentByName(e,"TABLE",c.cellEditor.textarea))?null:c.getParentByName(e,"TR",r),o=null==r?null:c.getParentByNames(e,["TD","TH"],r),n.style.display=null!=r?"":"none",document.activeElement!=K){"FONT"==e.nodeName&&"4"==e.getAttribute("size")&&null!=Q?(e.removeAttribute("size"),e.style.fontSize=Q+" pt",Q=null):K.value=isNaN(u)?"":u+" pt";var f=parseFloat(g);isNaN(f)?eE.value="100 %":eE.value=Math.round(100*f)+" %"}var v=p.color.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(e,t,i,l){return"#"+("0"+Number(t).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)+("0"+Number(l).toString(16)).substr(-2)}),A=p.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(e,t,i,l){return"#"+("0"+Number(t).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)+("0"+Number(l).toString(16)).substr(-2)});null!=ee&&ee(et="#"==v.charAt(0)?v:"#000000",!0),null!=X&&X(q="#"==A.charAt(0)?A:null,!0),null!=L.firstChild&&(L.firstChild.nodeValue=Graph.stripQuotes(p.fontFamily))}}e$=!1},0))};(mxClient.IS_FF||mxClient.IS_EDGE||mxClient.IS_IE||mxClient.IS_IE11)&&mxEvent.addListener(c.cellEditor.textarea,"DOMSubtreeModified",ex),mxEvent.addListener(c.cellEditor.textarea,"input",ex),mxEvent.addListener(c.cellEditor.textarea,"touchend",ex),mxEvent.addListener(c.cellEditor.textarea,"mouseup",ex),mxEvent.addListener(c.cellEditor.textarea,"keyup",ex),this.listeners.push({destroy:function(){}}),ex()}return e},StyleFormatPanel=function(e,t,i){BaseFormatPanel.call(this,e,t,i),this.init()},mxUtils.extend(StyleFormatPanel,BaseFormatPanel),StyleFormatPanel.prototype.defaultStrokeColor="black",StyleFormatPanel.prototype.init=function(){this.editorUi.editor.graph;var e=this.format.getSelectionState();if(!e.containsLabel){e.containsImage&&1==e.vertices.length&&"image"==e.style.shape&&null!=e.style.image&&"data:image/svg+xml;"==e.style.image.substring(0,19)&&this.container.appendChild(this.addSvgStyles(this.createPanel())),e.containsImage&&"image"!=e.style.shape||this.container.appendChild(this.addFill(this.createPanel())),this.container.appendChild(this.addStroke(this.createPanel())),this.container.appendChild(this.addLineJumps(this.createPanel()));var t=this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_OPACITY,41);t.style.paddingTop="8px",t.style.paddingBottom="8px",this.container.appendChild(t),this.container.appendChild(this.addEffects(this.createPanel()))}var i=this.addEditOps(this.createPanel());null!=i.firstChild&&mxUtils.br(i),this.container.appendChild(this.addStyleOps(i))},StyleFormatPanel.prototype.getCssRules=function(e){var t=document.implementation.createHTMLDocument(""),i=document.createElement("style");return mxUtils.setTextContent(i,e),t.body.appendChild(i),i.sheet.cssRules},StyleFormatPanel.prototype.addSvgStyles=function(e){this.editorUi.editor.graph;var t=this.format.getSelectionState();e.style.paddingTop="6px",e.style.paddingBottom="6px",e.style.fontWeight="bold",e.style.display="none";try{var i=t.style.editableCssRules;if(null!=i){var l=RegExp(i),n=t.style.image.substring(t.style.image.indexOf(",")+1),r=window.atob?atob(n):Base64.decode(n,!0),o=mxUtils.parseXml(r);if(null!=o)for(var a=o.getElementsByTagName("style"),s=0;s<a.length;s++)for(var d=this.getCssRules(mxUtils.getTextContent(a[s])),p=0;p<d.length;p++)this.addSvgRule(e,d[p],o,a[s],d,p,l)}}catch(u){}return e},StyleFormatPanel.prototype.addSvgRule=function(e,t,i,l,n,r,o){var a=this.editorUi.editor.graph;if(o.test(t.selectorText)){var s=mxUtils.bind(this,function(t,o,s){var d=mxUtils.trim(t.style[o]);if(""!=d&&"url("!=d.substring(0,4)){var p=this.createColorOption(s+" "+t.selectorText,function(){var e;return(e=(e=d).match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},function(e){n[r].style[o]=e;for(var t="",s=0;s<n.length;s++)t+=n[s].cssText+" ";l.textContent=t;var d=mxUtils.getXml(i.documentElement);a.setCellStyles(mxConstants.STYLE_IMAGE,"data:image/svg+xml,"+(window.btoa?btoa(d):Base64.encode(d,!0)),a.getSelectionCells())},"#ffffff",{install:function(e){},destroy:function(){}});e.appendChild(p),e.style.display=""}});s(t,"fill",mxResources.get("fill")),s(t,"stroke",mxResources.get("line")),s(t,"stop-color",mxResources.get("gradient"))}},StyleFormatPanel.prototype.addEditOps=function(e){var t=this.format.getSelectionState(),i=null;if(1==this.editorUi.editor.graph.getSelectionCount()&&((i=mxUtils.button(mxResources.get("editStyle"),mxUtils.bind(this,function(e){this.editorUi.actions.get("editStyle").funct()}))).setAttribute("title",mxResources.get("editStyle")+" ("+this.editorUi.actions.get("editStyle").shortcut+")"),i.style.width="202px",i.style.marginBottom="2px",e.appendChild(i)),t.image){var l=mxUtils.button(mxResources.get("editImage"),mxUtils.bind(this,function(e){this.editorUi.actions.get("image").funct()}));l.setAttribute("title",mxResources.get("editImage")),l.style.marginBottom="2px",null==i?l.style.width="202px":(i.style.width="100px",l.style.width="100px",l.style.marginLeft="2px"),e.appendChild(l)}return e},StyleFormatPanel.prototype.addFill=function(e){var t=this.editorUi.editor.graph,i=this.format.getSelectionState();e.style.paddingTop="6px",e.style.paddingBottom="6px";var l=document.createElement("select");l.style.position="absolute",l.style.marginTop="-2px",l.style.right=mxClient.IS_QUIRKS?"52px":"72px",l.style.width="70px";var n=l.cloneNode(!1);mxEvent.addListener(l,"click",function(e){mxEvent.consume(e)}),mxEvent.addListener(n,"click",function(e){mxEvent.consume(e)});var r=i.vertices.length>=1?t.stylesheet.getDefaultVertexStyle():t.stylesheet.getDefaultEdgeStyle(),o=this.createCellColorOption(mxResources.get("gradient"),mxConstants.STYLE_GRADIENTCOLOR,null!=r[mxConstants.STYLE_GRADIENTCOLOR]?r[mxConstants.STYLE_GRADIENTCOLOR]:"#ffffff",function(e){null==e||e==mxConstants.NONE?l.style.display="none":l.style.display=""},function(e){t.updateCellStyles(mxConstants.STYLE_GRADIENTCOLOR,e,t.getSelectionCells())}),a="image"==i.style.shape?mxConstants.STYLE_IMAGE_BACKGROUND:mxConstants.STYLE_FILLCOLOR,s="image"==i.style.shape?mxResources.get("background"):mxResources.get("fill"),r=i.vertices.length>=1?t.stylesheet.getDefaultVertexStyle():t.stylesheet.getDefaultEdgeStyle(),d=this.createCellColorOption(s,a,null!=r[a]?r[a]:"#ffffff",null,mxUtils.bind(this,function(e){t.updateCellStyles(a,e,t.getSelectionCells())}));d.style.fontWeight="bold";var p=mxUtils.getValue(i.style,a,null);o.style.display=null!=p&&p!=mxConstants.NONE&&i.fill&&"image"!=i.style.shape?"":"none";for(var u=[mxConstants.DIRECTION_NORTH,mxConstants.DIRECTION_EAST,mxConstants.DIRECTION_SOUTH,mxConstants.DIRECTION_WEST],g=0;g<u.length;g++){var h=document.createElement("option");h.setAttribute("value",u[g]),mxUtils.write(h,mxResources.get(u[g])),l.appendChild(h)}o.appendChild(l);for(var g=0;g<Editor.roughFillStyles.length;g++){var c=document.createElement("option");c.setAttribute("value",Editor.roughFillStyles[g].val),mxUtils.write(c,Editor.roughFillStyles[g].dispName),n.appendChild(c)}d.appendChild(n);var y=mxUtils.bind(this,function(){i=this.format.getSelectionState();var t=mxUtils.getValue(i.style,mxConstants.STYLE_GRADIENT_DIRECTION,mxConstants.DIRECTION_SOUTH),r=mxUtils.getValue(i.style,"fillStyle","auto");""==t&&(t=mxConstants.DIRECTION_SOUTH),l.value=t,n.value=r,e.style.display=i.fill?"":"none";var a=mxUtils.getValue(i.style,mxConstants.STYLE_FILLCOLOR,null);!i.fill||i.containsImage||null==a||a==mxConstants.NONE||"filledEdge"==i.style.shape?(n.style.display="none",o.style.display="none"):(n.style.display="1"==i.style.sketch?"":"none",o.style.display="1"!=i.style.sketch||"solid"==r||"auto"==r?"":"none")});t.getModel().addListener(mxEvent.CHANGE,y),this.listeners.push({destroy:function(){t.getModel().removeListener(y)}}),y(),mxEvent.addListener(l,"change",function(e){t.setCellStyles(mxConstants.STYLE_GRADIENT_DIRECTION,l.value,t.getSelectionCells()),mxEvent.consume(e)}),mxEvent.addListener(n,"change",function(e){t.setCellStyles("fillStyle",n.value,t.getSelectionCells()),mxEvent.consume(e)}),e.appendChild(d),e.appendChild(o);for(var S=this.getCustomColors(),g=0;g<S.length;g++)e.appendChild(this.createCellColorOption(S[g].title,S[g].key,S[g].defaultValue));return e},StyleFormatPanel.prototype.getCustomColors=function(){var e=this.format.getSelectionState(),t=[];return("swimlane"==e.style.shape||"table"==e.style.shape)&&t.push({title:mxResources.get("laneColor"),key:"swimlaneFillColor",defaultValue:"#ffffff"}),t},StyleFormatPanel.prototype.addStroke=function(e){var t,i,l,n,r,o=this.editorUi,a=o.editor.graph,s=this.format.getSelectionState();e.style.paddingTop="4px",e.style.paddingBottom="4px",e.style.whiteSpace="normal";var d=document.createElement("div");d.style.fontWeight="bold",s.stroke||(d.style.display="none");var p=document.createElement("select");p.style.position="absolute",p.style.marginTop="-2px",p.style.right="72px",p.style.width="80px";for(var u=["sharp","rounded","curved"],g=0;g<u.length;g++){var h=document.createElement("option");h.setAttribute("value",u[g]),mxUtils.write(h,mxResources.get(u[g])),p.appendChild(h)}mxEvent.addListener(p,"change",function(e){a.getModel().beginUpdate();try{var t=[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],i=["0",null];"rounded"==p.value?i=["1",null]:"curved"==p.value&&(i=[null,"1"]);for(var l=0;l<t.length;l++)a.setCellStyles(t[l],i[l],a.getSelectionCells());o.fireEvent(new mxEventObject("styleChanged","keys",t,"values",i,"cells",a.getSelectionCells()))}finally{a.getModel().endUpdate()}mxEvent.consume(e)}),mxEvent.addListener(p,"click",function(e){mxEvent.consume(e)});var c="image"==s.style.shape?mxConstants.STYLE_IMAGE_BORDER:mxConstants.STYLE_STROKECOLOR,y="image"==s.style.shape?mxResources.get("border"):mxResources.get("line"),S=s.vertices.length>=1?a.stylesheet.getDefaultVertexStyle():a.stylesheet.getDefaultEdgeStyle(),E=this.createCellColorOption(y,c,null!=S[c]?S[c]:"#000000",null,mxUtils.bind(this,function(e){a.updateCellStyles(c,e,a.getSelectionCells())}));E.appendChild(p),d.appendChild(E);var f=d.cloneNode(!1);f.style.fontWeight="normal",f.style.whiteSpace="nowrap",f.style.position="relative",f.style.paddingLeft="16px",f.style.marginBottom="2px",f.style.marginTop="2px",f.className="geToolbarContainer";var m=mxUtils.bind(this,function(e,t,i,l,n){var r=this.editorUi.menus.styleChange(e,"",l,n,"geIcon",null),o=document.createElement("div");return o.style.width=t+"px",o.style.height="1px",o.style.borderBottom="1px "+i+" "+this.defaultStrokeColor,o.style.paddingTop="6px",r.firstChild.firstChild.style.padding="0px 4px 0px 4px",r.firstChild.firstChild.style.width=t+"px",r.firstChild.firstChild.appendChild(o),r}),C=this.editorUi.toolbar.addMenuFunctionInContainer(f,"geSprite-orthogonal",mxResources.get("pattern"),!1,mxUtils.bind(this,function(e){m(e,75,"solid",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],[null,null]).setAttribute("title",mxResources.get("solid")),m(e,75,"dashed",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1",null]).setAttribute("title",mxResources.get("dashed")),m(e,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 1"]).setAttribute("title",mxResources.get("dotted")+" (1)"),m(e,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 2"]).setAttribute("title",mxResources.get("dotted")+" (2)"),m(e,75,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 4"]).setAttribute("title",mxResources.get("dotted")+" (3)")})),T=f.cloneNode(!1),L=this.editorUi.toolbar.addMenuFunctionInContainer(T,"geSprite-connection",mxResources.get("connection"),!1,mxUtils.bind(this,function(e){this.editorUi.menus.styleChange(e,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],[null,null,null,null],"geIcon geSprite geSprite-connection",null,!0).setAttribute("title",mxResources.get("line")),this.editorUi.menus.styleChange(e,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["link",null,null,null],"geIcon geSprite geSprite-linkedge",null,!0).setAttribute("title",mxResources.get("link")),this.editorUi.menus.styleChange(e,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["flexArrow",null,null,null],"geIcon geSprite geSprite-arrow",null,!0).setAttribute("title",mxResources.get("arrow")),this.editorUi.menus.styleChange(e,"",[mxConstants.STYLE_SHAPE,mxConstants.STYLE_STARTSIZE,mxConstants.STYLE_ENDSIZE,"width"],["arrow",null,null,null],"geIcon geSprite geSprite-simplearrow",null,!0).setAttribute("title",mxResources.get("simpleArrow"))})),v=this.editorUi.toolbar.addMenuFunctionInContainer(T,"geSprite-orthogonal",mxResources.get("pattern"),!1,mxUtils.bind(this,function(e){m(e,33,"solid",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],[null,null]).setAttribute("title",mxResources.get("solid")),m(e,33,"dashed",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1",null]).setAttribute("title",mxResources.get("dashed")),m(e,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 1"]).setAttribute("title",mxResources.get("dotted")+" (1)"),m(e,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 2"]).setAttribute("title",mxResources.get("dotted")+" (2)"),m(e,33,"dotted",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],["1","1 4"]).setAttribute("title",mxResources.get("dotted")+" (3)")})),b=f.cloneNode(!1),A=document.createElement("input");A.style.textAlign="right",A.style.marginTop="2px",A.style.width="41px",A.setAttribute("title",mxResources.get("linewidth")),f.appendChild(A);var $=A.cloneNode(!0);function x(e){var t=parseInt(A.value);(t=Math.min(999,Math.max(1,isNaN(t)?1:t)))!=mxUtils.getValue(s.style,mxConstants.STYLE_STROKEWIDTH,1)&&(a.setCellStyles(mxConstants.STYLE_STROKEWIDTH,t,a.getSelectionCells()),o.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[t],"cells",a.getSelectionCells()))),A.value=t+" pt",mxEvent.consume(e)}function I(e){var t=parseInt($.value);(t=Math.min(999,Math.max(1,isNaN(t)?1:t)))!=mxUtils.getValue(s.style,mxConstants.STYLE_STROKEWIDTH,1)&&(a.setCellStyles(mxConstants.STYLE_STROKEWIDTH,t,a.getSelectionCells()),o.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[t],"cells",a.getSelectionCells()))),$.value=t+" pt",mxEvent.consume(e)}T.appendChild($);var R=this.createStepper(A,x,1,9);R.style.display=A.style.display,R.style.marginTop="2px",f.appendChild(R);var _=this.createStepper($,I,1,9);_.style.display=$.style.display,_.style.marginTop="2px",T.appendChild(_),mxClient.IS_QUIRKS?(A.style.height="17px",$.style.height="17px"):(A.style.position="absolute",A.style.height="15px",A.style.left="141px",R.style.left="190px",$.style.position="absolute",$.style.left="141px",$.style.height="15px",_.style.left="190px"),mxEvent.addListener(A,"blur",x),mxEvent.addListener(A,"change",x),mxEvent.addListener($,"blur",I),mxEvent.addListener($,"change",I),mxClient.IS_QUIRKS&&(mxUtils.br(b),mxUtils.br(b));var N=this.editorUi.toolbar.addMenuFunctionInContainer(b,"geSprite-orthogonal",mxResources.get("waypoints"),!1,mxUtils.bind(this,function(e){"arrow"!=s.style.shape&&(this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],[null,null,null],"geIcon geSprite geSprite-straight",null,!0).setAttribute("title",mxResources.get("straight")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle",null,null],"geIcon geSprite geSprite-orthogonal",null,!0).setAttribute("title",mxResources.get("orthogonal")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalelbow",null,!0).setAttribute("title",mxResources.get("simple")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["elbowEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalelbow",null,!0).setAttribute("title",mxResources.get("simple")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle",null,null,null],"geIcon geSprite geSprite-horizontalisometric",null,!0).setAttribute("title",mxResources.get("isometric")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_ELBOW,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["isometricEdgeStyle","vertical",null,null],"geIcon geSprite geSprite-verticalisometric",null,!0).setAttribute("title",mxResources.get("isometric")),"connector"==s.style.shape&&this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["orthogonalEdgeStyle","1",null],"geIcon geSprite geSprite-curved",null,!0).setAttribute("title",mxResources.get("curved")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_EDGE,mxConstants.STYLE_CURVED,mxConstants.STYLE_NOEDGESTYLE],["entityRelationEdgeStyle",null,null],"geIcon geSprite geSprite-entity",null,!0).setAttribute("title",mxResources.get("entityRelation")))})),O=this.editorUi.toolbar.addMenuFunctionInContainer(b,"geSprite-startclassic",mxResources.get("linestart"),!1,mxUtils.bind(this,function(e){if("connector"==s.style.shape||"flexArrow"==s.style.shape||"filledEdge"==s.style.shape){var t=this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.NONE,0],"geIcon",null,!1);t.setAttribute("title",mxResources.get("none")),t.firstChild.firstChild.innerHTML='<font style="font-size:10px;">'+mxUtils.htmlEntities(mxResources.get("none"))+"</font>","connector"==s.style.shape||"filledEdge"==s.style.shape?(this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC,1],"geIcon geSprite geSprite-startclassic",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC_THIN,1],"geIcon geSprite geSprite-startclassicthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OPEN,0],"geIcon geSprite geSprite-startopen",null,!1).setAttribute("title",mxResources.get("openArrow")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OPEN_THIN,0],"geIcon geSprite geSprite-startopenthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["openAsync",0],"geIcon geSprite geSprite-startopenasync",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK,1],"geIcon geSprite geSprite-startblock",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK_THIN,1],"geIcon geSprite geSprite-startblockthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["async",1],"geIcon geSprite geSprite-startasync",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OVAL,1],"geIcon geSprite geSprite-startoval",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND,1],"geIcon geSprite geSprite-startdiamond",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND_THIN,1],"geIcon geSprite geSprite-startthindiamond",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC,0],"geIcon geSprite geSprite-startclassictrans",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_CLASSIC_THIN,0],"geIcon geSprite geSprite-startclassicthintrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK,0],"geIcon geSprite geSprite-startblocktrans",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_BLOCK_THIN,0],"geIcon geSprite geSprite-startblockthintrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["async",0],"geIcon geSprite geSprite-startasynctrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_OVAL,0],"geIcon geSprite geSprite-startovaltrans",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND,0],"geIcon geSprite geSprite-startdiamondtrans",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],[mxConstants.ARROW_DIAMOND_THIN,0],"geIcon geSprite geSprite-startthindiamondtrans",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["box",0],"geIcon geSprite geSvgSprite geSprite-box",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["halfCircle",0],"geIcon geSprite geSvgSprite geSprite-halfCircle",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["dash",0],"geIcon geSprite geSprite-startdash",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["cross",0],"geIcon geSprite geSprite-startcross",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["circlePlus",0],"geIcon geSprite geSprite-startcircleplus",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["circle",1],"geIcon geSprite geSprite-startcircle",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERone",0],"geIcon geSprite geSprite-starterone",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERmandOne",0],"geIcon geSprite geSprite-starteronetoone",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERmany",0],"geIcon geSprite geSprite-startermany",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERoneToMany",0],"geIcon geSprite geSprite-starteronetomany",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERzeroToOne",1],"geIcon geSprite geSprite-starteroneopt",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW,"startFill"],["ERzeroToMany",1],"geIcon geSprite geSprite-startermanyopt",null,!1)):this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_STARTARROW],[mxConstants.ARROW_BLOCK],"geIcon geSprite geSprite-startblocktrans",null,!1).setAttribute("title",mxResources.get("block"))}})),U=this.editorUi.toolbar.addMenuFunctionInContainer(b,"geSprite-endclassic",mxResources.get("lineend"),!1,mxUtils.bind(this,function(e){if("connector"==s.style.shape||"flexArrow"==s.style.shape||"filledEdge"==s.style.shape){var t=this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.NONE,0],"geIcon",null,!1);t.setAttribute("title",mxResources.get("none")),t.firstChild.firstChild.innerHTML='<font style="font-size:10px;">'+mxUtils.htmlEntities(mxResources.get("none"))+"</font>","connector"==s.style.shape||"filledEdge"==s.style.shape?(this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC,1],"geIcon geSprite geSprite-endclassic",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC_THIN,1],"geIcon geSprite geSprite-endclassicthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OPEN,0],"geIcon geSprite geSprite-endopen",null,!1).setAttribute("title",mxResources.get("openArrow")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OPEN_THIN,0],"geIcon geSprite geSprite-endopenthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["openAsync",0],"geIcon geSprite geSprite-endopenasync",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK,1],"geIcon geSprite geSprite-endblock",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK_THIN,1],"geIcon geSprite geSprite-endblockthin",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["async",1],"geIcon geSprite geSprite-endasync",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OVAL,1],"geIcon geSprite geSprite-endoval",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND,1],"geIcon geSprite geSprite-enddiamond",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND_THIN,1],"geIcon geSprite geSprite-endthindiamond",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC,0],"geIcon geSprite geSprite-endclassictrans",null,!1).setAttribute("title",mxResources.get("classic")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_CLASSIC_THIN,0],"geIcon geSprite geSprite-endclassicthintrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK,0],"geIcon geSprite geSprite-endblocktrans",null,!1).setAttribute("title",mxResources.get("block")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_BLOCK_THIN,0],"geIcon geSprite geSprite-endblockthintrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["async",0],"geIcon geSprite geSprite-endasynctrans",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_OVAL,0],"geIcon geSprite geSprite-endovaltrans",null,!1).setAttribute("title",mxResources.get("oval")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND,0],"geIcon geSprite geSprite-enddiamondtrans",null,!1).setAttribute("title",mxResources.get("diamond")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],[mxConstants.ARROW_DIAMOND_THIN,0],"geIcon geSprite geSprite-endthindiamondtrans",null,!1).setAttribute("title",mxResources.get("diamondThin")),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["box",0],"geIcon geSprite geSvgSprite geFlipSprite geSprite-box",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["halfCircle",0],"geIcon geSprite geSvgSprite geFlipSprite geSprite-halfCircle",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["dash",0],"geIcon geSprite geSprite-enddash",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["cross",0],"geIcon geSprite geSprite-endcross",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["circlePlus",0],"geIcon geSprite geSprite-endcircleplus",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["circle",1],"geIcon geSprite geSprite-endcircle",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERone",0],"geIcon geSprite geSprite-enderone",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERmandOne",0],"geIcon geSprite geSprite-enderonetoone",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERmany",0],"geIcon geSprite geSprite-endermany",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERoneToMany",0],"geIcon geSprite geSprite-enderonetomany",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERzeroToOne",1],"geIcon geSprite geSprite-enderoneopt",null,!1),this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW,"endFill"],["ERzeroToMany",1],"geIcon geSprite geSprite-endermanyopt",null,!1)):this.editorUi.menus.edgeStyleChange(e,"",[mxConstants.STYLE_ENDARROW],[mxConstants.ARROW_BLOCK],"geIcon geSprite geSprite-endblocktrans",null,!1).setAttribute("title",mxResources.get("block"))}}));this.addArrow(L,8),this.addArrow(N),this.addArrow(O),this.addArrow(U);var w=this.addArrow(C,9);w.className="geIcon",w.style.width="auto";var M=this.addArrow(v,9);M.className="geIcon",M.style.width="22px";var D=document.createElement("div");D.style.width="85px",D.style.height="1px",D.style.borderBottom="1px solid "+this.defaultStrokeColor,D.style.marginBottom="9px",w.appendChild(D);var Y=document.createElement("div");Y.style.width="23px",Y.style.height="1px",Y.style.borderBottom="1px solid "+this.defaultStrokeColor,Y.style.marginBottom="9px",M.appendChild(Y),C.style.height="15px",v.style.height="15px",L.style.height="15px",N.style.height="17px",O.style.marginLeft="3px",O.style.height="17px",U.style.marginLeft="3px",U.style.height="17px",e.appendChild(d),e.appendChild(T),e.appendChild(f);var B=f.cloneNode(!1);B.style.paddingBottom="6px",B.style.paddingTop="4px",B.style.fontWeight="normal";var G=document.createElement("div");G.style.position="absolute",G.style.marginLeft="3px",G.style.marginBottom="12px",G.style.marginTop="2px",G.style.fontWeight="normal",G.style.width="76px",mxUtils.write(G,mxResources.get("lineend")),B.appendChild(G);var k=this.addUnitInput(B,"pt",74,33,function(){t.apply(this,arguments)}),F=this.addUnitInput(B,"pt",20,33,function(){i.apply(this,arguments)});mxUtils.br(B);var P=document.createElement("div");P.style.height="8px",B.appendChild(P),G=G.cloneNode(!1),mxUtils.write(G,mxResources.get("linestart")),B.appendChild(G);var W=this.addUnitInput(B,"pt",74,33,function(){l.apply(this,arguments)}),H=this.addUnitInput(B,"pt",20,33,function(){n.apply(this,arguments)});mxUtils.br(B),this.addLabel(B,mxResources.get("spacing"),74,50),this.addLabel(B,mxResources.get("size"),20,50),mxUtils.br(B);var V=d.cloneNode(!1);V.style.fontWeight="normal",V.style.position="relative",V.style.paddingLeft="16px",V.style.marginBottom="2px",V.style.marginTop="6px",V.style.borderWidth="0px",V.style.paddingBottom="18px";var G=document.createElement("div");G.style.position="absolute",G.style.marginLeft="3px",G.style.marginBottom="12px",G.style.marginTop="1px",G.style.fontWeight="normal",G.style.width="120px",mxUtils.write(G,mxResources.get("perimeter")),V.appendChild(G);var z=this.addUnitInput(V,"pt",20,41,function(){r.apply(this,arguments)});s.edges.length==a.getSelectionCount()?(e.appendChild(b),mxClient.IS_QUIRKS&&(mxUtils.br(e),mxUtils.br(e)),e.appendChild(B)):s.vertices.length==a.getSelectionCount()&&(mxClient.IS_QUIRKS&&mxUtils.br(e),e.appendChild(V));var j=mxUtils.bind(this,function(e,t,i){if(s=this.format.getSelectionState(),mxUtils.getValue(s.style,c,null),i||document.activeElement!=A){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_STROKEWIDTH,1));A.value=isNaN(l)?"":l+" pt"}if(i||document.activeElement!=$){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_STROKEWIDTH,1));$.value=isNaN(l)?"":l+" pt"}p.style.visibility="connector"==s.style.shape||"filledEdge"==s.style.shape?"":"hidden","1"==mxUtils.getValue(s.style,mxConstants.STYLE_CURVED,null)?p.value="curved":"1"==mxUtils.getValue(s.style,mxConstants.STYLE_ROUNDED,null)&&(p.value="rounded"),"1"==mxUtils.getValue(s.style,mxConstants.STYLE_DASHED,null)?null==mxUtils.getValue(s.style,mxConstants.STYLE_DASH_PATTERN,null)?D.style.borderBottom="1px dashed "+this.defaultStrokeColor:D.style.borderBottom="1px dotted "+this.defaultStrokeColor:D.style.borderBottom="1px solid "+this.defaultStrokeColor,Y.style.borderBottom=D.style.borderBottom;var n=N.getElementsByTagName("div")[0];if(null!=n){var r=mxUtils.getValue(s.style,mxConstants.STYLE_EDGE,null);"1"==mxUtils.getValue(s.style,mxConstants.STYLE_NOEDGESTYLE,null)&&(r=null),"orthogonalEdgeStyle"==r&&"1"==mxUtils.getValue(s.style,mxConstants.STYLE_CURVED,null)?n.className="geSprite geSprite-curved":"straight"==r||"none"==r||null==r?n.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==r?n.className="geSprite geSprite-entity":"elbowEdgeStyle"==r?n.className="geSprite "+("vertical"==mxUtils.getValue(s.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalelbow":"geSprite-horizontalelbow"):"isometricEdgeStyle"==r?n.className="geSprite "+("vertical"==mxUtils.getValue(s.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalisometric":"geSprite-horizontalisometric"):n.className="geSprite geSprite-orthogonal"}var d=L.getElementsByTagName("div")[0];function u(e,t,i,l){var n=i.getElementsByTagName("div")[0];return null!=n&&(n.className=o.getCssClassForMarker(l,s.style.shape,e,t),"geSprite geSprite-noarrow"==n.className&&(n.innerHTML=mxUtils.htmlEntities(mxResources.get("none")),n.style.backgroundImage="none",n.style.verticalAlign="top",n.style.marginTop="5px",n.style.fontSize="10px",n.style.filter="none",n.style.color=this.defaultStrokeColor,n.nextSibling.style.marginTop="0px")),n}null!=d&&("link"==s.style.shape?d.className="geSprite geSprite-linkedge":"flexArrow"==s.style.shape?d.className="geSprite geSprite-arrow":"arrow"==s.style.shape?d.className="geSprite geSprite-simplearrow":d.className="geSprite geSprite-connection"),s.edges.length==a.getSelectionCount()?(T.style.display="",f.style.display="none"):(T.style.display="none",f.style.display="");var g=u(mxUtils.getValue(s.style,mxConstants.STYLE_STARTARROW,null),mxUtils.getValue(s.style,"startFill","1"),O,"start"),h=u(mxUtils.getValue(s.style,mxConstants.STYLE_ENDARROW,null),mxUtils.getValue(s.style,"endFill","1"),U,"end");if(null!=g&&null!=h&&("arrow"==s.style.shape?(g.className="geSprite geSprite-noarrow",h.className="geSprite geSprite-endblocktrans"):"link"==s.style.shape&&(g.className="geSprite geSprite-noarrow",h.className="geSprite geSprite-noarrow")),mxUtils.setOpacity(N,"arrow"==s.style.shape?30:100),"connector"!=s.style.shape&&"flexArrow"!=s.style.shape&&"filledEdge"!=s.style.shape?(mxUtils.setOpacity(O,30),mxUtils.setOpacity(U,30)):(mxUtils.setOpacity(O,100),mxUtils.setOpacity(U,100)),i||document.activeElement!=H){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE));H.value=isNaN(l)?"":l+" pt"}if(i||document.activeElement!=W){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0));W.value=isNaN(l)?"":l+" pt"}if(i||document.activeElement!=F){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE));F.value=isNaN(l)?"":l+" pt"}if(i||document.activeElement!=W){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0));k.value=isNaN(l)?"":l+" pt"}if(i||document.activeElement!=z){var l=parseInt(mxUtils.getValue(s.style,mxConstants.STYLE_PERIMETER_SPACING,0));z.value=isNaN(l)?"":l+" pt"}});return n=this.installInputHandler(H,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),l=this.installInputHandler(W,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0,-999,999," pt"),i=this.installInputHandler(F,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),t=this.installInputHandler(k,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0,-999,999," pt"),r=this.installInputHandler(z,mxConstants.STYLE_PERIMETER_SPACING,0,0,999," pt"),this.addKeyHandler(A,j),this.addKeyHandler(H,j),this.addKeyHandler(W,j),this.addKeyHandler(F,j),this.addKeyHandler(k,j),this.addKeyHandler(z,j),a.getModel().addListener(mxEvent.CHANGE,j),this.listeners.push({destroy:function(){a.getModel().removeListener(j)}}),j(),e},StyleFormatPanel.prototype.addLineJumps=function(e){var t=this.format.getSelectionState();if(Graph.lineJumpsEnabled&&t.edges.length>0&&0==t.vertices.length&&t.lineJumps){e.style.padding="8px 0px 24px 18px";var i,l=this.editorUi,n=l.editor.graph,r=document.createElement("div");r.style.position="absolute",r.style.fontWeight="bold",r.style.width="80px",mxUtils.write(r,mxResources.get("lineJumps")),e.appendChild(r);var o=document.createElement("select");o.style.position="absolute",o.style.marginTop="-2px",o.style.right="76px",o.style.width="62px";for(var a=["none","arc","gap","sharp"],s=0;s<a.length;s++){var d=document.createElement("option");d.setAttribute("value",a[s]),mxUtils.write(d,mxResources.get(a[s])),o.appendChild(d)}mxEvent.addListener(o,"change",function(e){n.getModel().beginUpdate();try{n.setCellStyles("jumpStyle",o.value,n.getSelectionCells()),l.fireEvent(new mxEventObject("styleChanged","keys",["jumpStyle"],"values",[o.value],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}mxEvent.consume(e)}),mxEvent.addListener(o,"click",function(e){mxEvent.consume(e)}),e.appendChild(o);var p=this.addUnitInput(e,"pt",22,33,function(){i.apply(this,arguments)});i=this.installInputHandler(p,"jumpSize",Graph.defaultJumpSize,0,999," pt");var u=mxUtils.bind(this,function(e,i,l){if(t=this.format.getSelectionState(),o.value=mxUtils.getValue(t.style,"jumpStyle","none"),l||document.activeElement!=p){var n=parseInt(mxUtils.getValue(t.style,"jumpSize",Graph.defaultJumpSize));p.value=isNaN(n)?"":n+" pt"}});this.addKeyHandler(p,u),n.getModel().addListener(mxEvent.CHANGE,u),this.listeners.push({destroy:function(){n.getModel().removeListener(u)}}),u()}else e.style.display="none";return e},StyleFormatPanel.prototype.addEffects=function(e){var t=this.editorUi.editor.graph,i=this.format.getSelectionState();e.style.paddingTop="0px",e.style.paddingBottom="2px";var l=document.createElement("table");mxClient.IS_QUIRKS&&(l.style.fontSize="1em"),l.style.width="100%",l.style.fontWeight="bold",l.style.paddingRight="20px";var n=document.createElement("tbody"),r=document.createElement("tr");r.style.padding="0px";var o=document.createElement("td");o.style.padding="0px",o.style.width="50%",o.setAttribute("valign","top");var a=o.cloneNode(!0);a.style.paddingLeft="8px",r.appendChild(o),r.appendChild(a),n.appendChild(r),l.appendChild(n),e.appendChild(l);var s=o,d=0,p=mxUtils.bind(this,function(e,t,i){var l=this.createCellOption(e,t,i);l.style.width="100%",s.appendChild(l),s=s==o?a:o,d++}),u=mxUtils.bind(this,function(e,t,l){i=this.format.getSelectionState(),o.innerHTML="",a.innerHTML="",s=o,i.rounded&&p(mxResources.get("rounded"),mxConstants.STYLE_ROUNDED,0),"swimlane"==i.style.shape&&p(mxResources.get("divider"),"swimlaneLine",1),i.containsImage||p(mxResources.get("shadow"),mxConstants.STYLE_SHADOW,0),i.glass&&p(mxResources.get("glass"),mxConstants.STYLE_GLASS,0),p(mxResources.get("sketch"),"sketch",0)});return t.getModel().addListener(mxEvent.CHANGE,u),this.listeners.push({destroy:function(){t.getModel().removeListener(u)}}),u(),e},StyleFormatPanel.prototype.addStyleOps=function(e){e.style.paddingTop="10px",e.style.paddingBottom="10px";var t=mxUtils.button(mxResources.get("setAsDefaultStyle"),mxUtils.bind(this,function(e){this.editorUi.actions.get("setAsDefaultStyle").funct()}));return t.setAttribute("title",mxResources.get("setAsDefaultStyle")+" ("+this.editorUi.actions.get("setAsDefaultStyle").shortcut+")"),t.style.width="202px",e.appendChild(t),e},DiagramStylePanel=function(e,t,i){BaseFormatPanel.call(this,e,t,i),this.init()},mxUtils.extend(DiagramStylePanel,BaseFormatPanel),DiagramStylePanel.prototype.init=function(){this.editorUi.editor.graph,this.container.appendChild(this.addView(this.createPanel()))},DiagramStylePanel.prototype.addView=function(e){var t=this.editorUi,i=t.editor.graph,l=i.getModel();e.style.whiteSpace="normal";var n="1"==i.currentVertexStyle.sketch&&"1"==i.currentEdgeStyle.sketch,r="1"==i.currentVertexStyle.rounded,o="1"==i.currentEdgeStyle.curved,a=document.createElement("div");a.style.paddingBottom="12px",a.style.marginRight="16px",e.style.paddingTop="8px";var s=document.createElement("table");mxClient.IS_QUIRKS&&(s.style.fontSize="1em"),s.style.width="100%",s.style.fontWeight="bold";var d=document.createElement("tbody"),p=document.createElement("tr");p.style.padding="0px";var u=document.createElement("td");u.style.padding="0px",u.style.width="50%",u.setAttribute("valign","middle");var g=u.cloneNode(!0);g.style.paddingLeft="8px",p.appendChild(u),p.appendChild(g),d.appendChild(p),s.appendChild(d),u.appendChild(this.createOption(mxResources.get("sketch"),function(){return n},function(e){n=e,e?(i.currentEdgeStyle.sketch="1",i.currentVertexStyle.sketch="1"):(delete i.currentEdgeStyle.sketch,delete i.currentVertexStyle.sketch),i.updateCellStyles("sketch",e?"1":null,i.getVerticesAndEdges())},null,function(e){e.style.width="auto"})),g.appendChild(this.createOption(mxResources.get("rounded"),function(){return r},function(e){r=e,e?i.currentVertexStyle.rounded="1":delete i.currentVertexStyle.rounded,i.updateCellStyles("rounded",e?"1":null,i.getVerticesAndEdges(!0,!0))},null,function(e){e.style.width="auto"})),u=u.cloneNode(!1),g=g.cloneNode(!1),(p=p.cloneNode(!1)).appendChild(u),p.appendChild(g),d.appendChild(p),u.appendChild(this.createOption(mxResources.get("curved"),function(){return o},function(e){o=e,e?i.currentEdgeStyle.curved="1":delete i.currentEdgeStyle.curved,i.updateCellStyles("curved",e?"1":null,i.getVerticesAndEdges(!1,!0))},null,function(e){e.style.width="auto"})),a.appendChild(s),e.appendChild(a);var h=["fillColor","strokeColor","fontColor","gradientColor"],c=mxUtils.bind(this,function(e,t){var n=i.getVerticesAndEdges();l.beginUpdate();try{for(var r=0;r<n.length;r++){var o=i.getCellStyle(n[r]);null!=o.labelBackgroundColor&&i.updateCellStyles("labelBackgroundColor",null!=t?t.background:null,[n[r]]);for(var a=l.isEdge(n[r]),s=l.getStyle(n[r]),d=a?i.currentEdgeStyle:i.currentVertexStyle,p=0;p<e.length;p++)(null!=o[e[p]]&&o[e[p]]!=mxConstants.NONE||e[p]!=mxConstants.STYLE_FILLCOLOR&&e[p]!=mxConstants.STYLE_STROKECOLOR)&&(s=mxUtils.setStyle(s,e[p],d[e[p]]));l.setStyle(n[r],s)}}finally{l.endUpdate()}}),y=mxUtils.bind(this,function(e,t,i){if(null!=e)for(var l=0;l<t.length;l++)(null!=e[t[l]]&&e[t[l]]!=mxConstants.NONE||t[l]!=mxConstants.STYLE_FILLCOLOR&&t[l]!=mxConstants.STYLE_STROKECOLOR)&&(e[t[l]]=i[t[l]])}),S=mxUtils.bind(this,function(e,t,l,n,r){if(null!=e){if(null!=l&&null!=t.labelBackgroundColor){var o=null!=n?n.background:null;r=null!=r?r:i,null==o&&(o=r.background),null==o&&(o=r.defaultPageBackgroundColor),t.labelBackgroundColor=o}for(var a in e)(null==l||null!=t[a]&&t[a]!=mxConstants.NONE||a!=mxConstants.STYLE_FILLCOLOR&&a!=mxConstants.STYLE_STROKECOLOR)&&(t[a]=e[a])}}),E=mxUtils.button(mxResources.get("reset"),mxUtils.bind(this,function(e){var n=i.getVerticesAndEdges(!0,!0);if(n.length>0){l.beginUpdate();try{i.updateCellStyles("sketch",null,n),i.updateCellStyles("rounded",null,n),i.updateCellStyles("curved",null,i.getVerticesAndEdges(!1,!0))}finally{l.endUpdate()}}i.defaultVertexStyle=mxUtils.clone(t.initialDefaultVertexStyle),i.defaultEdgeStyle=mxUtils.clone(t.initialDefaultEdgeStyle),t.clearDefaultStyle()}));E.setAttribute("title",mxResources.get("reset")),E.style.textOverflow="ellipsis",E.style.maxWidth="90px",g.appendChild(E);var f=mxUtils.bind(this,function(e,t,n,r,o){var a=document.createElement("div");a.style.cssText="position:absolute;display:inline-block;width:100%;height:100%;overflow:hidden;pointer-events:none;",o.appendChild(a);var s=new Graph(a,null,null,i.getStylesheet());s.resetViewOnRootChange=!1,s.foldingEnabled=!1,s.gridEnabled=!1,s.autoScroll=!1,s.setTooltips(!1),s.setConnectable(!1),s.setPanning(!1),s.setEnabled(!1),s.getCellStyle=function(o){var a=mxUtils.clone(Graph.prototype.getCellStyle.apply(this,arguments)),d=i.stylesheet.getDefaultVertexStyle(),p=t;return l.isEdge(o)&&(d=i.stylesheet.getDefaultEdgeStyle(),p=n),y(a,h,d),S(e,a,o,r,s),S(p,a,o,r,s),a},s.model.beginUpdate();try{var d=s.insertVertex(s.getDefaultParent(),null,"Shape",14,8,70,40,"strokeWidth=2;"),p=s.insertEdge(s.getDefaultParent(),null,"Connector",d,d,"edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;endSize=5;strokeWidth=2;");p.geometry.points=[new mxPoint(32,70)],p.geometry.offset=new mxPoint(0,8)}finally{s.model.endUpdate()}}),m=document.createElement("div");m.style.position="relative",e.appendChild(m),null==this.format.cachedStyleEntries&&(this.format.cachedStyleEntries=[]);var C=mxUtils.bind(this,function(e,a,s,d,p){var u=this.format.cachedStyleEntries[p];null==u&&((u=document.createElement("div")).style.cssText="display:inline-block;position:relative;width:96px;height:90px;cursor:pointer;border:1px solid gray;margin:2px;overflow:hidden;",null!=d&&null!=d.background&&(u.style.backgroundColor=d.background),f(e,a,s,d,u),mxEvent.addGestureListeners(u,mxUtils.bind(this,function(e){u.style.opacity=.5}),null,mxUtils.bind(this,function(p){u.style.opacity=1,i.defaultVertexStyle=mxUtils.clone(t.initialDefaultVertexStyle),i.defaultEdgeStyle=mxUtils.clone(t.initialDefaultEdgeStyle),S(e,i.defaultVertexStyle),S(e,i.defaultEdgeStyle),S(a,i.defaultVertexStyle),S(s,i.defaultEdgeStyle),t.clearDefaultStyle(),n?(i.currentEdgeStyle.sketch="1",i.currentVertexStyle.sketch="1"):(i.currentEdgeStyle.sketch="0",i.currentVertexStyle.sketch="0"),r?(i.currentVertexStyle.rounded="1",i.currentEdgeStyle.rounded="1"):(i.currentVertexStyle.rounded="0",i.currentEdgeStyle.rounded="1"),o?i.currentEdgeStyle.curved="1":i.currentEdgeStyle.curved="0",l.beginUpdate();try{c(h,d);var g=new ChangePageSetup(t,null!=d?d.background:null);g.ignoreImage=!0,l.execute(g),l.execute(new ChangeGridColor(t,null!=d&&null!=d.gridColor?d.gridColor:i.view.defaultGridColor))}finally{l.endUpdate()}})),mxEvent.addListener(u,"mouseenter",mxUtils.bind(this,function(t){var n=i.getCellStyle,r=i.background,o=i.view.gridColor;i.background=null!=d?d.background:null,i.view.gridColor=null!=d&&null!=d.gridColor?d.gridColor:i.view.defaultGridColor,i.getCellStyle=function(t){var r=mxUtils.clone(n.apply(this,arguments)),o=i.stylesheet.getDefaultVertexStyle(),p=a;return l.isEdge(t)&&(o=i.stylesheet.getDefaultEdgeStyle(),p=s),y(r,h,o),S(e,r,t,d),S(p,r,t,d),r},i.refresh(),i.getCellStyle=n,i.background=r,i.view.gridColor=o})),mxEvent.addListener(u,"mouseleave",mxUtils.bind(this,function(e){i.refresh()})),this.format.cachedStyleEntries[p]=u),m.appendChild(u)}),T=Math.ceil(Editor.styles.length/10);this.format.currentStylePage=null!=this.format.currentStylePage?this.format.currentStylePage:0;var L=[],v=mxUtils.bind(this,function(){L.length>0&&(L[this.format.currentStylePage].style.background="#84d7ff");for(var e=10*this.format.currentStylePage;e<Math.min((this.format.currentStylePage+1)*10,Editor.styles.length);e++){var t=Editor.styles[e];C(t.commonStyle,t.vertexStyle,t.edgeStyle,t.graph,e)}}),b=mxUtils.bind(this,function(e){e>=0&&e<T&&(L[this.format.currentStylePage].style.background="transparent",m.innerHTML="",this.format.currentStylePage=e,v())});if(T>1){var A=document.createElement("div");A.style.whiteSpace="nowrap",A.style.position="relative",A.style.textAlign="center",A.style.paddingTop="4px",A.style.width="210px",e.style.paddingBottom="8px";for(var $=0;$<T;$++){var x=document.createElement("div");x.style.display="inline-block",x.style.width="6px",x.style.height="6px",x.style.marginLeft="4px",x.style.marginRight="3px",x.style.borderRadius="3px",x.style.cursor="pointer",x.style.background="transparent",x.style.border="1px solid #b5b6b7",mxUtils.bind(this,function(e,t){mxEvent.addListener(x,"click",mxUtils.bind(this,function(){b(e)}))})($,x),A.appendChild(x),L.push(x)}if(e.appendChild(A),v(),T<15){var u=document.createElement("div");u.style.cssText="position:absolute;left:0px;top:4px;bottom:0px;width:20px;margin:0px;opacity:0.5;background-repeat:no-repeat;background-position:center center;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQBAMAAADQT4M0AAAAIVBMVEUAAAB2dnZ4eHh3d3d1dXVxcXF2dnZ2dnZ2dnZxcXF2dnYmb3w1AAAACnRSTlMAfCTkhhvb7cQSPH2JPgAAADRJREFUCNdjwACMAmBKaiGYs2oJmLPKAZ3DabU8AMRTXpUKopislqFyVzCAuUZgikkBZjoAcMYLnp53P/UAAAAASUVORK5CYII=);",mxEvent.addListener(u,"click",mxUtils.bind(this,function(){b(mxUtils.mod(this.format.currentStylePage-1,T))}));var g=document.createElement("div");function I(e){mxEvent.addListener(e,"mouseenter",function(){e.style.opacity="1"}),mxEvent.addListener(e,"mouseleave",function(){e.style.opacity="0.5"})}g.style.cssText="position:absolute;right:2px;top:4px;bottom:0px;width:20px;margin:0px;opacity:0.5;background-repeat:no-repeat;background-position:center center;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQBAMAAADQT4M0AAAAIVBMVEUAAAB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnYBuwCcAAAACnRSTlMAfCTkhhvb7cQSPH2JPgAAADZJREFUCNdjQAOMAmBKaiGY8loF5rKswsZlrVo8AUiFrTICcbIWK8A5DF1gDoMymMPApIAwHwCS0Qx/U7qCBQAAAABJRU5ErkJggg==);",A.appendChild(u),A.appendChild(g),mxEvent.addListener(g,"click",mxUtils.bind(this,function(){b(mxUtils.mod(this.format.currentStylePage+1,T))})),I(u),I(g)}}else v();return e},DiagramFormatPanel=function(e,t,i){BaseFormatPanel.call(this,e,t,i),this.init()},mxUtils.extend(DiagramFormatPanel,BaseFormatPanel),DiagramFormatPanel.showPageView=!0,DiagramFormatPanel.prototype.showBackgroundImageOption=!0,DiagramFormatPanel.prototype.init=function(){var e=this.editorUi.editor.graph;this.container.appendChild(this.addView(this.createPanel())),e.isEnabled()&&(this.container.appendChild(this.addOptions(this.createPanel())),this.container.appendChild(this.addPaperSize(this.createPanel())),this.container.appendChild(this.addStyleOps(this.createPanel())))},DiagramFormatPanel.prototype.addView=function(e){var t=this.editorUi,i=t.editor.graph;if(e.appendChild(this.createTitle(mxResources.get("view"))),this.addGridOption(e),DiagramFormatPanel.showPageView&&e.appendChild(this.createOption(mxResources.get("pageView"),function(){return i.pageVisible},function(e){t.actions.get("pageView").funct()},{install:function(e){this.listener=function(){e(i.pageVisible)},t.addListener("pageViewChanged",this.listener)},destroy:function(){t.removeListener(this.listener)}})),i.isEnabled()){var l=this.createColorOption(mxResources.get("background"),function(){return i.background},function(e){var l=new ChangePageSetup(t,e);l.ignoreImage=!0,i.model.execute(l)},"#ffffff",{install:function(e){this.listener=function(){e(i.background)},t.addListener("backgroundColorChanged",this.listener)},destroy:function(){t.removeListener(this.listener)}});if(this.showBackgroundImageOption){var n=mxUtils.button(mxResources.get("image"),function(e){t.showBackgroundImageDialog(null,t.editor.graph.backgroundImage),mxEvent.consume(e)});n.style.position="absolute",n.className="geColorBtn",n.style.marginTop="-4px",n.style.paddingBottom=11==document.documentMode||mxClient.IS_MT?"0px":"2px",n.style.height="22px",n.style.right=mxClient.IS_QUIRKS?"52px":"72px",n.style.width="56px",l.appendChild(n)}e.appendChild(l)}return e},DiagramFormatPanel.prototype.addOptions=function(e){var t=this.editorUi,i=t.editor.graph;return e.appendChild(this.createTitle(mxResources.get("options"))),i.isEnabled()&&(e.appendChild(this.createOption(mxResources.get("connectionArrows"),function(){return i.connectionArrowsEnabled},function(e){t.actions.get("connectionArrows").funct()},{install:function(e){this.listener=function(){e(i.connectionArrowsEnabled)},t.addListener("connectionArrowsChanged",this.listener)},destroy:function(){t.removeListener(this.listener)}})),e.appendChild(this.createOption(mxResources.get("connectionPoints"),function(){return i.connectionHandler.isEnabled()},function(e){t.actions.get("connectionPoints").funct()},{install:function(e){this.listener=function(){e(i.connectionHandler.isEnabled())},t.addListener("connectionPointsChanged",this.listener)},destroy:function(){t.removeListener(this.listener)}})),e.appendChild(this.createOption(mxResources.get("guides"),function(){return i.graphHandler.guidesEnabled},function(e){t.actions.get("guides").funct()},{install:function(e){this.listener=function(){e(i.graphHandler.guidesEnabled)},t.addListener("guidesEnabledChanged",this.listener)},destroy:function(){t.removeListener(this.listener)}}))),e},DiagramFormatPanel.prototype.addGridOption=function(e){var t=this,i=this.editorUi,l=i.editor.graph,n=document.createElement("input");n.style.position="absolute",n.style.textAlign="right",n.style.width="38px",n.value=this.inUnit(l.getGridSize())+" "+this.getUnit();var r=this.createStepper(n,o,this.getUnitStep(),null,null,null,this.isFloatUnit());function o(e){var i=t.isFloatUnit()?parseFloat(n.value):parseInt(n.value);(i=t.fromUnit(Math.max(t.inUnit(1),isNaN(i)?t.inUnit(10):i)))!=l.getGridSize()&&l.setGridSize(i),n.value=t.inUnit(i)+" "+t.getUnit(),mxEvent.consume(e)}n.style.display=l.isGridEnabled()?"":"none",r.style.display=n.style.display,mxEvent.addListener(n,"keydown",function(e){13==e.keyCode?(l.container.focus(),mxEvent.consume(e)):27==e.keyCode&&(n.value=l.getGridSize(),l.container.focus(),mxEvent.consume(e))}),mxEvent.addListener(n,"blur",o),mxEvent.addListener(n,"change",o);var a=function(e,i){n.value=t.inUnit(l.getGridSize())+" "+t.getUnit(),t.format.refresh()};if(l.view.addListener("unitChanged",a),this.listeners.push({destroy:function(){l.view.removeListener(a)}}),mxClient.IS_SVG){n.style.marginTop="-2px",n.style.right="84px",r.style.marginTop="-16px",r.style.right="72px";var s=this.createColorOption(mxResources.get("grid"),function(){var e=l.view.gridColor;return l.isGridEnabled()?e:null},function(e){var t=l.isGridEnabled();e==mxConstants.NONE?l.setGridEnabled(!1):(l.setGridEnabled(!0),i.setGridColor(e)),n.style.display=l.isGridEnabled()?"":"none",r.style.display=n.style.display,t!=l.isGridEnabled()&&i.fireEvent(new mxEventObject("gridEnabledChanged"))},"#e0e0e0",{install:function(e){this.listener=function(){e(l.isGridEnabled()?l.view.gridColor:null)},i.addListener("gridColorChanged",this.listener),i.addListener("gridEnabledChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}});s.appendChild(n),s.appendChild(r),e.appendChild(s)}else n.style.marginTop="2px",n.style.right="32px",r.style.marginTop="2px",r.style.right="20px",e.appendChild(n),e.appendChild(r),e.appendChild(this.createOption(mxResources.get("grid"),function(){return l.isGridEnabled()},function(e){l.setGridEnabled(e),l.isGridEnabled()&&(l.view.gridColor="#e0e0e0"),i.fireEvent(new mxEventObject("gridEnabledChanged"))},{install:function(e){this.listener=function(){n.style.display=l.isGridEnabled()?"":"none",r.style.display=n.style.display,e(l.isGridEnabled())},i.addListener("gridEnabledChanged",this.listener)},destroy:function(){i.removeListener(this.listener)}}))},DiagramFormatPanel.prototype.addDocumentProperties=function(e){return this.editorUi.editor.graph,e.appendChild(this.createTitle(mxResources.get("options"))),e},DiagramFormatPanel.prototype.addPaperSize=function(e){var t=this.editorUi,i=t.editor.graph;e.appendChild(this.createTitle(mxResources.get("paperSize")));var l=PageSetupDialog.addPageFormatPanel(e,"formatpanel",i.pageFormat,function(e){if(null==i.pageFormat||i.pageFormat.width!=e.width||i.pageFormat.height!=e.height){var l=new ChangePageSetup(t,null,null,e);l.ignoreColor=!0,l.ignoreImage=!0,i.model.execute(l)}});this.addKeyHandler(l.widthInput,function(){l.set(i.pageFormat)}),this.addKeyHandler(l.heightInput,function(){l.set(i.pageFormat)});var n=function(){l.set(i.pageFormat)};return t.addListener("pageFormatChanged",n),this.listeners.push({destroy:function(){t.removeListener(n)}}),i.getModel().addListener(mxEvent.CHANGE,n),this.listeners.push({destroy:function(){i.getModel().removeListener(n)}}),e},DiagramFormatPanel.prototype.addStyleOps=function(e){var t=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(e){this.editorUi.actions.get("editData").funct()}));return t.setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),t.style.width="202px",t.style.marginBottom="2px",e.appendChild(t),mxUtils.br(e),(t=mxUtils.button(mxResources.get("clearDefaultStyle"),mxUtils.bind(this,function(e){this.editorUi.actions.get("clearDefaultStyle").funct()}))).setAttribute("title",mxResources.get("clearDefaultStyle")+" ("+this.editorUi.actions.get("clearDefaultStyle").shortcut+")"),t.style.width="202px",e.appendChild(t),e},DiagramFormatPanel.prototype.destroy=function(){BaseFormatPanel.prototype.destroy.apply(this,arguments),this.gridEnabledListener&&(this.editorUi.removeListener(this.gridEnabledListener),this.gridEnabledListener=null)};